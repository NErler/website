<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates</title>
  <meta name="description" content="Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="figures/CoverImage_Erler.jpeg" />
  <meta property="og:description" content="Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates" />
  
  <meta name="twitter:description" content="Chapter 6 JointAI: Joint Analysis and Imputation of Incomplete Data in R | Bayesian Imputation of Missing Covariates" />
  <meta name="twitter:image" content="figures/CoverImage_Erler.jpeg" />

<meta name="author" content="Nicole S. Erler" />


<meta name="date" content="2019-08-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-SMMR.html"/>
<link rel="next" href="ch-discussion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.8/datatables.js"></script>
<link href="libs/dt-core-bootstrap-1.10.16/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="libs/dt-core-bootstrap-1.10.16/css/dataTables.bootstrap.extra.css" rel="stylesheet" />
<script src="libs/dt-core-bootstrap-1.10.16/js/jquery.dataTables.min.js"></script>
<script src="libs/dt-core-bootstrap-1.10.16/js/dataTables.bootstrap.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bayesian imputation of Missing Covariates</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#mechanisms-and-patterns-of-missing-data"><i class="fa fa-check"></i><b>1.1</b> Mechanisms and Patterns of Missing Data</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#missing-data-mechanism"><i class="fa fa-check"></i><b>1.1.1</b> Missing Data Mechanism</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#missing-data-pattern"><i class="fa fa-check"></i><b>1.1.2</b> Missing Data Pattern</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#multiple-imputed-datasets"><i class="fa fa-check"></i><b>1.2</b> Multiple Imputed Datasets</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#methods-for-imputation"><i class="fa fa-check"></i><b>1.2.1</b> Methods for Imputation</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#pooling-results-from-multiple-imputed-datasets"><i class="fa fa-check"></i><b>1.2.2</b> Pooling Results from Multiple Imputed Datasets</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-bayesian-framework"><i class="fa fa-check"></i><b>1.3</b> The Bayesian Framework</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#bayes-theorem"><i class="fa fa-check"></i><b>1.3.1</b> Bayes Theorem</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#monte-carlo-methods"><i class="fa fa-check"></i><b>1.3.2</b> Monte Carlo Methods</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>1.3.3</b> Markov Chain Monte Carlo</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#gibbs-sampler"><i class="fa fa-check"></i><b>1.3.4</b> Gibbs Sampler</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#convergence-mixing-and-thinning"><i class="fa fa-check"></i><b>1.3.5</b> Convergence, Mixing and Thinning</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#motivating-datasets"><i class="fa fa-check"></i><b>1.4</b> Motivating Datasets</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#outline-of-this-thesis"><i class="fa fa-check"></i><b>1.5</b> Outline of this Thesis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-SIM.html"><a href="ch-SIM.html"><i class="fa fa-check"></i><b>2</b> Dealing with Missing Covariates in Epidemiologic Studies</a><ul>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="2.1" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:introSIM"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:SIMData"><i class="fa fa-check"></i><b>2.2</b> Generation R Data</a></li>
<li class="chapter" data-level="2.3" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:MissingData"><i class="fa fa-check"></i><b>2.3</b> Dealing with Missing Data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="ch-SIM.html"><a href="ch-SIM.html#multiple-imputation-using-chained-equations-1"><i class="fa fa-check"></i><b>2.3.1</b> Multiple Imputation using Chained Equations</a></li>
<li class="chapter" data-level="2.3.2" data-path="ch-SIM.html"><a href="ch-SIM.html#fully-bayesian-imputation"><i class="fa fa-check"></i><b>2.3.2</b> Fully Bayesian Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:DataAnalysis"><i class="fa fa-check"></i><b>2.4</b> Data Analysis</a><ul>
<li class="chapter" data-level="2.4.1" data-path="ch-SIM.html"><a href="ch-SIM.html#design"><i class="fa fa-check"></i><b>2.4.1</b> Design</a></li>
<li class="chapter" data-level="2.4.2" data-path="ch-SIM.html"><a href="ch-SIM.html#results"><i class="fa fa-check"></i><b>2.4.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:SimulationSIM"><i class="fa fa-check"></i><b>2.5</b> Simulation Study</a><ul>
<li class="chapter" data-level="2.5.1" data-path="ch-SIM.html"><a href="ch-SIM.html#design-1"><i class="fa fa-check"></i><b>2.5.1</b> Design</a></li>
<li class="chapter" data-level="2.5.2" data-path="ch-SIM.html"><a href="ch-SIM.html#results-1"><i class="fa fa-check"></i><b>2.5.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="ch-SIM.html"><a href="ch-SIM.html#sec:DiscussionSIM"><i class="fa fa-check"></i><b>2.6</b> Discussion</a></li>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#appendix"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#a-variable-description"><i class="fa fa-check"></i>2.A Variable Description</a></li>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#b-results-from-the-generation-r-data"><i class="fa fa-check"></i>2.B Results from the Generation R Data</a></li>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#c-simulation-settings"><i class="fa fa-check"></i>2.C Simulation Settings</a></li>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#d-simulation-results"><i class="fa fa-check"></i>2.D Simulation Results</a></li>
<li class="chapter" data-level="" data-path="ch-SIM.html"><a href="ch-SIM.html#e-jags-syntax-for-simulation-scenario-2"><i class="fa fa-check"></i>2.E JAGS Syntax for Simulation Scenario 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-Myrte.html"><a href="ch-Myrte.html"><i class="fa fa-check"></i><b>3</b> Dietary Patterns and Gestational Weight Gain</a><ul>
<li class="chapter" data-level="" data-path="ch-Myrte.html"><a href="ch-Myrte.html#abstract-1"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="3.1" data-path="ch-Myrte.html"><a href="ch-Myrte.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="ch-Myrte.html"><a href="ch-Myrte.html#experimental-section"><i class="fa fa-check"></i><b>3.2</b> Experimental Section</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ch-Myrte.html"><a href="ch-Myrte.html#study-design"><i class="fa fa-check"></i><b>3.2.1</b> Study Design</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-Myrte.html"><a href="ch-Myrte.html#population-of-analysis"><i class="fa fa-check"></i><b>3.2.2</b> Population of Analysis</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-Myrte.html"><a href="ch-Myrte.html#dietary-assessment"><i class="fa fa-check"></i><b>3.2.3</b> Dietary Assessment</a></li>
<li class="chapter" data-level="3.2.4" data-path="ch-Myrte.html"><a href="ch-Myrte.html#maternal-weight-gain"><i class="fa fa-check"></i><b>3.2.4</b> Maternal Weight Gain</a></li>
<li class="chapter" data-level="3.2.5" data-path="ch-Myrte.html"><a href="ch-Myrte.html#covariates"><i class="fa fa-check"></i><b>3.2.5</b> Covariates</a></li>
<li class="chapter" data-level="3.2.6" data-path="ch-Myrte.html"><a href="ch-Myrte.html#statistical-analyses"><i class="fa fa-check"></i><b>3.2.6</b> Statistical Analyses</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-Myrte.html"><a href="ch-Myrte.html#results-2"><i class="fa fa-check"></i><b>3.3</b> Results</a><ul>
<li class="chapter" data-level="3.3.1" data-path="ch-Myrte.html"><a href="ch-Myrte.html#study-population"><i class="fa fa-check"></i><b>3.3.1</b> Study Population</a></li>
<li class="chapter" data-level="3.3.2" data-path="ch-Myrte.html"><a href="ch-Myrte.html#dietary-patterns-and-trajectories-of-gestational-weight"><i class="fa fa-check"></i><b>3.3.2</b> Dietary Patterns and Trajectories of Gestational Weight</a></li>
<li class="chapter" data-level="3.3.3" data-path="ch-Myrte.html"><a href="ch-Myrte.html#dietary-patterns-and-gestational-weight-gain-in-different-phases-in-pregnancy"><i class="fa fa-check"></i><b>3.3.3</b> Dietary Patterns and Gestational Weight Gain in Different Phases in Pregnancy</a></li>
<li class="chapter" data-level="3.3.4" data-path="ch-Myrte.html"><a href="ch-Myrte.html#sensitivity-analyses-1"><i class="fa fa-check"></i><b>3.3.4</b> Sensitivity Analyses</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="ch-Myrte.html"><a href="ch-Myrte.html#discussion"><i class="fa fa-check"></i><b>3.4</b> Discussion</a><ul>
<li class="chapter" data-level="3.4.1" data-path="ch-Myrte.html"><a href="ch-Myrte.html#summary-of-the-main-findings"><i class="fa fa-check"></i><b>3.4.1</b> Summary of the Main Findings</a></li>
<li class="chapter" data-level="3.4.2" data-path="ch-Myrte.html"><a href="ch-Myrte.html#interpretation-and-comparison-with-other-studies"><i class="fa fa-check"></i><b>3.4.2</b> Interpretation and Comparison with other Studies</a></li>
<li class="chapter" data-level="3.4.3" data-path="ch-Myrte.html"><a href="ch-Myrte.html#strengths-and-limitations"><i class="fa fa-check"></i><b>3.4.3</b> Strengths and Limitations</a></li>
<li class="chapter" data-level="3.4.4" data-path="ch-Myrte.html"><a href="ch-Myrte.html#conclusions-and-implications"><i class="fa fa-check"></i><b>3.4.4</b> Conclusions and Implications</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ch-Myrte.html"><a href="ch-Myrte.html#appendix-1"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="ch-Myrte.html"><a href="ch-Myrte.html#a-supplementary-materials"><i class="fa fa-check"></i>3.A Supplementary Materials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-Vincent.html"><a href="ch-Vincent.html"><i class="fa fa-check"></i><b>4</b> Mothers’ SCB Intake and Body Composition of their Children</a><ul>
<li class="chapter" data-level="" data-path="ch-Vincent.html"><a href="ch-Vincent.html#abstract-2"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="4.1" data-path="ch-Vincent.html"><a href="ch-Vincent.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ch-Vincent.html"><a href="ch-Vincent.html#methods"><i class="fa fa-check"></i><b>4.2</b> Methods</a><ul>
<li class="chapter" data-level="4.2.1" data-path="ch-Vincent.html"><a href="ch-Vincent.html#study-design-1"><i class="fa fa-check"></i><b>4.2.1</b> Study Design</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch-Vincent.html"><a href="ch-Vincent.html#study-population-1"><i class="fa fa-check"></i><b>4.2.2</b> Study Population</a></li>
<li class="chapter" data-level="4.2.3" data-path="ch-Vincent.html"><a href="ch-Vincent.html#dietary-assessment-of-the-mother"><i class="fa fa-check"></i><b>4.2.3</b> Dietary Assessment of the Mother</a></li>
<li class="chapter" data-level="4.2.4" data-path="ch-Vincent.html"><a href="ch-Vincent.html#child-anthropometric-measures-and-body-composition"><i class="fa fa-check"></i><b>4.2.4</b> Child Anthropometric Measures and Body Composition</a></li>
<li class="chapter" data-level="4.2.5" data-path="ch-Vincent.html"><a href="ch-Vincent.html#covariates-1"><i class="fa fa-check"></i><b>4.2.5</b> Covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch-Vincent.html"><a href="ch-Vincent.html#statistical-analyses-1"><i class="fa fa-check"></i><b>4.3</b> Statistical Analyses</a></li>
<li class="chapter" data-level="4.4" data-path="ch-Vincent.html"><a href="ch-Vincent.html#results-3"><i class="fa fa-check"></i><b>4.4</b> Results</a><ul>
<li class="chapter" data-level="4.4.1" data-path="ch-Vincent.html"><a href="ch-Vincent.html#subject-characteristics"><i class="fa fa-check"></i><b>4.4.1</b> Subject Characteristics</a></li>
<li class="chapter" data-level="4.4.2" data-path="ch-Vincent.html"><a href="ch-Vincent.html#maternal-scb-intake-and-child-bmi-trajectory"><i class="fa fa-check"></i><b>4.4.2</b> Maternal SCB Intake and Child BMI Trajectory</a></li>
<li class="chapter" data-level="4.4.3" data-path="ch-Vincent.html"><a href="ch-Vincent.html#maternal-scb-intake-and-child-body-composition"><i class="fa fa-check"></i><b>4.4.3</b> Maternal SCB Intake and Child Body Composition</a></li>
<li class="chapter" data-level="4.4.4" data-path="ch-Vincent.html"><a href="ch-Vincent.html#additional-analyses"><i class="fa fa-check"></i><b>4.4.4</b> Additional Analyses</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ch-Vincent.html"><a href="ch-Vincent.html#discussion-1"><i class="fa fa-check"></i><b>4.5</b> Discussion</a><ul>
<li class="chapter" data-level="4.5.1" data-path="ch-Vincent.html"><a href="ch-Vincent.html#interpretation-and-comparison-with-previous-studies"><i class="fa fa-check"></i><b>4.5.1</b> Interpretation and Comparison with Previous Studies</a></li>
<li class="chapter" data-level="4.5.2" data-path="ch-Vincent.html"><a href="ch-Vincent.html#potential-mechanisms"><i class="fa fa-check"></i><b>4.5.2</b> Potential Mechanisms</a></li>
<li class="chapter" data-level="4.5.3" data-path="ch-Vincent.html"><a href="ch-Vincent.html#strengths-and-limitations-1"><i class="fa fa-check"></i><b>4.5.3</b> Strengths and Limitations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ch-Vincent.html"><a href="ch-Vincent.html#appendix-2"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="ch-Vincent.html"><a href="ch-Vincent.html#a-additional-results"><i class="fa fa-check"></i>4.A Additional Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-SMMR.html"><a href="ch-SMMR.html"><i class="fa fa-check"></i><b>5</b> Bayesian Imputation of Time-varying Covariates in Mixed Models</a><ul>
<li class="chapter" data-level="" data-path="ch-SMMR.html"><a href="ch-SMMR.html#abstract-3"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="5.1" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:introSMMR"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:DataSMMR"><i class="fa fa-check"></i><b>5.2</b> Generation R Data</a></li>
<li class="chapter" data-level="5.3" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:ModelSMMR"><i class="fa fa-check"></i><b>5.3</b> Modelling Longitudinal Data with Time-varying Covariates</a><ul>
<li class="chapter" data-level="5.3.1" data-path="ch-SMMR.html"><a href="ch-SMMR.html#framework"><i class="fa fa-check"></i><b>5.3.1</b> Framework</a></li>
<li class="chapter" data-level="5.3.2" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:funcformSMMR"><i class="fa fa-check"></i><b>5.3.2</b> Functional Forms for Time-varying Covariates</a></li>
<li class="chapter" data-level="5.3.3" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:endoexoSMMR"><i class="fa fa-check"></i><b>5.3.3</b> Endo- and Exogeneity</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:modelsSMMR"><i class="fa fa-check"></i><b>5.4</b> Bayesian Analysis with Incomplete Covariates</a><ul>
<li class="chapter" data-level="5.4.1" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:seq-approachSMMR"><i class="fa fa-check"></i><b>5.4.1</b> Sequential Approach</a></li>
<li class="chapter" data-level="5.4.2" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:mvn-approachSMMR"><i class="fa fa-check"></i><b>5.4.2</b> Multivariate Normal Approach</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:DataAnalysisSMMR"><i class="fa fa-check"></i><b>5.5</b> Analysis of the Generation R Data</a><ul>
<li class="chapter" data-level="5.5.1" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:DataAnalysisEx1"><i class="fa fa-check"></i><b>5.5.1</b> Association between Blood Pressure and Gestational Weight</a></li>
<li class="chapter" data-level="5.5.2" data-path="ch-SMMR.html"><a href="ch-SMMR.html#association-between-gestational-weight-gain-and-child-bmi"><i class="fa fa-check"></i><b>5.5.2</b> Association between Gestational Weight Gain and Child BMI</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:simulationSMMR"><i class="fa fa-check"></i><b>5.6</b> Simulation Study</a><ul>
<li class="chapter" data-level="5.6.1" data-path="ch-SMMR.html"><a href="ch-SMMR.html#design-2"><i class="fa fa-check"></i><b>5.6.1</b> Design</a></li>
<li class="chapter" data-level="5.6.2" data-path="ch-SMMR.html"><a href="ch-SMMR.html#analysis-models"><i class="fa fa-check"></i><b>5.6.2</b> Analysis Models</a></li>
<li class="chapter" data-level="5.6.3" data-path="ch-SMMR.html"><a href="ch-SMMR.html#results-4"><i class="fa fa-check"></i><b>5.6.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="ch-SMMR.html"><a href="ch-SMMR.html#sec:DiscussionSMMR"><i class="fa fa-check"></i><b>5.7</b> Discussion</a></li>
<li class="chapter" data-level="" data-path="ch-SMMR.html"><a href="ch-SMMR.html#appendix-3"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="ch-SMMR.html"><a href="ch-SMMR.html#a-details-on-the-implied-exo--or-endogeneity"><i class="fa fa-check"></i>5.A Details on the Implied Exo- or Endogeneity</a></li>
<li class="chapter" data-level="" data-path="ch-SMMR.html"><a href="ch-SMMR.html#b-analysis-of-the-generation-r-data"><i class="fa fa-check"></i>5.B Analysis of the Generation R Data</a></li>
<li class="chapter" data-level="" data-path="ch-SMMR.html"><a href="ch-SMMR.html#c-simulation-study"><i class="fa fa-check"></i>5.C Simulation Study</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-JSS.html"><a href="ch-JSS.html"><i class="fa fa-check"></i><b>6</b> JointAI: Joint Analysis and Imputation of Incomplete Data in R</a><ul>
<li class="chapter" data-level="" data-path="ch-JSS.html"><a href="ch-JSS.html#abstract-4"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="6.1" data-path="ch-JSS.html"><a href="ch-JSS.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:TheoryJSS"><i class="fa fa-check"></i><b>6.2</b> Theoretical Background</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:AnalysisModel"><i class="fa fa-check"></i><b>6.2.1</b> Analysis Model</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch-JSS.html"><a href="ch-JSS.html#imputation-part"><i class="fa fa-check"></i><b>6.2.2</b> Imputation Part</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:priors"><i class="fa fa-check"></i><b>6.2.3</b> Prior Distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:package"><i class="fa fa-check"></i><b>6.3</b> Package Structure</a></li>
<li class="chapter" data-level="6.4" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:ExampleDataJSS"><i class="fa fa-check"></i><b>6.4</b> Example Data</a><ul>
<li class="chapter" data-level="6.4.1" data-path="ch-JSS.html"><a href="ch-JSS.html#the-nhanes-data"><i class="fa fa-check"></i><b>6.4.1</b> The NHANES Data</a></li>
<li class="chapter" data-level="6.4.2" data-path="ch-JSS.html"><a href="ch-JSS.html#the-simlong-data"><i class="fa fa-check"></i><b>6.4.2</b> The simLong Data</a></li>
<li class="chapter" data-level="6.4.3" data-path="ch-JSS.html"><a href="ch-JSS.html#the-lung-data"><i class="fa fa-check"></i><b>6.4.3</b> The lung Data</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:ModelSpecification"><i class="fa fa-check"></i><b>6.5</b> Model Specification</a><ul>
<li class="chapter" data-level="6.5.1" data-path="ch-JSS.html"><a href="ch-JSS.html#interactions"><i class="fa fa-check"></i><b>6.5.1</b> Interactions</a></li>
<li class="chapter" data-level="6.5.2" data-path="ch-JSS.html"><a href="ch-JSS.html#non-linear-functional-forms"><i class="fa fa-check"></i><b>6.5.2</b> Non-linear Functional Forms</a></li>
<li class="chapter" data-level="6.5.3" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:multilevel"><i class="fa fa-check"></i><b>6.5.3</b> Multi-level Structure and Longitudinal Covariates</a></li>
<li class="chapter" data-level="6.5.4" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:survmod"><i class="fa fa-check"></i><b>6.5.4</b> Survival Models</a></li>
<li class="chapter" data-level="6.5.5" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:methJSS"><i class="fa fa-check"></i><b>6.5.5</b> Imputation / Covariate Model Types</a></li>
<li class="chapter" data-level="6.5.6" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:auxvars"><i class="fa fa-check"></i><b>6.5.6</b> Auxiliary Variables</a></li>
<li class="chapter" data-level="6.5.7" data-path="ch-JSS.html"><a href="ch-JSS.html#reference-values-for-categorical-covariates"><i class="fa fa-check"></i><b>6.5.7</b> Reference Values for Categorical Covariates</a></li>
<li class="chapter" data-level="6.5.8" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:hyperpars"><i class="fa fa-check"></i><b>6.5.8</b> Hyperparameters</a></li>
<li class="chapter" data-level="6.5.9" data-path="ch-JSS.html"><a href="ch-JSS.html#scaling"><i class="fa fa-check"></i><b>6.5.9</b> Scaling</a></li>
<li class="chapter" data-level="6.5.10" data-path="ch-JSS.html"><a href="ch-JSS.html#ridge-regression"><i class="fa fa-check"></i><b>6.5.10</b> Ridge Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:MCMCSettings"><i class="fa fa-check"></i><b>6.6</b> MCMC Settings</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ch-JSS.html"><a href="ch-JSS.html#number-of-chains-iterations-and-samples"><i class="fa fa-check"></i><b>6.6.1</b> Number of Chains, Iterations and Samples</a></li>
<li class="chapter" data-level="6.6.2" data-path="ch-JSS.html"><a href="ch-JSS.html#parameters-to-follow"><i class="fa fa-check"></i><b>6.6.2</b> Parameters to Follow</a></li>
<li class="chapter" data-level="6.6.3" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:inits"><i class="fa fa-check"></i><b>6.6.3</b> Initial Values</a></li>
<li class="chapter" data-level="6.6.4" data-path="ch-JSS.html"><a href="ch-JSS.html#parallel-sampling"><i class="fa fa-check"></i><b>6.6.4</b> Parallel Sampling</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:ResultsJSS"><i class="fa fa-check"></i><b>6.7</b> After Fitting</a><ul>
<li class="chapter" data-level="6.7.1" data-path="ch-JSS.html"><a href="ch-JSS.html#visualizing-the-posterior-sample"><i class="fa fa-check"></i><b>6.7.1</b> Visualizing the Posterior Sample</a></li>
<li class="chapter" data-level="6.7.2" data-path="ch-JSS.html"><a href="ch-JSS.html#model-summary"><i class="fa fa-check"></i><b>6.7.2</b> Model Summary</a></li>
<li class="chapter" data-level="6.7.3" data-path="ch-JSS.html"><a href="ch-JSS.html#evaluation-criteria"><i class="fa fa-check"></i><b>6.7.3</b> Evaluation Criteria</a></li>
<li class="chapter" data-level="6.7.4" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:subset"><i class="fa fa-check"></i><b>6.7.4</b> Subset of Output</a></li>
<li class="chapter" data-level="6.7.5" data-path="ch-JSS.html"><a href="ch-JSS.html#predicted-values"><i class="fa fa-check"></i><b>6.7.5</b> Predicted Values</a></li>
<li class="chapter" data-level="6.7.6" data-path="ch-JSS.html"><a href="ch-JSS.html#sec:getMIdat"><i class="fa fa-check"></i><b>6.7.6</b> Export of Imputed Values</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="ch-JSS.html"><a href="ch-JSS.html#assumptions-and-extensions"><i class="fa fa-check"></i><b>6.8</b> Assumptions and Extensions</a></li>
<li class="chapter" data-level="" data-path="ch-JSS.html"><a href="ch-JSS.html#appendix-4"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="ch-JSS.html"><a href="ch-JSS.html#a-default-hyperparameters"><i class="fa fa-check"></i>6.A Default Hyperparameters</a></li>
<li class="chapter" data-level="" data-path="ch-JSS.html"><a href="ch-JSS.html#b-density-plot-using-ggplot2"><i class="fa fa-check"></i>6.B Density Plot using ggplot2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-discussion.html"><a href="ch-discussion.html"><i class="fa fa-check"></i><b>7</b> General Discussion</a><ul>
<li class="chapter" data-level="7.1" data-path="ch-discussion.html"><a href="ch-discussion.html#summary-of-advantages"><i class="fa fa-check"></i><b>7.1</b> Summary of Advantages</a></li>
<li class="chapter" data-level="7.2" data-path="ch-discussion.html"><a href="ch-discussion.html#assumptions"><i class="fa fa-check"></i><b>7.2</b> Assumptions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ch-discussion.html"><a href="ch-discussion.html#model-specification"><i class="fa fa-check"></i><b>7.2.1</b> Model Specification</a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-discussion.html"><a href="ch-discussion.html#ignorable-missingness"><i class="fa fa-check"></i><b>7.2.2</b> Ignorable Missingness</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-discussion.html"><a href="ch-discussion.html#directions-for-future-work"><i class="fa fa-check"></i><b>7.3</b> Directions for Future Work</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ch-discussion.html"><a href="ch-discussion.html#implementation-of-flexible-models"><i class="fa fa-check"></i><b>7.3.1</b> Implementation of Flexible Models</a></li>
<li class="chapter" data-level="7.3.2" data-path="ch-discussion.html"><a href="ch-discussion.html#evaluation-of-model-fit"><i class="fa fa-check"></i><b>7.3.2</b> Evaluation of Model Fit</a></li>
<li class="chapter" data-level="7.3.3" data-path="ch-discussion.html"><a href="ch-discussion.html#non-ignorable-missingness"><i class="fa fa-check"></i><b>7.3.3</b> Non-ignorable Missingness</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ch-discussion.html"><a href="ch-discussion.html#conclusion"><i class="fa fa-check"></i><b>7.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="summary-samenvatting-zusammenfassung.html"><a href="summary-samenvatting-zusammenfassung.html"><i class="fa fa-check"></i><b>8</b> Summary / Samenvatting / Zusammenfassung</a><ul>
<li class="chapter" data-level="" data-path="summary-samenvatting-zusammenfassung.html"><a href="summary-samenvatting-zusammenfassung.html#summary"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="summary-samenvatting-zusammenfassung.html"><a href="summary-samenvatting-zusammenfassung.html#samenvatting"><i class="fa fa-check"></i>Samenvatting</a></li>
<li class="chapter" data-level="" data-path="summary-samenvatting-zusammenfassung.html"><a href="summary-samenvatting-zusammenfassung.html#zusammenfassung"><i class="fa fa-check"></i>Zusammenfassung</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html"><i class="fa fa-check"></i>Appendix: PhD Portfolio &amp; Curriculum Vitae</a><ul>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#phd-portfolio"><i class="fa fa-check"></i>PhD Portfolio</a><ul>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#presentations"><i class="fa fa-check"></i>Presentations</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#teaching"><i class="fa fa-check"></i>Teaching</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#courses"><i class="fa fa-check"></i>Courses</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#seminars-and-workshops"><i class="fa fa-check"></i>Seminars and Workshops</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#consulting"><i class="fa fa-check"></i>Consulting</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#curriculum-vitae"><i class="fa fa-check"></i>Curriculum Vitae</a><ul>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#education"><i class="fa fa-check"></i>Education</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#work-experience"><i class="fa fa-check"></i>Work Experience</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#awards"><i class="fa fa-check"></i>Awards</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#collaborations-and-consulting"><i class="fa fa-check"></i>Collaborations and Consulting</a></li>
<li class="chapter" data-level="" data-path="appendix-phd-portfolio-curriculum-vitae.html"><a href="appendix-phd-portfolio-curriculum-vitae.html#publications"><i class="fa fa-check"></i>Publications</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Imputation of Missing Covariates</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch:JSS" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> JointAI: Joint Analysis and Imputation of Incomplete Data in R</h1>

<hr />
<p>This chapter is based on</p>
<blockquote>
<p>Nicole S. Erler, Dimitris Rizopoulos and Emmanuel M. E. H. Lesaffre.
JointAI: Joint Analysis and Imputation of Incomplete Data in R.
(Manuscript in preparation)</p>
</blockquote>



<div id="abstract-4" class="section level3 unnumbered">
<h3>Abstract</h3>
<p>Missing data occur in many types of studies and typically complicate the analysis.
Multiple imputation, either using joint modelling or the more flexible
full conditional specification approach, is popular and works well in standard
settings. However, in settings involving non-linear associations
or interactions, incompatibility of the imputation model with the analysis model
is an issue often resulting in bias. Similarly, complex outcomes such as
longitudinal or survival outcomes cannot be adequately handled by standard
implementations.</p>
<p>In this chapter, we introduce the R package <strong>JointAI</strong>,
which utilizes the Bayesian framework to perform simultaneous analysis and
imputation in regression models with incomplete covariates.
Using a fully Bayesian joint modelling approach it overcomes the issue
of uncongeniality while retaining the attractive
flexibility of fully conditional specification multiple imputation
by specifying the joint distribution of analysis and imputation models
as a sequence of univariate models that can be adapted to the type of variable.
<strong>JointAI</strong> provides functions for Bayesian inference with generalized linear
and generalized linear mixed models as well as survival models, that take
arguments analogous to their corresponding and well known complete data versions
from base R and other packages.
Usage and features of <strong>JointAI</strong> are described and illustrated using various
examples and the theoretical background is outlined.</p>

</div>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">6.1</span> Introduction</h2>
<p>Missing data are a challenge common to the analysis of data from virtually all
kinds of studies. Especially when many variables are measured, as in big cohort
studies, or when data are obtained retrospectively, e.g., from registries,
proportions of missing values up to 50% are not uncommon in some variables.</p>
<p>Multiple imputation, which is often considered the
gold standard to handle incomplete data, has its origin in the 1970s and was
primarily developed for survey data <span class="citation">(Rubin <a href="#ref-Rubin1987" role="doc-biblioref">1987</a>, <a href="#ref-rubin_design_2004" role="doc-biblioref">2004</a>)</span>.
One of its first implementations in R <span class="citation">(R Core Team <a href="#ref-R2018" role="doc-biblioref">2018</a>)</span> is the package
<strong>norm</strong> <span class="citation">(Novo and Schafer <a href="#ref-norm" role="doc-biblioref">2010</a>)</span>, which performs multiple imputation under the joint
modelling framework using a multivariate normal distribution <span class="citation">(Schafer <a href="#ref-Schafer1997" role="doc-biblioref">1997</a>)</span>.
Nowadays, multiple imputation using a fully conditional specification
(FCS), also called multiple imputation using chained equations (MICE),
and its seminal implementation in the R package <strong>mice</strong> <span class="citation">(Van Buuren and Groothuis-Oudshoorn <a href="#ref-mice" role="doc-biblioref">2011</a>; Van Buuren <a href="#ref-Buuren2012" role="doc-biblioref">2012</a>)</span>,
is more frequently used.</p>
<p>Datasets have gotten more complex compared to the survey data multiple
imputation was developed for. Therefore, more sophisticated
methods that can adequately handle the features of modern data and comply with
the assumptions made in its analysis are required.
Modern studies do not only record univariate outcomes, measured in
cross-sectional settings, but outcomes that consist of two or more measurements,
such as repeatedly measured or survival outcomes.
Furthermore, non-linear effects, introduced by functions of covariates, such as
transformations, polynomials or splines, or interactions between variables are
considered in the analysis and hence need to be taken into account during
imputation.</p>
<p>Standard multiple imputation, either using FCS or a joint modelling approach,
e.g., under a multivariate normal distribution, assumes linear associations
between all variables.
Moreover, FCS requires the outcome to be explicitly specified in each of the
linear predictors of the full conditional distributions.
In settings where the outcome is more complex than just univariate, this is not
straightforward and not generally possible without information loss, leading to
misspecified imputation models.</p>
<p>Some extensions of standard multiple imputation have been developed and are
implemented in R packages and other software, but the larger part of
software for imputation is restricted to standard settings such as
cross-sectional survey data. R packages that offer extensions frequently
focus on particular settings and researchers need to be familiar with a number
of different packages, which often require input and specifications in very
different forms. Moreover, most R packages dealing with incomplete data
implement multiple imputation, i.e., create
multiple imputed datasets, which are then analysed in a second step,
followed by pooling of the results.</p>
<p>The R package <strong>JointAI</strong> <span class="citation">(Erler <a href="#ref-JointAI" role="doc-biblioref">2019</a>)</span>,
which is presented in this chapter, follows a different, fully Bayesian approach.
It provides a unified framework for both simple and more complex models, using
a consistent specification most users will be familiar with from commonly used
(base) R functions.
By modelling the analysis model of interest jointly with the incomplete covariates,
analysis and imputation can be performed simultaneously while assuring
compatibility between all sub-models <span class="citation">(Erler et al. <a href="#ref-Erler2016" role="doc-biblioref">2016</a>, <a href="#ref-Erler2017" role="doc-biblioref">2019</a>)</span>.
In this joint modelling approach, the added uncertainty due to the missing values
is automatically taken into account in the posterior distribution of the
parameters of interest, and no pooling of results from repeated analyses is necessary.
The joint distribution is specified in a convenient way, using a sequence of
conditional distributions that can be specified flexibly according to each type
of variable. Since the analysis model of interest defines the first distribution
in the sequence, the outcome is included in the joint distribution without the
need for it to enter the linear predictor of any of the other models.
Moreover, non-linear associations that are part of the analysis model are
automatically taken into account for the imputation of missing values.
This directly enables our approach to handle complicated models, with complex
outcomes and flexible linear predictors.</p>
<p>In the following, we introduce the R package <strong>JointAI</strong>, which performs
joint analysis and imputation of regression models with incomplete covariates
under the Missing At Random assumption <span class="citation">(Rubin <a href="#ref-Rubin1976" role="doc-biblioref">1976</a>)</span>, and explain
how data with incomplete covariate information can be analysed and imputed with
it. The package is available for download at the Comprehensive R Archive Network (CRAN)
under <a href="https://CRAN.R-project.org/package=JointAI">https://CRAN.R-project.org/package=JointAI</a>.
Section <a href="ch-JSS.html#sec:TheoryJSS">6.2</a> briefly describes the theoretical background.
An outline of the general structure of <strong>JointAI</strong> is given in Section <a href="ch-JSS.html#sec:package">6.3</a>,
followed by an introduction to example datasets that are used throughout this
chapter, in Section <a href="ch-JSS.html#sec:ExampleDataJSS">6.4</a>.
Details about model specification, settings controlling the Markov Chain
Monte Carlo sampling, and summary, plotting and other functions that can be
applied after fitting the model are given in Sections <a href="ch-JSS.html#sec:ModelSpecification">6.5</a> through <a href="ch-JSS.html#sec:ResultsJSS">6.7</a>.
We conclude the paper with an outlook of planned
extensions and discuss the limitations that are introduced by the assumptions
made in the sequential imputation approach.</p>
</div>
<div id="sec:TheoryJSS" class="section level2">
<h2><span class="header-section-number">6.2</span> Theoretical Background</h2>
<p>Consider the general setting of a regression model where interest lies in a set
of parameters <span class="math inline">\(\boldsymbol\theta\)</span> that describe the association between a univariate outcome
<span class="math inline">\(\mathbf y\)</span> and a set of covariates <span class="math inline">\(\mathbf X = (\mathbf x_1, \ldots, \mathbf x_p)\)</span>.
In the Bayesian framework, inference over <span class="math inline">\(\boldsymbol\theta\)</span> is obtained
by estimation of the posterior distribution of <span class="math inline">\(\boldsymbol\theta\)</span>, which is proportional
to the product of the likelihood of the data <span class="math inline">\((\mathbf y, \mathbf X)\)</span>
and the prior distribution of <span class="math inline">\(\boldsymbol\theta\)</span>,
<span class="math display">\[ p(\boldsymbol\theta\mid \mathbf y, \mathbf X) \propto
p(\mathbf y, \mathbf X \mid \boldsymbol\theta)\,p(\boldsymbol\theta).\]</span></p>
<p>When some of the covariates are incomplete, <span class="math inline">\(\mathbf X\)</span> consists of two parts,
the completely observed variables <span class="math inline">\(\mathbf X_{obs}\)</span> and those variables
that are incomplete, <span class="math inline">\(\mathbf X_{mis}\)</span>.
If <span class="math inline">\(\mathbf y\)</span> had missing values (and this missingness was ignorable),
the only necessary change in the formulas below
would be to replace <span class="math inline">\(\mathbf y\)</span> by <span class="math inline">\(\mathbf y_{mis}\)</span>.
We will, therefore, without loss of generality, consider <span class="math inline">\(\mathbf y\)</span> to be
completely observed.</p>
<p>The likelihood of the complete data, i.e., observed and unobserved,
can be factorized in the following convenient way:
<span class="math display">\[p(\mathbf y, \mathbf X_{obs}, \mathbf X_{mis} \mid \boldsymbol\theta) =
p(\mathbf y \mid \mathbf X_{obs}, \mathbf X_{mis}, \boldsymbol\theta_{y\mid x})\,
p(\mathbf X_{mis} \mid \mathbf X_{obs}, \boldsymbol\theta_x),
\]</span>
where the first factor constitutes the analysis model of interest,
described by a vector of parameters <span class="math inline">\(\boldsymbol\theta_{y\mid x}\)</span>, and the second
factor is the joint distribution of the incomplete variables,
i.e., the imputation part of the model,
described by parameters <span class="math inline">\(\boldsymbol\theta_x\)</span>, and
<span class="math inline">\(\boldsymbol\theta = (\boldsymbol\theta_{y\mid x}^\top, \boldsymbol\theta_x^\top)^\top\)</span>.</p>
<p>Explicitly specifying the joint distribution of all
data is one of the major advantages of the Bayesian approach,
since this facilitates the use of all available information
of the outcome in the imputation of the incomplete covariates <span class="citation">(Erler et al. <a href="#ref-Erler2016" role="doc-biblioref">2016</a>)</span>,
which becomes especially relevant for more complex outcomes such as repeatedly
measured variables (see Section <a href="ch-JSS.html#imputation-part">6.2.2</a>).</p>
<p>In complex models, the posterior distribution can usually not be analytically
derived but Markov Chain Monte Carlo (MCMC) methods are used to obtain samples
from the posterior distribution.
The MCMC sampling in <strong>JointAI</strong> is done using Gibbs sampling,
which iteratively samples from the full conditional distributions of the unknown
parameters and missing values.</p>
<p>In the following sections, we describe each of the three parts of the model,
the analysis model, the imputation part and the prior distributions, in detail.</p>
<div id="sec:AnalysisModel" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Analysis Model</h3>
<p>The analysis model of interest is described by the probability density function
<span class="math inline">\(p(\mathbf y \mid \mathbf X, \boldsymbol\theta_{y\mid x})\)</span>.
The R package <strong>JointAI</strong> can currently handle analysis models that are
either generalized linear regression models (GLM),
(generalized) linear mixed models (GLMM),
cumulative logit (mixed) models, parametric (Weibull) survival
models or Cox proportional hazards models.</p>
<p>For a GLM, the probability density function is chosen from the exponential family
and the model has the linear predictor
<span class="math display">\[g(E(y_i\mid \mathbf X, \boldsymbol\theta_{y\mid x})) = \mathbf x_i^\top\boldsymbol\beta,\]</span>
where <span class="math inline">\(g(\cdot)\)</span> is a link function, <span class="math inline">\(y_i\)</span> the value of the outcome variable
for subject <span class="math inline">\(i\)</span>, and <span class="math inline">\(\mathbf x_i\)</span> is the row of <span class="math inline">\(\mathbf X\)</span> that contains the covariate
information for <span class="math inline">\(i\)</span>.</p>
<p>For a GLMM the linear predictor is of the form
<span class="math display">\[g(E(y_{ij}\mid \mathbf X, \mathbf b_i, \boldsymbol\theta_{y\mid x})) = \mathbf x_{ij}^\top\boldsymbol\beta + z_{ij}^\top\mathbf b_i,\]</span>
where <span class="math inline">\(y_{ij}\)</span> is the <span class="math inline">\(j\)</span>-th outcome of subject <span class="math inline">\(i\)</span>, <span class="math inline">\(\mathbf x_{ij}\)</span> is the
corresponding vector of covariate values, <span class="math inline">\(\mathbf b_i\)</span> a vector of random effects
pertaining to subject <span class="math inline">\(i\)</span>,
and <span class="math inline">\(\mathbf z_{ij}\)</span> the row of the design matrix of the random effects, <span class="math inline">\(\mathbf Z\)</span>,
that corresponds to the <span class="math inline">\(j\)</span>-th measurement of subject <span class="math inline">\(i\)</span>.
<span class="math inline">\(\mathbf Z\)</span> typically contains a subset of the variables in <span class="math inline">\(\mathbf X\)</span>, and
<span class="math inline">\(\mathbf b_i\)</span> follows a normal distribution with mean zero and covariance matrix
<span class="math inline">\(\mathbf D\)</span>.</p>
<p>In both cases the parameter vector <span class="math inline">\(\boldsymbol\theta_{y\mid x}\)</span> contains the
regression coefficients <span class="math inline">\(\boldsymbol\beta\)</span>, and potentially additional variance
parameters (e.g., for linear (mixed) models), for which prior distributions
will be specified in Section <a href="ch-JSS.html#sec:priors">6.2.3</a>.</p>
<p>Cumulative logit mixed models are of the form
<span class="math display">\[\begin{eqnarray*}
y_{ij} &amp;\sim&amp; \text{Multinom}(\pi_{ij,1}, \ldots, \pi_{ij,K}),\\[2ex]
\pi_{ij,1} &amp;=&amp; P(y_{ij} \leq 1),\\
\pi_{ij,k} &amp;=&amp; P(y_{ij} \leq k) - P(y_{ij} \leq k-1), \quad k \in 2, \ldots, K-1,\\
\pi_{ij,K} &amp;=&amp; 1 - \sum_{k = 1}^{K-1}\pi_{ij,k},\\[2ex]
\text{logit}(P(y_{ij} \leq k)) &amp;=&amp; \gamma_k + \eta_{ij}, \quad k \in 1,\ldots,K,\\
\eta_{ij} &amp;=&amp; x_{ij}^\top\boldsymbol\beta + z_{ij}^\top\mathbf b_i,\\[2ex]
\gamma_1,\delta_1,\ldots,\delta_{K-1} &amp;\overset{iid}{\sim}&amp; N(\mu_\gamma, \sigma_\gamma^2),\\
\gamma_k &amp;\sim&amp; \gamma_{k-1} + \exp(\delta_{k-1}),\quad k = 2,\ldots,K,
\end{eqnarray*}\]</span>
where <span class="math inline">\(\pi_{ij,k} = P(y_{ij} = k)\)</span> and <span class="math inline">\(\text{logit}(x) = \log\left(\frac{x}{1-x}\right)\)</span>.
A cumulative logit regression model for a univariate outcome <span class="math inline">\(y_i\)</span> can be
obtained by dropping the index <span class="math inline">\(j\)</span> and omitting <span class="math inline">\(z_{ij}^\top\mathbf b_i\)</span>.
In cumulative logit (mixed) models, the design matrix <span class="math inline">\(\mathbf X\)</span> does not contain
an intercept, since outcome category specific intercepts <span class="math inline">\(\gamma_1,\ldots, \gamma_K\)</span>
are specified. Here, the parameter vector <span class="math inline">\(\boldsymbol \theta_{y\mid x}\)</span> includes
the regression coefficients <span class="math inline">\(\boldsymbol\beta\)</span>, and the first intercept <span class="math inline">\(\gamma_1\)</span>
and increments <span class="math inline">\(\delta_1, \ldots, \delta_{K-1}\)</span>.</p>
<p>Survival data are typically characterized by the observed event or censoring times,
<span class="math inline">\(T_i\)</span>, and the event indicator, <span class="math inline">\(D_i\)</span>, which is equal to one if the event was observed
and zero otherwise.
<strong>JointAI</strong> provides two types of models to analyse right censored survival data,
a parametric model assuming a Weibull distribution for the true
(but partially unobserved) survival times <span class="math inline">\(T^*\)</span>, and a semi-parametric
Cox proportional hazards model.</p>
<p>The parametric survival model is implemented as
<span class="math display">\[\begin{eqnarray*}
T_i^* &amp;\sim&amp; \text{Weibull}(1, r_i, s),\\
D_i &amp;\sim&amp; \unicode{x1D7D9}(T_i^* \geq C_i),\\
\log(r_j) &amp;=&amp; - \mathbf x_i^\top\boldsymbol\beta,\\
s &amp;\sim&amp; \text{Exp}(0.01),
\end{eqnarray*}\]</span>
where
<span class="math inline">\(\unicode{x1D7D9}\;\)</span>
is the indicator function which is one if <span class="math inline">\(T_i^* \geq C_i\)</span>, and
zero otherwise.</p>
<p>For the Cox proportional hazards model, following <span class="citation">Lunn et al. (<a href="#ref-Lunn2012" role="doc-biblioref">2012</a>)</span>,
a counting process representation is
implemented, where the baseline hazard is assumed to be piecewise constant and
changes only at observed event times.
Let <span class="math inline">\(\{N_i(t), t \geq 0\}\)</span> be an event counting process for individual <span class="math inline">\(i\)</span>,
where <span class="math inline">\(N_i(t) = 0\)</span> until the individual experiences an event and increases by
one at the time of the event.
<span class="math inline">\(dN_i(t)\)</span> then denotes the change in <span class="math inline">\(N_i(t)\)</span> in the interval <span class="math inline">\([t, t+dt)\)</span>,
where <span class="math inline">\(dt\)</span> is the length of that interval,
and can be modelled as a Poisson random variable with time-varying intensity
<span class="math inline">\(\lambda_i(t)\)</span>.
This intensity depends on covariates <span class="math inline">\(\mathbf x_i\)</span>, the baseline hazard
<span class="math inline">\(\lambda_0(t)\)</span>, and the risk set indicator <span class="math inline">\(R_i(t)\)</span>,
which is equal to one if, at time <span class="math inline">\(t\)</span>, subject <span class="math inline">\(i\)</span> is at risk for an event, and
zero otherwise.
<span class="math display">\[\begin{eqnarray*}
dN(t)_i &amp;\sim&amp; \text{Poisson}(\lambda_i(t)),\quad t \in 0,\ldots, T\\
\lambda_i(t) &amp;=&amp; \exp(\mathbf x_i^\top\boldsymbol\beta) \; \lambda_0(t) \; R_i(t)\\
\lambda_0(t) &amp;\sim&amp; \text{Gamma}(c\lambda_0(t)^*, c)
\end{eqnarray*}\]</span>
where <span class="math inline">\(\lambda_0(t)^*\)</span> is a prior guess of the failure rate at time <span class="math inline">\(t\)</span>, and <span class="math inline">\(c\)</span>
represents the confidence about that prior guess.</p>
</div>
<div id="imputation-part" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Imputation Part</h3>
<p>A convenient way to specify the joint distribution of the incomplete covariates
<span class="math inline">\(\mathbf X_{mis} = (\mathbf x_{mis_1}, \ldots, \mathbf x_{mis_q})\)</span> is to use
a sequence of conditional univariate distributions <span class="citation">(Erler et al. <a href="#ref-Erler2016" role="doc-biblioref">2016</a>; Ibrahim, Chen, and Lipsitz <a href="#ref-Ibrahim2002" role="doc-biblioref">2002</a>)</span>
<span class="math display" id="eq:factorizati\tag{6.1}ay}(#eq:factorizationJSS)
p(\mathbf x_{mis_1}, \ldots, \mathbf x_{mis_q} \mid \mathbf X_{obs}, \boldsymbol\theta_{x})
&amp; = &amp; p(\mathbf x_{mis_1} \mid \mathbf X_{obs}, \boldsymbol\theta_{x_1})\\\nonumber
&amp;   &amp; \prod_{\ell=2}^q p(\mathbf x_{mis_{\ell}} \mid \mathbf X_{obs}, \mathbf x_{mis_1},
\ldots, \mathbf x_{mis_{\ell-1}}, \boldsymbol\theta_{x_\ell}),
\end{eqnarray}\]</span>
with <span class="math inline">\(\boldsymbol\theta_{x} = (\boldsymbol\theta_{x_1}^\top, \ldots, \boldsymbol\theta_{x_q}^\top)^\top\)</span>.</p>
<p>Each of the conditional distributions is a member of the exponential family,
extended with distributions for ordinal categorical variables,
and chosen according to the type of the respective variable.
Its linear predictor is
<span class="math display">\[
g_\ell\left\{E\left(x_{i,mis_\ell} \mid \mathbf x_{i,obs},
\mathbf x_{i, mis_{&lt;\ell}},
\boldsymbol\theta_{x_\ell}\right)
\right\} = (\mathbf x_{i, obs}^\top, x_{i, mis_1},
\ldots, x_{i, mis_{\ell-1}}) \boldsymbol\alpha_{\ell},
\]</span>
for <span class="math inline">\(\ell=1,\ldots,q\)</span>,
where <span class="math inline">\(\mathbf x_{i,mis_{&lt;\ell}} = (x_{i,mis_1}, \ldots, x_{i,mis_{\ell-1}})^\top\)</span>.</p>
<p>Factorization of the joint distribution of the covariates in such a sequence
yields a straightforward specification of the joint distribution, even when the
covariates are of mixed type.</p>
<p>Missing values in the covariates are sampled from their full conditional
distributions that can be derived from the full joint distribution of outcome
and covariates.</p>
<p>When, for instance, the analysis model is a GLM, the full conditional distribution of an incomplete
covariate <span class="math inline">\(x_{i, mis_{\ell}}\)</span> can be written as
<span class="math display" id="eq:fullcond">\[\begin{eqnarray}
p(x_{i, mis_{\ell}} \mid \mathbf y_i, \mathbf x_{i,obs},
                         \mathbf x_{i,mis_{-\ell}}, \boldsymbol\theta) 
&amp; \propto&amp;  p \left(y_i \mid \mathbf x_{i, obs}, \mathbf x_{i, mis},
                                 \boldsymbol\theta_{y\mid x}
            \right)\,
            p(\mathbf x_{i, mis}\mid \mathbf x_{i, obs}, \boldsymbol\theta_{x})\\
&amp; &amp; p(\boldsymbol\theta_{y\mid x})\, p(\boldsymbol\theta_{x})\\\nonumber
&amp;\propto&amp;   p\left(y_i \mid \mathbf x_{i, obs}, \mathbf x_{i, mis},
                          \boldsymbol\theta_{y\mid x}
            \right)\,
            p(x_{i, mis_\ell} \mid \mathbf x_{i, obs}, \mathbf x_{i, mis_{&lt;\ell}}, \boldsymbol\theta_{x_\ell})\\ 
&amp;  &amp;\left\{\prod_{k=\ell+1}^q p(x_{i,mis_k}\mid \mathbf x_{i, obs},
                                                  \mathbf x_{i, mis_{&lt;k}},
                                                  \boldsymbol\theta_{x_k})
            \right\}\,
           p(\boldsymbol\theta_{y\mid x}) p(\boldsymbol\theta_{x_\ell})\\
&amp; &amp; \prod_{k=\ell+1}^p \, p(\boldsymbol\theta_{x_k}),\tag{6.2}
\end{eqnarray}\]</span>
where <span class="math inline">\(\boldsymbol\theta_{x_{\ell}}\)</span> is the vector of parameters describing the model
for the <span class="math inline">\(\ell\)</span>-th covariate, and contains the vector of regression coefficients
and potentially additional (variance) parameters.
The product of distributions enclosed by curly brackets represents the
distributions of those covariates that have <span class="math inline">\(x_{mis_\ell}\)</span> as a predictive
variable in the specification of the sequence in <a href="#eq:factorizationJSS">(6.1)</a>.</p>
<p>Even though <a href="ch-JSS.html#eq:fullcond">(6.2)</a> describes the actual imputation model,
i.e., the distribution the imputed values for <span class="math inline">\(x_{i, mis_{\ell}}\)</span> are sampled from,
we will use the term “imputation model” for the conditional distribution
of <span class="math inline">\(x_{i, mis_{\ell}}\)</span> from <a href="#eq:factorizationJSS">(6.1)</a>, since the latter is
the distribution that is explicitly specified by the user and, hence, of more
relevance when using <strong>JointAI</strong>.</p>
<div id="imputation-with-longitudinal-outcomes" class="section level4 unnumbered">
<h4>Imputation with Longitudinal Outcomes</h4>
<p>Factorizing the joint distribution into the analysis model and imputation part
allows a straightforward extension to settings with more complex outcomes,
such as repeatedly measured outcomes.
In the case where the analysis model is a GLMM, the conditional distribution of
the outcome in <a href="ch-JSS.html#eq:fullcond">(6.2)</a>,
<span class="math inline">\(p(y_i \mid \mathbf x_{i, obs}, \mathbf x_{i, mis}, \boldsymbol\theta_{y\mid x})\)</span>,
has to be replaced by
<span class="math display" id="eq:lmmpartfull\tag{6.3}ay}(#eq:lmmpartfullcond)
\left\{\prod_{j=1}^{n_i} p \left(y_{ij} \mid \mathbf x_{i, obs},
                                             \mathbf x_{i, mis}, \mathbf b_i,
                                             \boldsymbol\theta_{y\mid x}\right)
\right\}.
\end{eqnarray}\]</span>
Since <span class="math inline">\(\mathbf y\)</span> does not appear in any of the other terms in <a href="ch-JSS.html#eq:fullcond">(6.2)</a>,
and <a href="#eq:lmmpartfullcond">(6.3)</a> can be chosen to be a model that is appropriate
for the outcome at hand, the thereby specified full conditional distribution
of <span class="math inline">\(x_{i, mis_\ell}\)</span> allows us to draw valid imputations that use all available
information on the outcome.</p>
<p>This is an important difference to standard FCS, where the full conditional
distributions used to impute missing values are specified directly, usually
as regression models, and require the outcome to be explicitly included in
the linear predictor of the imputation model. In settings with complex outcomes,
it is not clear how this should be done, and simplifications may lead to biased
results <span class="citation">(Erler et al. <a href="#ref-Erler2016" role="doc-biblioref">2016</a>)</span>.
The joint model specification utilized in <strong>JointAI</strong> overcomes this difficulty.</p>
<p>When some of the covariates are time-varying, it is convenient to specify models
for these variables at the beginning of the sequence of covariate models, so
that models for longitudinal variables have other longitudinal and baseline
covariates in their linear predictor, but longitudinal covariates do not
enter the predictors of baseline covariates.</p>
<p>Note that whenever there are incomplete baseline covariates it is necessary
to specify models for all longitudinal variables, even completely observed ones,
while models for completely observed baseline covariates can be omitted.
This becomes clear when we extend the factorized joint distribution from above
with completely and incompletely observed covariates <span class="math inline">\(s_{obs}\)</span> and <span class="math inline">\(s_{mis}\)</span>:
<span class="math display">\[\begin{multline*}
p(y_{ij} \mid \mathbf s_{ij, obs}, \mathbf s_{ij, mis},
\mathbf x_{i, obs}, \mathbf x_{i, mis}, \boldsymbol\theta_{y\mid x})\,
p(\mathbf s_{ij, mis}\mid \mathbf s_{ij, obs}, \mathbf x_{i, obs},
\mathbf x_{i, mis}, \boldsymbol\theta_{s_{mis}})\\
p(\mathbf s_{ij, obs}\mid \mathbf x_{i, obs}, \mathbf x_{i, mis},
\boldsymbol\theta_{s_{obs}})\,
p(\mathbf x_{i, mis}\mid \mathbf x_{i, obs}, \boldsymbol\theta_{x_{mis}})\,
p(\mathbf x_{i, obs} \mid \boldsymbol\theta_{x_{obs}})\\
p(\boldsymbol\theta_{y\mid x})\, p(\boldsymbol\theta_{s_{mis}}) \,
p(\boldsymbol\theta_{s_{obs}})\, p(\boldsymbol\theta_{x_{mis}}) \,
p(\boldsymbol\theta_{x_{obs}})
\end{multline*}\]</span>
Given that the parameter vectors <span class="math inline">\(\boldsymbol\theta_{x_{obs}}\)</span>,
<span class="math inline">\(\boldsymbol\theta_{x_{mis}}\)</span>, <span class="math inline">\(\boldsymbol\theta_{s_{obs}}\)</span>
and <span class="math inline">\(\boldsymbol\theta_{s_{mis}}\)</span> are a priori independent, and
<span class="math inline">\(p(\mathbf x_{i, obs} \mid \boldsymbol\theta_{x_{obs}})\)</span> is independent of
both <span class="math inline">\(\mathbf x_{i,mis}\)</span> and <span class="math inline">\(\mathbf s_{ij,mis}\)</span>, it can be excluded from the model.</p>
<p>Since <span class="math inline">\(p(\mathbf s_{ij, obs}\mid \mathbf x_{i, obs}, \mathbf x_{i, mis}, \boldsymbol\theta_{s_{obs}})\)</span>,
however, has <span class="math inline">\(\mathbf x_{i, mis}\)</span> in its linear predictor and will, hence, be
part of the full conditional distribution of <span class="math inline">\(\mathbf x_{i, mis}\)</span>, it cannot
be omitted from the model specification.</p>
</div>
<div id="non-linear-associations-and-interactions" class="section level4 unnumbered">
<h4>Non-linear Associations and Interactions</h4>
<p>Other settings in which the fully Bayesian approach employed in <strong>JointAI</strong>
has an advantage over standard FCS are settings with interaction terms that
involve incomplete covariates, or when the association of the outcome with an
incomplete covariate is non-linear.
In standard FCS such settings lead to incompatible imputation models
<span class="citation">(White, Royston, and Wood <a href="#ref-White2011" role="doc-biblioref">2011</a>; Bartlett et al. <a href="#ref-Bartlett2015" role="doc-biblioref">2015</a>)</span>.
This becomes clear when considering the following simple example
where the analysis model of interest is the linear regression
<span class="math inline">\(y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \varepsilon_i\)</span>
and <span class="math inline">\(x_i\)</span> is imputed using
<span class="math inline">\(x_i = \alpha_0 + \alpha_1 y_i + \tilde\varepsilon_i\)</span>.
While the analysis model assumes a quadratic relationship, the imputation model
assumes a linear association between <span class="math inline">\(\mathbf x\)</span> and <span class="math inline">\(\mathbf y\)</span> and
a joint distribution with these imputation and analysis models as its full
conditional distributions does not exist.
Because, in <strong>JointAI</strong>, the analysis model is a factor in the full conditional distribution
that is used to impute <span class="math inline">\(x_i\)</span>, the non-linear association is
taken into account. Furthermore, since it is the joint distribution that is
specified, and the full conditionals are derived from it, the joint distribution
is guaranteed to exist.</p>
</div>
</div>
<div id="sec:priors" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Prior Distributions</h3>
<p>Prior distributions have to be specified for all (hyper)parameters.
A common prior choice for the regression coefficients is the normal distribution
with mean zero and large variance.
In <strong>JointAI</strong> variance parameters in models for normally distributed variables are
specified as inverse-gamma distributions.</p>
<p>The covariance matrix of the random effects in a mixed model, <span class="math inline">\(\mathbf D\)</span>,
is assumed to follow an inverse-Wishart distribution where the degrees of freedom
are chosen to be equal to the dimension of the random effects and the
scale matrix is diagonal. Since the magnitude of the diagonal elements relates
to the variance of the random effects, the choice of suitable values depends on the
scale of the variable the random effect is associated with. Therefore, <strong>JointAI</strong>
uses independent gamma hyperpriors for each of the diagonal elements.
More details about the default hyperparameters and how to change them are given
in Section <a href="ch-JSS.html#sec:hyperpars">6.5.8</a> and <a href="ch-JSS.html#a-default-hyperparameters">Appendix 6.A</a>.</p>
</div>
</div>
<div id="sec:package" class="section level2">
<h2><span class="header-section-number">6.3</span> Package Structure</h2>
<p>The package <strong>JointAI</strong> has seven main functions, <code>lm_imp()</code>,
<code>glm_imp()</code>, <code>clm_imp()</code>, <code>lme_imp()</code>, <code>glme_imp()</code>, <code>clmm_imp()</code>, <code>survreg_imp()</code>
and <code>coxph_imp()</code>,
that perform regression of continuous and categorical, univariate or multi-level
data as well as right censored survival data.
Model specification is similar to that of standard regression
models in R and is described in detail in Section <a href="ch-JSS.html#sec:ModelSpecification">6.5</a>.</p>
<p>Based on the specified model formula and other arguments that are provided by
the user, <strong>JointAI</strong> does some pre-processing of the data.
It checks which variables are incomplete and/or time-varying, and identifies
their measurement level in order to specify appropriate (imputation) models.
Interactions and functional forms of variables are detected in the model formula
and corresponding design matrices for the various parts of the model are created.</p>
<p>MCMC sampling is performed by the program JAGS <span class="citation">(Plummer <a href="#ref-JAGS" role="doc-biblioref">2003</a>)</span>.
The JAGS model, data list, containing all necessary parts of the
data, and user-specified settings
for the MCMC sampling (further described in Section <a href="ch-JSS.html#sec:MCMCSettings">6.6</a>)
are passed to JAGS via the R package
<strong>rjags</strong> <span class="citation">(Plummer <a href="#ref-rjags2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>The above named main functions, from here on abbreviated as <code>*_imp()</code>,
all return an object of class <code>JointAI</code>.
Summary and plotting methods for <code>JointAI</code> objects, as well as functions
to evaluate convergence and precision of the MCMC samples, to predict from
<code>JointAI</code> objects and to export imputed values are discussed in Section <a href="ch-JSS.html#sec:ResultsJSS">6.7</a>.</p>
<p>Currently, the package works under the assumption of a Missing At Random (MAR)
missingness process <span class="citation">(Rubin <a href="#ref-Rubin1976" role="doc-biblioref">1976</a>, <a href="#ref-Rubin1987" role="doc-biblioref">1987</a>)</span>. When this assumption holds,
it is valid to exclude cases with missing values in the outcome in Bayesian
inference. Hence, our focus here is on missing covariate values. Nevertheless,
<strong>JointAI</strong> can handle missing values in the outcome; they are implicitly
imputed using the specified analysis model.</p>
</div>
<div id="sec:ExampleDataJSS" class="section level2">
<h2><span class="header-section-number">6.4</span> Example Data</h2>


<p>To illustrate the functionality of <strong>JointAI</strong> we use three
datasets that are part of this package or the package <strong>survival</strong> <span class="citation">(Therneau <a href="#ref-survival1" role="doc-biblioref">2015</a>; Terry M. Therneau and Patricia M. Grambsch <a href="#ref-survival2" role="doc-biblioref">2000</a>)</span>.
The first dataset, the <code>NHANES</code> data, contains data from a
cross-sectional cohort study,
whereas the second dataset (<code>simLong</code>) is a simulated dataset based on a
longitudinal cohort study in toddlers.
The third dataset (<code>lung</code>) contains data on survival of patients with advanced lung cancer.</p>
<div id="the-nhanes-data" class="section level3">
<h3><span class="header-section-number">6.4.1</span> The NHANES Data</h3>
<p>The <code>NHANES</code> data is a subset of observations from the 2011 – 2012 wave of
the National Health and Nutrition Examination Survey <span class="citation">(National Center for Health Statistics (NCHS) <a href="#ref-NHANES2011" role="doc-biblioref">2011</a>)</span> and
contains information on 186 men and women
between 20 and 80 years of age.
The variables contained in this dataset are</p>
<ul>
<li><code>SBP</code>: systolic blood pressure in mmHg; complete</li>
<li><code>gender</code>: <code>male</code> vs <code>female</code>; complete</li>
<li><code>age</code>: in years; complete</li>
<li><code>race</code>: 5 unordered categories; complete</li>
<li><code>WC</code>: waist circumference in cm; 1.1% missing</li>
<li><code>alc</code>: alcohol consumption; <code>&lt;1</code> drink per week vs <code>&gt;= 1</code> drink per week; 18.3% missing</li>
<li><code>educ</code>: educational level; <code>low</code> vs <code>high</code>; complete</li>
<li><code>creat</code>: creatinine concentration in mg/dL; 4.5% missing</li>
<li><code>albu</code>: albumin concentration in g/dL; 4.3% missing</li>
<li><code>uricacid</code>: uric acid concentration in mg/dL; 4.3% missing</li>
<li><code>bili</code>: bilirubin concentration in mg/dL; 4.3% missing</li>
<li><code>occup</code>: occupational status; 3 unordered categories; 15.1% missing</li>
<li><code>smoke</code>: smoking status; 3 ordered categories; 3.8% missing</li>
</ul>

<div class="figure" style="text-align: center"><span id="fig:distrplotNHANES"></span>
<img src="Dissertation_files/figure-html/distrplotNHANES-1.png" alt="Distribution of the variables in the `NHANES` data (with the
percentage of missing values given for incomplete variables)." width="100%"  />
<p class="caption">
Figure 6.1: Distribution of the variables in the <code>NHANES</code> data (with the
percentage of missing values given for incomplete variables).
</p>
</div>

<p>Figure <a href="ch-JSS.html#fig:distrplotNHANES">6.1</a> shows the distributions of all variables
in the <code>NHANES</code> data, together with the proportion of missing
values for incomplete variables, and can be obtained with the function <code>plot_all()</code>.
Arguments <code>fill</code> and <code>border</code> allow colours to change,
the number of rows and columns can be adapted using <code>nrow</code> and/or <code>ncol</code>, and
additional arguments can be passed to <code>hist()</code> and <code>barplot()</code> via <code>"..."</code>.</p>



<div class="figure" style="text-align: center"><span id="fig:mdpatternNHANES"></span>
<img src="Dissertation_files/figure-html/mdpatternNHANES-1.png" alt="Missing data pattern of the `NHANES` data." width="90%"  />
<p class="caption">
Figure 6.2: Missing data pattern of the <code>NHANES</code> data.
</p>
</div>

<p>The pattern of missing values in the <code>NHANES</code> data is shown in Figure <a href="ch-JSS.html#fig:mdpatternNHANES">6.2</a>.
Each row represents a pattern of missing values, where observed (missing)
values are depicted with dark (light) colour. The frequency with which each of
the patterns is observed is given on the right margin, the number of missing
values in each variable is given underneath the plot. Rows and columns are
ordered by the number of cases per pattern (decreasing) and the number of missing values
(increasing). The first row, for instance, shows that there are 116 complete cases,
the second row that there are 29 cases for which only <code>alc</code> is missing.
Furthermore, it is apparent that <code>creat</code>, <code>albu</code>, <code>uricacid</code> and <code>bili</code> are
always missing together.
Since these variables are all measured in serum this is not surprising.</p>
<p>The plot of the missing data pattern can be obtained with <code>md_pattern()</code>.
Again, arguments <code>color</code> and <code>border</code> allow us to change
colours, and arguments such as <code>legend.position</code>, <code>print_xaxis</code> and <code>print_yaxis</code>
permit further customization.</p>
<p>A matrix representation of the missing data pattern can be obtained by setting
<code>pattern = TRUE</code>. There, missing and observed values
are represented with a <code>"0"</code> and <code>"1"</code> respectively.</p>
</div>
<div id="the-simlong-data" class="section level3">
<h3><span class="header-section-number">6.4.2</span> The simLong Data</h3>
<p>The <code>simLong</code> data is a simulated dataset mimicking a longitudinal cohort study
of 200 mother-child pairs. It contains the following
baseline (i.e., not time-varying) covariates
</p>
<ul>
<li><code>GESTBIR</code>: gestational age at birth in weeks; complete</li>
<li><code>ETHN</code>: ethnicity; <code>European</code> vs <code>other</code>; 2.8% missing</li>
<li><code>AGE_M</code>: age of the mother at intake; complete</li>
<li><code>HEIGHT_M</code>: height of the mother in cm; 2.0% missing</li>
<li><code>PARITY</code>: number of times the mother has given birth; <code>0</code> vs <code>&gt;=1</code>; 2.4% missing</li>
<li><code>SMOKE</code>: smoking status of the mother during pregnancy; 3 ordered categories; 12.2% missing</li>
<li><code>EDUC</code>: educational level of the mother; 3 ordered categories; 7.8% missing</li>
<li><code>MARITAL</code>: marital status; 3 unordered categories; 7.0% missing</li>
<li><code>ID</code>: subject identifier</li>
</ul>
<p>and seven longitudinal variables:
</p>
<ul>
<li><code>time</code>: measurement occasion/visit
(by design children should have been measured at
1, 2, 3, 4, 7, 11, 15, 20, 26, 32, 40 and 50 months of age); complete</li>
<li><code>age</code>: child’s age at measurement time in months</li>
<li><code>hgt</code>: child’s height in cm; 20.0% missing</li>
<li><code>wgt</code>: child’s weight in gram; 8.8% missing</li>
<li><code>bmi</code>: child’s BMI (body mass index) in kg/m<sup>2</sup>; 21.6% missing</li>
<li><code>hc</code>: child’s head circumference in cm; 23.6% missing</li>
<li><code>sleep</code>: child’s sleeping behaviour; 3 ordered categories; 24.7% missing</li>
</ul>
<p>Figure <a href="ch-JSS.html#fig:trajectories">6.3</a> shows the longitudinal profiles of
<code>hgt</code>, <code>wgt</code>, <code>bmi</code> and <code>hc</code> over age.
All four variables have a non-linear pattern over time.
Distributions of all variables in the <code>simLong</code> data are displayed in
Figure <a href="ch-JSS.html#fig:distrplotsimLong">6.4</a>. Here, arguments <code>use_level</code> and <code>idvar</code>
of the function <code>plot_all()</code> are used to display baseline (level-2) covariates
on the subject level instead of the observation level:
</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="ch-JSS.html#cb5-1"></a><span class="kw">plot_all</span>(simLong, <span class="dt">use_level =</span> <span class="ot">TRUE</span>, <span class="dt">idvar =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>


<div class="figure" style="text-align: center"><span id="fig:trajectories"></span>
<img src="Dissertation_files/figure-html/trajectories-1.png" alt="Trajectories of height, weight, BMI and head circumference in the `simLong` data." width="100%"  />
<p class="caption">
Figure 6.3: Trajectories of height, weight, BMI and head circumference in the <code>simLong</code> data.
</p>
</div>


<div class="figure" style="text-align: center"><span id="fig:distrplotsimLong"></span>
<img src="Dissertation_files/figure-html/distrplotsimLong-1.png" alt="Distribution of the variables in the `simLong` data (with 
percentage of missing values given for incomplete variables)." width="100%"  />
<p class="caption">
Figure 6.4: Distribution of the variables in the <code>simLong</code> data (with
percentage of missing values given for incomplete variables).
</p>
</div>

<p>The missing data pattern of the <code>simLong</code> data is shown in Figure <a href="ch-JSS.html#fig:mdpatternsimLong">6.5</a>.
For readability, it is plotted separately for baseline (left) and longitudinal
(right) covariates.</p>


<div class="figure" style="text-align: center"><span id="fig:mdpatternsimLong"></span>
<img src="Dissertation_files/figure-html/mdpatternsimLong-1.png" alt="Missing data pattern." width="100%"  />
<p class="caption">
Figure 6.5: Missing data pattern.
</p>
</div>


</div>
<div id="the-lung-data" class="section level3">
<h3><span class="header-section-number">6.4.3</span> The lung Data</h3>
<p>For demonstration of the use of <strong>JointAI</strong> for the analysis of survival data,
we use the dataset <code>lung</code> that is included in
the R package <strong>survival</strong>. It contains data of 228 patients with
advanced lung cancer and includes the following variables:
</p>
<ul>
<li><code>inst</code>: institution code; complete</li>
<li><code>time</code>: survival time in days; complete</li>
<li><code>status</code>: event indicator (<code>1</code>: censored, <code>2</code>: dead); complete</li>
<li><code>age</code>: patient’s age in years; complete</li>
<li><code>sex</code>: male (<code>1</code>) vs female (<code>2</code>); complete</li>
<li><code>ph.ecog</code>: ECOG performance score (describes how the disease impacts the
patient’s daily life); scale from <code>0</code> (no impact) to <code>5</code> (dead); 0.4% missing</li>
<li><code>ph.karno</code>: Karnofsky performance score as rated by physician
(describes the degree of a patient’s impairment by the disease);
scale from <code>0</code> (dead) to <code>100</code> (no impairment); 0.4% missing</li>
<li><code>pat.karno</code>: Karnofsky performance score as rated by patient; 1.3% missing</li>
<li><code>meal.cal</code>: kilocalories consumed at meals; 20.6% missing</li>
<li><code>wt.loss</code>: weight loss over the last six months in kg; 6.1% missing</li>
</ul>
<p>The distribution of the observed values and the missing data pattern of the <code>lung</code>
data are shown in Figures <a href="ch-JSS.html#fig:distrplotlung">6.6</a> and <a href="ch-JSS.html#fig:mdpatternlung">6.7</a>.
</p>
<div class="figure" style="text-align: center"><span id="fig:distrplotlung"></span>
<img src="Dissertation_files/figure-html/distrplotlung-1.png" alt="Distribution of the variables in the `lung` data (with 
percentage of missing values given for incomplete variables)." width="100%"  />
<p class="caption">
Figure 6.6: Distribution of the variables in the <code>lung</code> data (with
percentage of missing values given for incomplete variables).
</p>
</div>


<div class="figure" style="text-align: center"><span id="fig:mdpatternlung"></span>
<img src="Dissertation_files/figure-html/mdpatternlung-1.png" alt="Missing data pattern of the `lung` data." width="77%"  />
<p class="caption">
Figure 6.7: Missing data pattern of the <code>lung</code> data.
</p>
</div>


</div>
</div>
<div id="sec:ModelSpecification" class="section level2">
<h2><span class="header-section-number">6.5</span> Model Specification</h2>
<p>The main arguments of the functions
</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="ch-JSS.html#cb6-1"></a><span class="kw">lm_imp</span>(formula, data, </span>
<span id="cb6-2"><a href="ch-JSS.html#cb6-2"></a>       <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-3"><a href="ch-JSS.html#cb6-3"></a></span>
<span id="cb6-4"><a href="ch-JSS.html#cb6-4"></a><span class="kw">glm_imp</span>(formula, family, data,</span>
<span id="cb6-5"><a href="ch-JSS.html#cb6-5"></a>        <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-6"><a href="ch-JSS.html#cb6-6"></a></span>
<span id="cb6-7"><a href="ch-JSS.html#cb6-7"></a><span class="kw">clm_imp</span>(formula, data,</span>
<span id="cb6-8"><a href="ch-JSS.html#cb6-8"></a>        <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-9"><a href="ch-JSS.html#cb6-9"></a></span>
<span id="cb6-10"><a href="ch-JSS.html#cb6-10"></a><span class="kw">lme_imp</span>(fixed, data, random,</span>
<span id="cb6-11"><a href="ch-JSS.html#cb6-11"></a>        <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-12"><a href="ch-JSS.html#cb6-12"></a></span>
<span id="cb6-13"><a href="ch-JSS.html#cb6-13"></a><span class="kw">glme_imp</span>(fixed, data, random, family,</span>
<span id="cb6-14"><a href="ch-JSS.html#cb6-14"></a>         <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-15"><a href="ch-JSS.html#cb6-15"></a></span>
<span id="cb6-16"><a href="ch-JSS.html#cb6-16"></a><span class="kw">clmm_imp</span>(fixed, data, random,</span>
<span id="cb6-17"><a href="ch-JSS.html#cb6-17"></a>         <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-18"><a href="ch-JSS.html#cb6-18"></a></span>
<span id="cb6-19"><a href="ch-JSS.html#cb6-19"></a><span class="kw">survreg_imp</span>(formula, data,</span>
<span id="cb6-20"><a href="ch-JSS.html#cb6-20"></a>            <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span>
<span id="cb6-21"><a href="ch-JSS.html#cb6-21"></a></span>
<span id="cb6-22"><a href="ch-JSS.html#cb6-22"></a><span class="kw">coxph_imp</span>(formula, data,</span>
<span id="cb6-23"><a href="ch-JSS.html#cb6-23"></a>          <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.adapt =</span> <span class="dv">100</span>, <span class="dt">n.iter =</span> <span class="dv">0</span>, <span class="dt">thin =</span> <span class="dv">1</span>, ...)</span></code></pre></div>

<p>i.e., <code>formula</code>, <code>data</code>, <code>family</code>, <code>fixed</code>, and <code>random</code>, are used
analogously to the specification in the standard complete data functions
<code>lm()</code> and <code>glm()</code> from package <strong>stats</strong>, <code>lme()</code> from package <strong>nlme</strong> <span class="citation">(Pinheiro et al. <a href="#ref-nlme" role="doc-biblioref">2018</a>)</span>,
and <code>survreg()</code> and <code>coxph()</code> from package <strong>survival</strong>.</p>
<p>For the description of the remaining arguments see Section <a href="ch-JSS.html#sec:MCMCSettings">6.6</a>.</p>
<p>The arguments <code>formula</code> (in <code>lm_imp()</code>, <code>glm_imp()</code> and <code>clm_imp()</code>) and <code>fixed</code>
(in <code>lme_imp()</code>, <code>glme_imp()</code> and <code>clmm_imp()</code>) take a standard two-sided <code>formula</code> object,
where an intercept is added automatically.
For the use of the argument <code>random</code>, see Section <a href="ch-JSS.html#sec:multilevel">6.5.3</a>.</p>
<p>Survival models expect the left hand side of <code>formula</code> to be a survival object
(created with the function <code>Surv()</code> from package <strong>survival</strong>;
see Section <a href="ch-JSS.html#sec:survmod">6.5.4</a>).</p>
<p>The argument <code>family</code> enables the choice of a distribution and link function
from a range of options when using <code>glm_imp()</code> or <code>glme_imp()</code>. The implemented
options are given in Table <a href="ch-JSS.html#tab:distrlink">6.1</a>.
</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:distrlink">Table 6.1: </span>Possible choices for the model <code>family</code> and <code>link</code> functions
in <code>glm_imp()</code> and <code>glme_imp()</code>}.
</caption>
<thead>
<tr>
<th style="text-align:left;">
family
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>gaussian</code>
</td>
<td style="text-align:left;">
with links: <code>identity</code>, <code>log</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>binomial</code>
</td>
<td style="text-align:left;">
with links: <code>logit</code>, <code>probit</code>, <code>log</code>, <code>cloglog</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Gamma</code>
</td>
<td style="text-align:left;">
with links: <code>identity</code>, <code>log</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>poisson</code>
</td>
<td style="text-align:left;">
with links: <code>log</code>, <code>identity</code>
</td>
</tr>
</tbody>
</table>

<div id="interactions" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Interactions</h3>
<p>In <strong>JointAI</strong>, interactions between any type of variables (observed, incomplete,
time-varying) can be handled.
When an incomplete variable is involved, the interaction term is re-calculated
within each iteration of the MCMC sampling, using the imputed values from the
current iteration. Interaction terms involving incomplete variables should
hence not be pre-calculated as an additional variable since this would lead
to inconsistent imputed values of main effect and interaction term.</p>
<p>Interactions between multiple variables can be specified using parentheses;
for higher lever interactions the <code>"^"</code> operator can be used:
</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="ch-JSS.html#cb7-1"></a>mod1a &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>(age <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat),</span>
<span id="cb7-2"><a href="ch-JSS.html#cb7-2"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">family =</span> <span class="kw">binomial</span>())</span>
<span id="cb7-3"><a href="ch-JSS.html#cb7-3"></a></span>
<span id="cb7-4"><a href="ch-JSS.html#cb7-4"></a>mod1b &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>(age <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat)<span class="op">^</span><span class="dv">3</span>,</span>
<span id="cb7-5"><a href="ch-JSS.html#cb7-5"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">family =</span> <span class="kw">binomial</span>())</span></code></pre></div>

</div>
<div id="non-linear-functional-forms" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Non-linear Functional Forms</h3>
<p>In practice, associations between outcome and covariates do not always meet
the standard assumption of linearity.
Often, assuming a logarithmic, quadratic or other non-linear effect is more
appropriate.</p>
<p>For completely observed covariates, <strong>JointAI</strong> can handle any common type of
function implemented in R, including splines, e.g., using
<code>ns()</code> or <code>bs()</code> from the package <strong>splines</strong>.
Since functions involving variables that have missing values need to be
re-calculated in each iteration of the MCMC sampling, currently, only functions
that are available in JAGS can be used for incomplete variables.
Those functions include:</p>
<ul>
<li><code>log()</code>, <code>exp()</code></li>
<li><code>sqrt()</code>, polynomials (using <code>I()</code>)</li>
<li><code>abs()</code></li>
<li><code>sin()</code>, <code>cos()</code></li>
<li>algebraic operations involving one or multiple (in)complete variables, as long
as the formula can be interpreted by JAGS.</li>
</ul>
<p>The list of functions implemented in JAGS can be found in the
JAGS user manual available at <a href="https://sourceforge.net/projects/mcmc-jags/files/Manuals/">https://sourceforge.net/projects/mcmc-jags/files/Manuals/</a>.</p>
<p>Some examples (that do not necessarily have a meaningful interpretation
or good model fit) are:
</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="ch-JSS.html#cb8-1"></a>mod2a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">abs</span>(bili <span class="op">-</span><span class="st"> </span>creat), <span class="dt">data =</span> NHANES)</span></code></pre></div>


<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="ch-JSS.html#cb9-1"></a><span class="kw">library</span>(<span class="st">&quot;splines&quot;</span>)</span>
<span id="cb9-2"><a href="ch-JSS.html#cb9-2"></a>mod2b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(bili<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(bili<span class="op">^</span><span class="dv">3</span>),</span>
<span id="cb9-3"><a href="ch-JSS.html#cb9-3"></a>                <span class="dt">data =</span> NHANES)</span></code></pre></div>


<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="ch-JSS.html#cb10-1"></a>mod2c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(creat<span class="op">/</span>albu<span class="op">^</span><span class="dv">2</span>), <span class="dt">data =</span> NHANES,</span>
<span id="cb10-2"><a href="ch-JSS.html#cb10-2"></a>                <span class="dt">trunc =</span> <span class="kw">list</span>(<span class="dt">albu =</span> <span class="kw">c</span>(<span class="fl">1e-5</span>, <span class="fl">1e5</span>)))</span>
<span id="cb10-3"><a href="ch-JSS.html#cb10-3"></a><span class="co"># (for explantion of the argument trunc see section below)</span></span></code></pre></div>


<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="ch-JSS.html#cb11-1"></a>mod2d &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>bili <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(creat) <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(albu), <span class="dt">data =</span> NHANES)</span></code></pre></div>

<p>It is also possible to nest a function in another function.
</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="ch-JSS.html#cb12-1"></a>mod2e &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">exp</span>(creat)<span class="op">/</span><span class="dv">2</span>), <span class="dt">data =</span> NHANES)</span></code></pre></div>

<div id="sec:restsupport" class="section level4">
<h4><span class="header-section-number">6.5.2.1</span> Functions with Restricted Support</h4>
<p>When a function of an incomplete variable has restricted support,
e.g., <span class="math inline">\(\log(x)\)</span> is only defined for <span class="math inline">\(x &gt; 0\)</span>,
or, as in <code>mod2c</code> from above, <code>I(creat/albu^2)</code> can not be calculated for
<code>albu = 0</code>,
the distribution used to impute that variable needs to comply
with these restrictions.
This can either be achieved by truncating the distribution, using the
argument <code>trunc</code>, or by selecting a distribution that meets the restrictions.</p>
<p><strong>Example:</strong>
When using a <span class="math inline">\(\log\)</span> transformation for the covariate <code>bili</code>, we can
use the default imputation method <code>"norm"</code> (a normal distribution) and truncate
it by specifying <code>trunc = list(bili = c(lower, upper))</code>, where <code>lower</code> and
<code>upper</code> are the smallest and largest values allowed:
</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="ch-JSS.html#cb13-1"></a>mod3a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</span>
<span id="cb13-2"><a href="ch-JSS.html#cb13-2"></a>                <span class="dt">trunc =</span> <span class="kw">list</span>(<span class="dt">bili =</span> <span class="kw">c</span>(<span class="fl">1e-5</span>, <span class="fl">1e10</span>)), <span class="dt">data =</span> NHANES)</span></code></pre></div>

<p>Truncation always requires the specification of both limits.
Since <span class="math inline">\(-\text{Inf}\)</span> and <span class="math inline">\(\text{Inf}\)</span> are not accepted, a value far enough
outside the range of the variable (here: <span class="math inline">\(1e10\)</span>) can be selected
for the second boundary of the truncation interval.</p>
<p>Alternatively, we may choose a model for the incomplete variable (using the argument <code>models</code>;
for more details see Section <a href="ch-JSS.html#sec:methJSS">6.5.5</a>)
that only imputes positive values such as a
log-normal distribution (<code>"lognorm"</code>) or a gamma distribution (<code>"gamma"</code>):
</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="ch-JSS.html#cb14-1"></a>mod3b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</span>
<span id="cb14-2"><a href="ch-JSS.html#cb14-2"></a>                <span class="dt">models =</span> <span class="kw">c</span>(<span class="dt">bili =</span> <span class="st">&#39;lognorm&#39;</span>), <span class="dt">data =</span> NHANES)</span>
<span id="cb14-3"><a href="ch-JSS.html#cb14-3"></a></span>
<span id="cb14-4"><a href="ch-JSS.html#cb14-4"></a>mod3c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</span>
<span id="cb14-5"><a href="ch-JSS.html#cb14-5"></a>                <span class="dt">models =</span> <span class="kw">c</span>(<span class="dt">bili =</span> <span class="st">&#39;gamma&#39;</span>), <span class="dt">data =</span> NHANES)</span></code></pre></div>

</div>
<div id="functions-not-available-in-r" class="section level4 unnumbered">
<h4>Functions Not Available in R</h4>
<p>It is possible to use functions that have different names in R and
JAGS, or that do exist in JAGS, but not in R,
by defining a new function in R that has the name of the function in
JAGS.</p>
<p><strong>Example</strong>:<br>
In JAGS the inverse logit transformation is defined in the function
<code>ilogit</code>. In base R, there is no function <code>ilogit</code>, but the inverse logit
is available as the distribution function of the logistic distribution <code>plogis()</code>.
Thus, we can define the function <code>ilogit()</code> as
</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="ch-JSS.html#cb15-1"></a>ilogit &lt;-<span class="st"> </span>plogis</span></code></pre></div>

<p>and use it in the model formula
</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="ch-JSS.html#cb16-1"></a>mod4a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">ilogit</span>(creat), <span class="dt">data =</span> NHANES)</span></code></pre></div>

</div>
<div id="a-note-on-what-happens-inside-jointai" class="section level4 unnumbered">
<h4>A Note on What Happens Inside JointAI</h4>
<p>When a function of a complete or incomplete variable is used in the model formula,
the main effect of that variable is automatically added as an auxiliary variable
(more on auxiliary variables in Section <a href="ch-JSS.html#sec:auxvars">6.5.6</a>),
and only the main effects are used as predictors in the imputation models.</p>
<p>In <code>mod2b</code>, for example, the spline of <code>age</code> is used as predictor for <code>SBP</code>,
but in the imputation model for <code>bili</code>, <code>age</code> enters with a linear effect.
This can be checked using the function
<code>list_models()</code>,
which prints a list of the covariate models used in a <strong>JointAI</strong> model.
Here, we are only interested in the predictor variables, and, hence,
suppress printing of information on prior distributions, regression coefficients
and other parameters by setting <code>priors</code>, <code>regcoef</code> and <code>otherpars</code> to <code>FALSE</code>:
</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ch-JSS.html#cb17-1"></a><span class="kw">list_models</span>(mod2b, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Normal imputation model for &#39;bili&#39;
## * Predictor variables: 
##   (Intercept), genderfemale, age</code></pre>

<p>When a function of a variable is specified as an auxiliary variable,
this function is used in the imputation models.
For example, in <code>mod4b</code>, waist circumference (<code>WC</code>)
is not part of the model for <code>SBP</code>, and the quadratic term <code>I(WC^2)</code> is used in
the linear predictor of the imputation model for <code>bili</code>:
</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="ch-JSS.html#cb19-1"></a>mod4b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>bili, <span class="dt">auxvars =</span> <span class="st">&quot;I(WC^2)&quot;</span>,</span>
<span id="cb19-2"><a href="ch-JSS.html#cb19-2"></a>                <span class="dt">data =</span> NHANES)</span>
<span id="cb19-3"><a href="ch-JSS.html#cb19-3"></a></span>
<span id="cb19-4"><a href="ch-JSS.html#cb19-4"></a><span class="kw">list_models</span>(mod4b, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Normal imputation model for &#39;WC&#39;
## * Predictor variables: 
##   (Intercept), age, genderfemale
## 
## Normal imputation model for &#39;bili&#39;
## * Predictor variables: 
##   (Intercept), age, genderfemale, I(WC^2)</code></pre>

<p>Incomplete variables are always imputed on their original scale, i.e.,
in <code>mod2b</code> the variable <code>bili</code> is imputed and the quadratic and cubic versions
are calculated from the imputed values.
Likewise, <code>creat</code> and <code>albu</code> in <code>mod2c</code>
are imputed separately, and <code>I(creat/albu^2)</code> is calculated from the imputed (and
observed) values.
To ensure consistency between variables, functions involving incomplete
variables should be specified as part of the model formula and not be
pre-calculated as separate variables.</p>
</div>
</div>
<div id="sec:multilevel" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Multi-level Structure and Longitudinal Covariates</h3>
<p>In multi-level models, additional to the fixed effects structure specified by
the argument <code>fixed</code>, a random effects structure needs to be provided via the
argument <code>random</code>.</p>
<p>Analogous to the specification of the argument <code>random</code> in <code>lme()</code>, it
takes a one-sided formula starting with a <code>"~"</code>, and the grouping
variable is separated by <code>"|"</code>. A random intercept is added automatically and
only needs to be specified in a random intercept only model.</p>
<p>A few examples:
</p>
<ul>
<li><code>random = ~1 | id</code>: random intercept only, with <code>id</code> as grouping variable</li>
<li><code>random = ~time | id</code>: random intercept and slope for variable <code>time</code></li>
<li><code>random = ~time + I(time^2) | id</code>: random intercept, slope and quadratic random effect for <code>time</code></li>
<li><code>random = ~time + x | id</code> random intercept, random slope for <code>time</code> and random
effect for variable <code>x</code></li>
</ul>
<p>It is possible to use splines in the random effects structure if there are no
missing values in the variables involved, e.g.:
</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="ch-JSS.html#cb21-1"></a>mod5 &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>),</span>
<span id="cb21-2"><a href="ch-JSS.html#cb21-2"></a>                <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">|</span><span class="st"> </span>ID, <span class="dt">data =</span> simLong)</span></code></pre></div>

<p>Longitudinal (“time-varying”; level-1) covariates can be used in the fixed or random
effects and will be imputed if they contain any missing values.
Currently only one level of nesting is possible.</p>
</div>
<div id="sec:survmod" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Survival Models</h3>
<p><strong>JointAI</strong> provides two functions to analyse survival data with incomplete
covariates: <code>survreg_imp()</code> and <code>coxph_imp()</code>. Analogous to the complete data
versions of these functions from the package <strong>survival</strong>, the left-hand side
of the model formula has to be a survival object specified using the function
<code>Surv()</code>.</p>
<p><strong>Example:</strong><br>
To analyse the <code>lung</code> data, we can either use a parametric Weibull model
or a Cox proportional hazards model. The <strong>survival</strong> package needs to be
loaded for the function <code>Surv()</code>.
</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="ch-JSS.html#cb22-1"></a><span class="kw">library</span>(survival)</span>
<span id="cb22-2"><a href="ch-JSS.html#cb22-2"></a>mod6a &lt;-<span class="st"> </span><span class="kw">survreg_imp</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>ph.karno <span class="op">+</span></span>
<span id="cb22-3"><a href="ch-JSS.html#cb22-3"></a><span class="st">                       </span>meal.cal <span class="op">+</span><span class="st"> </span>wt.loss, <span class="dt">data =</span> lung, <span class="dt">n.iter =</span> <span class="dv">250</span>)</span>
<span id="cb22-4"><a href="ch-JSS.html#cb22-4"></a></span>
<span id="cb22-5"><a href="ch-JSS.html#cb22-5"></a>mod6b &lt;-<span class="st"> </span><span class="kw">coxph_imp</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>ph.karno <span class="op">+</span><span class="st"> </span>meal.cal <span class="op">+</span></span>
<span id="cb22-6"><a href="ch-JSS.html#cb22-6"></a><span class="st">                     </span>wt.loss, <span class="dt">data =</span> lung, <span class="dt">n.iter =</span> <span class="dv">250</span>)</span></code></pre></div>

<p>Currently only right censored survival data and time-constant covariates
can be handled and it is not yet possible to take into account strata,
clustering or frailty terms.</p>
</div>
<div id="sec:methJSS" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Imputation / Covariate Model Types</h3>
<p><strong>JointAI</strong> automatically selects an (imputation) model for each of the
incomplete baseline (level-2) or longitudinal (level-1) covariates,
based on the <code>class</code> of the variable and the number of levels.
The automatically selected types for baseline covariates are:</p>
<ul>
<li><code>norm</code>: linear model (default for continuous variables)</li>
<li><code>logit</code>: binary logistic model (default for factors with two levels)</li>
<li><code>multilogit</code>: multinomial logit model (default for unordered factors with <span class="math inline">\(&gt;2\)</span> levels)</li>
<li><code>cumlogit</code>: cumulative logit model (default for ordered factors with <span class="math inline">\(&gt;2\)</span> levels)</li>
</ul>
<p>The default methods for longitudinal covariates are:</p>
<ul>
<li><code>lmm</code>: linear mixed model (default for continuous longitudinal variables)</li>
<li><code>glmm_logit</code>: logistic mixed model (default for longitudinal factors with two levels)</li>
<li><code>clmm</code>: cumulative logit mixed model (default for longitudinal ordered factors with &gt;2 levels)</li>
</ul>
<p>When a continuous variable has only two different values,
it is automatically converted to a factor and imputed using a logistic model,
unless an imputation model type is specified by the user. Variables of type
<code>logical</code> are automatically converted to binary factors.</p>
<p>The imputation models that are chosen by default may not necessarily be
appropriate for the data at hand, especially for continuous variables, which often
do not comply with the assumptions of (conditional) normality.</p>
<p>Therefore, the following alternative imputation methods are available for
continuous baseline covariates:
</p>
<ul>
<li><code>lognorm</code>: normal model for the log-transformed variable (right-skewed variables <span class="math inline">\(&gt;0\)</span>)</li>
<li><code>gamma</code>: gamma model with log-link (right-skewed variables <span class="math inline">\(&gt;0\)</span>)</li>
<li><code>beta</code>: beta model with logit-link (continuous variables in <span class="math inline">\([0, 1]\)</span>)</li>
</ul>
<p><code>lognorm</code> assumes a (conditional) normal distribution for the natural logarithm
of the variable, but the variable enters the linear predictor of the analysis
model (and possibly other imputation models) on its original scale.</p>
<p>For longitudinal covariates the following alternative model types are available:</p>
<ul>
<li><code>glmm_gamma</code>: gamma mixed model with log-link (right-skewed variables <span class="math inline">\(&gt;0\)</span>)</li>
<li><code>glmm_poisson</code>: Poisson mixed model with log-link (count variables)</li>
</ul>
<div id="specification-of-imputationcovariate-model-types" class="section level4 unnumbered">
<h4>Specification of Imputation/Covariate Model Types</h4>
<p>In models <code>mod3b</code> and <code>mod3c</code> in Section <a href="ch-JSS.html#sec:restsupport">6.5.2.1</a> we have already
seen two examples in which the imputation model type was changed using the
argument <code>models</code>, which takes a named vector.
When the vector supplied to <code>models</code> only contains specifications for a subset
of the incomplete and longitudinal covariates, default models
are used for the remaining covariates.
As explained in Section <a href="ch-JSS.html#imputation-part">6.2.2</a>, models for completely observed
longitudinal covariates only need to be specified when any baseline
covariates have missing values.</p>

<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="ch-JSS.html#cb23-1"></a>mod7a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>bili <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</span>
<span id="cb23-2"><a href="ch-JSS.html#cb23-2"></a>                <span class="dt">models =</span> <span class="kw">c</span>(<span class="dt">WC =</span> <span class="st">&#39;gamma&#39;</span>, <span class="dt">bili =</span> <span class="st">&#39;lognorm&#39;</span>),</span>
<span id="cb23-3"><a href="ch-JSS.html#cb23-3"></a>                <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">100</span>)</span>
<span id="cb23-4"><a href="ch-JSS.html#cb23-4"></a></span>
<span id="cb23-5"><a href="ch-JSS.html#cb23-5"></a>mod7a<span class="op">$</span>models</span></code></pre></div>
<pre><code>##           WC        smoke         bili        occup          alc 
##      &quot;gamma&quot;   &quot;cumlogit&quot;    &quot;lognorm&quot; &quot;multilogit&quot;      &quot;logit&quot;</code></pre>

<p>The function <code>get_models()</code>, which finds and assigns the default imputation
methods, can be called directly.
<code>get_models()</code> has arguments </p>
<ul>
<li><code>fixed</code>: the fixed effects formula</li>
<li><code>random</code>: the random effects formula (if necessary)</li>
<li><code>data</code>: the dataset</li>
<li><code>auxvars</code>: an optional vector of auxiliary variables</li>
<li><code>no_model</code>: an optional vector of names of covariates for which no model will be specified</li>
</ul>

<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="ch-JSS.html#cb25-1"></a>mod7b_models &lt;-<span class="st"> </span><span class="kw">get_models</span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span>SMOKE <span class="op">+</span><span class="st"> </span>hc <span class="op">+</span></span>
<span id="cb25-2"><a href="ch-JSS.html#cb25-2"></a><span class="st">                             </span>MARITAL <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>),</span>
<span id="cb25-3"><a href="ch-JSS.html#cb25-3"></a>                           <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb25-4"><a href="ch-JSS.html#cb25-4"></a>                           <span class="dt">data =</span> simLong)</span>
<span id="cb25-5"><a href="ch-JSS.html#cb25-5"></a>mod7b_models</span></code></pre></div>
<pre><code>## $models
##     HEIGHT_M         ETHN      MARITAL        SMOKE          age 
##       &quot;norm&quot;      &quot;logit&quot; &quot;multilogit&quot;   &quot;cumlogit&quot;        &quot;lmm&quot; 
##           hc 
##        &quot;lmm&quot; 
## 
## $meth
##     HEIGHT_M         ETHN      MARITAL        SMOKE           hc 
##       &quot;norm&quot;      &quot;logit&quot; &quot;multilogit&quot;   &quot;cumlogit&quot;        &quot;lmm&quot;</code></pre>

<p><code>get_models()</code> returns a list of two vectors:</p>
<ul>
<li><code>models</code>: containing all specified models</li>
<li><code>meth</code>: containing the models for the incomplete variables only</li>
</ul>
<p>When there is a “time” variable in the model, such as <code>age</code> in our example
(which is the age of the child at the time of the measurement),
it may not be meaningful to specify a model for that variable.
Especially when the “time” variable is pre-specified by the design of the study,
it can usually be assumed to be independent of baseline covariates and a model for it
has no useful interpretation.</p>
<p>The argument <code>no_model</code> (in <code>get_models()</code> and in the main
functions <code>*_imp()</code>) allows for the exclusion of models for such variables
(as long as they are completely observed):</p>

<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="ch-JSS.html#cb27-1"></a>mod7c_models &lt;-<span class="st"> </span><span class="kw">get_models</span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span>SMOKE <span class="op">+</span><span class="st"> </span>hc <span class="op">+</span></span>
<span id="cb27-2"><a href="ch-JSS.html#cb27-2"></a><span class="st">                             </span>MARITAL <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>),</span>
<span id="cb27-3"><a href="ch-JSS.html#cb27-3"></a>                           <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb27-4"><a href="ch-JSS.html#cb27-4"></a>                           <span class="dt">data =</span> simLong, <span class="dt">no_model =</span> <span class="st">&quot;age&quot;</span>)</span>
<span id="cb27-5"><a href="ch-JSS.html#cb27-5"></a><span class="co"># mod7c_models</span></span></code></pre></div>

<p>By excluding the model for <code>age</code> we implicitly assume that incomplete baseline
variables are independent of <code>age</code>.</p>
</div>
<div id="order-of-the-sequence-of-imputation-models" class="section level4 unnumbered">
<h4>Order of the Sequence of Imputation Models</h4>
<p>By default, models for level-1 covariates are specified after models for level-2
covariates, so that the level-2 covariates are used as predictor variables in the
models for level-1 covariates but not vice versa.
Within the two groups, models are ordered by the number of missing values (decreasing),
so that the model for the variable with the most missing values has the most
variables in its linear predictor.</p>
</div>
</div>
<div id="sec:auxvars" class="section level3">
<h3><span class="header-section-number">6.5.6</span> Auxiliary Variables</h3>
<p>Auxiliary variables are variables that are not part of the analysis model but
should be considered as predictor variables in the imputation models because they
can inform the imputation of unobserved values.</p>
<p>Good auxiliary variables are <span class="citation">(Van Buuren <a href="#ref-Buuren2012" role="doc-biblioref">2012</a>)</span>
</p>
<ul>
<li>associated with an incomplete variable of interest, or are</li>
<li>associated with the missingness of that variable and</li>
<li>do not have too many missing values themselves.
Importantly, they should be observed for a large proportion of the
cases that have a missing value in the variable to be imputed.</li>
</ul>
<p>In <code>*_imp()</code>, auxiliary variables can be
specified with the argument <code>auxvars</code>, which is a vector containing the names
of the auxiliary variables.</p>
<p><strong>Example:</strong><br>
We might consider the variables <code>educ</code> and <code>smoke</code> as predictors
for the imputation of <code>occup</code>:
</p>


<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="ch-JSS.html#cb28-1"></a>mod8a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>occup, <span class="dt">auxvars =</span> <span class="kw">c</span>(<span class="st">&#39;educ&#39;</span>, <span class="st">&#39;smoke&#39;</span>),</span>
<span id="cb28-2"><a href="ch-JSS.html#cb28-2"></a>                <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">100</span>)</span></code></pre></div>

<p>The variables <code>educ</code> and <code>smoke</code> are not included in the analysis model
(as can be seen when printing the posterior mean of the regression coefficients
of the analysis model with <code>coef()</code>):
</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="ch-JSS.html#cb29-1"></a><span class="kw">coef</span>(mod8a)</span></code></pre></div>
<pre><code>##           (Intercept)          genderfemale                   age 
##           105.5937694            -5.8192149             0.3781785 
## occuplooking for work      occupnot working 
##             4.0294291            -0.7349338</code></pre>

<p>They are, however, used as predictors in the imputation for <code>occup</code> and
imputed themselves (if they have missing values):
</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="ch-JSS.html#cb31-1"></a><span class="kw">list_models</span>(mod8a, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>,</span>
<span id="cb31-2"><a href="ch-JSS.html#cb31-2"></a>            <span class="dt">refcat =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Cumulative logit imputation model for &#39;smoke&#39;
## * Predictor variables: 
##   genderfemale, age, educhigh
## 
## Multinomial logit imputation model for &#39;occup&#39;
## * Predictor variables: 
##   (Intercept), genderfemale, age, educhigh, smokeformer, smokecurrent</code></pre>

<div id="functions-of-variables-as-auxiliary-variables" class="section level4 unnumbered">
<h4>Functions of Variables as Auxiliary Variables</h4>
<p>As shown above in <code>mod3e</code>, it is possible to specify functions of
auxiliary variables. In that case, the auxiliary variable is not considered as
a linear effect but as specified by the function.</p>
<p>Note that omitting auxiliary variables from the analysis model implies that the
outcome is independent of these variables, conditional on the other variables
in the model. If this is not true, the model is misspecified which may lead to
biased results (similar to leaving a confounding variable out of a model).</p>


</div>
</div>
<div id="reference-values-for-categorical-covariates" class="section level3">
<h3><span class="header-section-number">6.5.7</span> Reference Values for Categorical Covariates</h3>
<p>In <strong>JointAI</strong>, dummy coding is used when categorical variables enter a linear
predictor, i.e., a binary variable is created for each category, except the
reference category.
These binary variables have value one when that category
was observed and zero otherwise. Contrary to the behaviour in base R,
this coding is also used for ordered factors.</p>
<p>By default, the first category of a categorical variable (ordered or unordered)
is used as reference, however, this may not always allow the desired interpretation
of the regression coefficients. Moreover, when categories are unbalanced, setting
the largest group as reference may result in better mixing of the MCMC chains.
Therefore, <strong>JointAI</strong> allows specification of the reference category separately
for each variable, via the argument <code>refcats</code>.
Changes in <code>refcats</code> will not impact the imputation of the respective variable,
but change categories for which dummy variables are included in the linear
predictor of the analysis model or other covariate models.</p>
<div id="setting-reference-categories-for-all-variables" class="section level4 unnumbered">
<h4>Setting Reference Categories for All Variables</h4>
<p>To specify the choice of reference category globally for all variables in the
model, <code>refcats</code> can be set as
</p>
<ul>
<li><code>refcats = "first"</code></li>
<li><code>refcats = "last"</code></li>
<li><code>refcats = "largest"</code></li>
</ul>
<p>For example:

</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="ch-JSS.html#cb33-1"></a>mod9a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</span>
<span id="cb33-2"><a href="ch-JSS.html#cb33-2"></a>                <span class="dt">refcats =</span> <span class="st">&quot;largest&quot;</span>, <span class="dt">data =</span> NHANES)</span></code></pre></div>

</div>
<div id="setting-reference-categories-for-individual-variables" class="section level4 unnumbered">
<h4>Setting Reference Categories for Individual Variables</h4>
<p>Alternatively, <code>refcats</code> takes a named vector, in which the reference category
for each variable can be specified either by its number or its name, or one of
the three global types: <code>"first"</code>, <code>"last"</code> or <code>"largest"</code>.
For variables for which no reference category is specified in the list the
default is used.</p>

<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="ch-JSS.html#cb34-1"></a>mod9b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</span>
<span id="cb34-2"><a href="ch-JSS.html#cb34-2"></a>                <span class="dt">refcats =</span> <span class="kw">list</span>(<span class="dt">occup =</span> <span class="st">&quot;not working&quot;</span>, <span class="dt">race =</span> <span class="dv">3</span>,</span>
<span id="cb34-3"><a href="ch-JSS.html#cb34-3"></a>                               <span class="dt">educ =</span> <span class="st">&quot;largest&quot;</span>), <span class="dt">data =</span> NHANES)</span></code></pre></div>

<p>To facilitate specification of the reference categories, the function
<code>set_refcat()</code>
can be used.
It prints the names of the categorical variables that are selected by
</p>
<ul>
<li>a specified model formula and/or</li>
<li>a vector of auxiliary variables, or</li>
<li>a vector naming covariates,</li>
</ul>

<p>or all categorical variables in the data if only the argument <code>data</code> is provided,
and asks a number of questions which the user needs to reply to via input of
a number.</p>



<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="ch-JSS.html#cb35-1"></a>refs_mod9 &lt;-<span class="st"> </span><span class="kw">set_refcat</span>(NHANES, <span class="dt">formula =</span> <span class="kw">formula</span>(mod9b))</span></code></pre></div>
<pre><code>## 
## How do you want to specify the reference categories?
## 
## 1: Use the first category for each variable.
## 2: Use the last category for each variabe.
## 3: Use the largest category for each variable.
## 4: Specify the reference categories individually.</code></pre>

<p>When option 4 is chosen, a choice is given for each categorical variable,
for example:
</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="ch-JSS.html#cb37-1"></a><span class="co">#&gt; The reference category for &quot;race&quot; should be </span></span>
<span id="cb37-2"><a href="ch-JSS.html#cb37-2"></a><span class="co">#&gt; </span></span>
<span id="cb37-3"><a href="ch-JSS.html#cb37-3"></a><span class="co">#&gt; 1: Mexican American</span></span>
<span id="cb37-4"><a href="ch-JSS.html#cb37-4"></a><span class="co">#&gt; 2: Other Hispanic</span></span>
<span id="cb37-5"><a href="ch-JSS.html#cb37-5"></a><span class="co">#&gt; 3: Non-Hispanic White</span></span>
<span id="cb37-6"><a href="ch-JSS.html#cb37-6"></a><span class="co">#&gt; 4: Non-Hispanic Black</span></span>
<span id="cb37-7"><a href="ch-JSS.html#cb37-7"></a><span class="co">#&gt; 5: other</span></span></code></pre></div>

<p>After specification of the reference categories,
the determined specification for the argument <code>refcats</code> is printed:
</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ch-JSS.html#cb38-1"></a><span class="co">#&gt; In the JointAI model specify:</span></span>
<span id="cb38-2"><a href="ch-JSS.html#cb38-2"></a><span class="co">#&gt;  refcats = c(gender = &#39;female&#39;, race = &#39;Non-Hispanic White&#39;,</span></span>
<span id="cb38-3"><a href="ch-JSS.html#cb38-3"></a><span class="co">#&gt;              educ = &#39;low&#39;, occup = &#39;not working&#39;, smoke = &#39;never&#39;)</span></span>
<span id="cb38-4"><a href="ch-JSS.html#cb38-4"></a><span class="co">#&gt; </span></span>
<span id="cb38-5"><a href="ch-JSS.html#cb38-5"></a><span class="co">#&gt; or use the output of this function.</span></span></code></pre></div>

<p><code>set_refcat()</code> also returns a named vector that can be passed to the argument
<code>refcats</code>:
</p>


<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="ch-JSS.html#cb39-1"></a>mod9c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</span>
<span id="cb39-2"><a href="ch-JSS.html#cb39-2"></a>                <span class="dt">refcats =</span> refs_mod9, <span class="dt">data =</span> NHANES)</span></code></pre></div>

</div>
</div>
<div id="sec:hyperpars" class="section level3">
<h3><span class="header-section-number">6.5.8</span> Hyperparameters</h3>
<p>In the Bayesian framework, parameters are random variables for which a
distribution needs to be specified. These distributions depend on parameters
themselves, i.e., on hyperparameters.</p>
<p>The function <code>default_hyperpars()</code> returns a list containing the default
hyperparameters used in a <code>JointAI</code> model (see <a href="ch-JSS.html#a-default-hyperparameters">Appendix 6.A</a>).</p>
<p>To change the hyperparameters in a <code>JointAI</code> model, the list obtained from
<code>default_hyperpars()</code> can be edited and passed to the argument <code>hyperpars</code>
in <code>*_imp()</code>.</p>
<p><code>mu_reg_*</code> and <code>tau_reg_*</code> refer to the mean and precision of the prior distribution
for regression coefficients.
<code>shape_tau_*</code> and <code>rate_tau_*</code> are the shape and rate parameters of a gamma
distribution that is used as prior for precision parameters.
<code>RinvD</code> is the scale matrix in the Wishart prior for the inverse of the random
effects design matrix <code>D</code>, and <code>KinvD</code> is the number of degrees of freedom in that
distribution. <code>shape_diag_RinvD</code> and <code>rate_diag_RinvD</code> are the shape and rate parameters
of the gamma prior of the diagonal elements of <code>RinvD</code>.
In random effects models with only one random effect, a gamma prior is used
instead of the Wishart distribution for the inverse of <code>D</code>.</p>
<p>The hyperparameters <code>mu_reg_surv</code> and <code>tau_reg_surv</code> are used in
<code>survreg_imp()</code> as well as <code>coxph_imp()</code>. For the Cox proportional
hazards model, the hyperparameters <code>c</code>, <code>r</code> and <code>eps</code> refer to
the confidence in the prior guess for the hazard function, failure rate per unit time
(<span class="math inline">\(\lambda_0(t)^*\)</span> in Section <a href="ch-JSS.html#sec:AnalysisModel">6.2.1</a>) and time increment
(for numerical stability), respectively.</p>
</div>
<div id="scaling" class="section level3">
<h3><span class="header-section-number">6.5.9</span> Scaling</h3>
<p>When variables are measured on very different scales this can result in
slow convergence and bad mixing.
Therefore, <strong>JointAI</strong> automatically scales continuous variables to have
mean zero and standard deviation one.
Results (parameters and imputed values) are transformed back to the original
scale when the results are printed or imputed values are exported.</p>
<p>In some settings, however, it is not possible to scale continuous variables.
This is the case for incomplete variables that enter a linear predictor
in a function and variables that are imputed with models
that are defined on a subset of the real line (i.e., with a gamma or a beta
distribution). Variables that are imputed with a log-normal distribution are
scaled, but not centred.</p>
<p>To prevent scaling, the argument <code>scale_vars</code> can be set to <code>FALSE</code>. When
a vector of variable names is supplied to <code>scale_vars</code>, only those variables
are scaled.</p>
<p>By default, only the MCMC samples that are scaled back to the scale of the data
are stored in a <code>JointAI</code> object.
When the argument <code>keep_scaled_mcmc = TRUE</code>, the scaled sample is also kept.</p>
</div>
<div id="ridge-regression" class="section level3">
<h3><span class="header-section-number">6.5.10</span> Ridge Regression</h3>
<p>Using the argument <code>ridge = TRUE</code> it is possible to impose a ridge penalty
on the parameters of the analysis model, shrinking these parameters towards zero.
This is done by specification of a <span class="math inline">\(\text{Gamma}(0.01, 0.01)\)</span> prior for the
precision of the regression coefficients <span class="math inline">\(\beta\)</span> instead of setting it to a
fixed (small) value.</p>
</div>
</div>
<div id="sec:MCMCSettings" class="section level2">
<h2><span class="header-section-number">6.6</span> MCMC Settings</h2>
<p>The functions <code>*_imp()</code> have a number of arguments that specify settings for
the MCMC sampling:
</p>
<ul>
<li><code>n.chains</code>: number of MCMC chains</li>
<li><code>n.adapt</code>: number of iterations in the adaptive phase</li>
<li><code>n.iter</code>: number of iterations in the sampling phase</li>
<li><code>thin</code>: thinning degree</li>
<li><code>monitor_params</code>: parameters/nodes to be monitored</li>
<li><code>seed</code>: optional seed value for reproducibility</li>
<li><code>inits</code>: initial values</li>
<li><code>parallel</code>: whether MCMC chains should be sampled in parallel</li>
<li><code>ncores</code>: how many cores are available for parallel sampling</li>
</ul>
<p>The first four, as well as the following two parameters, are passed directly
to functions from the R package <strong>rjags</strong>:
</p>
<ul>
<li><code>quiet</code>: should printing of information be suppressed?</li>
<li><code>progress.bar</code>: type of progress bar (<code>"text"</code>, <code>"gui"</code> or <code>"none"</code>)</li>
</ul>
<p>In the following sections, the arguments listed above are explained in more
detail and examples are given.</p>
<div id="number-of-chains-iterations-and-samples" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Number of Chains, Iterations and Samples</h3>
<div id="number-of-chains" class="section level4 unnumbered">
<h4>Number of Chains</h4>
<p>To evaluate convergence of MCMC chains it is helpful to create multiple
chains that have different starting values. More information on how to evaluate
convergence and the specification of initial values can be found in
Sections <a href="ch-JSS.html#sec:grcrit">6.7.3.1</a> and <a href="ch-JSS.html#sec:inits">6.6.3</a> respectively.</p>
<p>The argument <code>n.chains</code> selects the number of chains (by default, <code>n.chains = 3</code>).
For calculating the model summary, multiple chains are merged.</p>
</div>
<div id="adaptive-phase" class="section level4 unnumbered">
<h4>Adaptive Phase</h4>
<p>JAGS has an adaptive mode, in which samplers are optimized (for example the
step size is adjusted).
Samples obtained during the adaptive mode do not form a Markov chain and are
discarded.
The argument <code>n.adapt</code> controls the length of this adaptive phase.</p>
<p>The default value for <code>n.adapt</code> is 100, which works well in many of the examples
considered here. Complex models may require longer adaptive phases. If the adaptive
phase is not sufficient for JAGS to optimize the samplers, a warning message will be
printed (see example below).</p>
</div>
<div id="sampling-iterations" class="section level4 unnumbered">
<h4>Sampling Iterations</h4>
<p><code>n.iter</code> specifies the number of iterations in the sampling phase, i.e., the length
of the MCMC chain. How many samples are required to reach convergence and to
have sufficient precision (see also Section <a href="ch-JSS.html#sec:mcerror">6.7.3.2</a>)
depends on the complexity of data and model, and may
range from as few as 100 to several million.</p>
</div>
<div id="thinning" class="section level4 unnumbered">
<h4>Thinning</h4>
<p>In settings with high autocorrelation, it may take many iterations before a
sample is created that sufficiently
represents the whole range of the posterior distribution.
Processing of such long chains can be slow and cause memory issues.
The parameter <code>thin</code> allows the user to specify if and how much the MCMC chains should
be thinned out before storing them. By default <code>thin = 1</code> is used,
which corresponds to keeping all values. A value <code>thin = 10</code> would result in
keeping every 10th value and discarding all other values.</p>
</div>
<div id="sec:MCMCexamples" class="section level4">
<h4><span class="header-section-number">6.6.1.1</span> Example: Default Settings</h4>
<p>Using the default settings <code>n.adapt = 100</code> and <code>thin = 1</code>, and 100 sampling
iterations, a simple model would be
</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ch-JSS.html#cb40-1"></a>mod10a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>alc, <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">100</span>)</span></code></pre></div>

<p>The relevant part of the model summary (obtained with <code>summary()</code>)
shows that the first 100 iterations
(adaptive phase) were discarded, the 100 iterations that follow form the
posterior sample, thinning was set to “1” and there are three chains.
</p>
<pre><code>## [...]
## MCMC settings:
## Iterations = 101:200
## Sample size per chain = 100 
## Thinning interval = 1 
## Number of chains = 3</code></pre>

</div>
<div id="example-insufficient-adaptation-phase" class="section level4 unnumbered">
<h4>Example: Insufficient Adaptation Phase</h4>

<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ch-JSS.html#cb42-1"></a>mod10b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>alc, <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">10</span>, <span class="dt">n.iter =</span> <span class="dv">100</span>)</span></code></pre></div>

<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ch-JSS.html#cb43-1"></a><span class="co">## Warning in rjags::jags.model(file = modelfile, data = data_list, inits</span></span>
<span id="cb43-2"><a href="ch-JSS.html#cb43-2"></a><span class="co">## = inits, : Adaptation incomplete</span></span>
<span id="cb43-3"><a href="ch-JSS.html#cb43-3"></a><span class="co">## </span><span class="al">NOTE</span><span class="co">: Stopping adaptation</span></span></code></pre></div>

<p>Specifying <code>n.adapt = 10</code> results in a warning message. The relevant part of the
model summary from the resulting model is:
</p>
<pre><code>## [...]
## Iterations = 11:110
## Sample size per chain = 100 
## Thinning interval = 1 
## Number of chains = 3</code></pre>

</div>
<div id="example-thinning" class="section level4 unnumbered">
<h4>Example: Thinning</h4>

<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ch-JSS.html#cb45-1"></a>mod10c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>alc, <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">500</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</span></code></pre></div>

<p>Here, iterations 110 until 600 are used in the output, but due to a thinning
interval of ten, the resulting MCMC
chains contain only 50 samples instead of 500, that is, the samples from iteration
110, 120, 130, </p>

<pre><code>## [...]
## Iterations = 110:600
## Sample size per chain = 50 
## Thinning interval = 10 
## Number of chains = 3</code></pre>

</div>
</div>
<div id="parameters-to-follow" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Parameters to Follow</h3>
<p>Since <strong>JointAI</strong> uses JAGS <span class="citation">(Plummer <a href="#ref-JAGS" role="doc-biblioref">2003</a>)</span> for performing the MCMC sampling, and
JAGS only saves the values of MCMC chains for those nodes
which the user has specified should be monitored, this is also the
case in <strong>JointAI</strong>.</p>
<p>For this purpose, the main functions <code>*_imp()</code> have an argument
<code>monitor_params</code>, which takes a named list (or a named vector) with
possible entries given in Table <a href="ch-JSS.html#tab:monitorparams">6.2</a>.
This table contains a number of keywords that refer to (groups of) nodes.
Each of the keywords works as a switch and can be specified as <code>TRUE</code> or <code>FALSE</code>
(with the exception of <code>other</code>).</p>

<table>
<caption>
<span id="tab:monitorparams">Table 6.2: </span>Keywords and names of (groups of) nodes that can be specified
to be monitored using the argument <code>monitor_params</code>.
</caption>
<thead>
<tr>
<th style="text-align:left;">
name/keyword
</th>
<th style="text-align:left;">
what is monitored
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>analysis_main</code>
</td>
<td style="text-align:left;">
<code>betas</code> and <code>sigma_y</code> (and <code>D</code>)
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>betas</code>
</td>
<td style="text-align:left;">
regression coefficients of the analysis model
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>tau_y</code>
</td>
<td style="text-align:left;">
precision of the residuals from the analysis model
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>sigma_y</code>
</td>
<td style="text-align:left;">
std. deviation of the residuals from the analysis model
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>analysis_random</code>
</td>
<td style="text-align:left;">
<code>ranef</code>, <code>D</code>, <code>invD</code>, <code>RinvD</code>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>ranef</code>
</td>
<td style="text-align:left;">
random effects
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>D</code>
</td>
<td style="text-align:left;">
covariance matrix of the random effects
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>invD</code>
</td>
<td style="text-align:left;">
inverse of <code>D</code>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>RinvD</code>
</td>
<td style="text-align:left;">
scale matrix in Wishart prior for <code>invD</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>imp_pars</code>
</td>
<td style="text-align:left;">
<code>alphas</code>, <code>tau_imp</code>, <code>gamma_imp</code>, <code>delta_imp</code>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>alphas</code>
</td>
<td style="text-align:left;">
regression coefficients in the imputation models
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>tau_imp</code>
</td>
<td style="text-align:left;">
precision of the residuals from imputation models
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>gamma_imp</code>
</td>
<td style="text-align:left;">
intercepts in ordinal imputation models
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
<code>delta_imp</code>
</td>
<td style="text-align:left;">
increments of ordinal intercepts
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>imps</code>
</td>
<td style="text-align:left;">
imputed values
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>other</code>
</td>
<td style="text-align:left;">
additional parameters
</td>
</tr>
</tbody>
</table>

<div id="parameters-of-the-analysis-model" class="section level4 unnumbered">
<h4>Parameters of the Analysis Model</h4>
<p>The default setting is <code>monitor_params = c(analysis_main = TRUE)</code>, i.e.,
only the main parameters of the analysis model are monitored, and
monitoring is switched off for all other parameters.
Main parameters are the regression coefficients of the analysis model
(<code>beta</code>), depending on the model type, the residual standard deviation (<code>sigma_y</code>),
and, for mixed models, the random effects variance-covariance matrix <code>D</code>.</p>
<p>The function <code>parameters()</code> returns the parameters specified to be followed
(also for models where no MCMC sampling was performed, i.e., when <code>n.iter = 0</code> and
<code>n.adapt = 0</code>). We use it here to demonstrate the effect that different choices
for <code>monitor_params</code> have.
For example:
</p>

<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="ch-JSS.html#cb47-1"></a>mod11a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</span>
<span id="cb47-2"><a href="ch-JSS.html#cb47-2"></a>                 <span class="dt">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb47-3"><a href="ch-JSS.html#cb47-3"></a></span>
<span id="cb47-4"><a href="ch-JSS.html#cb47-4"></a><span class="kw">parameters</span>(mod11a)</span></code></pre></div>
<pre><code>## [1] &quot;(Intercept)&quot;  &quot;genderfemale&quot; &quot;WC&quot;           &quot;alc&gt;=1&quot;      
## [5] &quot;creat&quot;        &quot;sigma_SBP&quot;</code></pre>

</div>
<div id="parameters-of-the-covariate-models-and-imputed-values" class="section level4 unnumbered">
<h4>Parameters of the Covariate Models and Imputed Values</h4>
<p>The parameters of the models for the incomplete variables can be selected with
<code>monitor_params = c(imp_pars = TRUE)</code>. This will set monitors for the
regression coefficients (<code>alpha</code>) and other parameters, such as precision
(<code>tau_*</code>) and intercepts and increments (<code>gamma_*</code> and <code>delta_*</code>) in cumulative
logit models.</p>

<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="ch-JSS.html#cb49-1"></a>mod11b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>occup,</span>
<span id="cb49-2"><a href="ch-JSS.html#cb49-2"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">0</span>,</span>
<span id="cb49-3"><a href="ch-JSS.html#cb49-3"></a>                 <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imp_pars =</span> <span class="ot">TRUE</span>,</span>
<span id="cb49-4"><a href="ch-JSS.html#cb49-4"></a>                                    <span class="dt">analysis_main =</span> <span class="ot">FALSE</span>))</span>
<span id="cb49-5"><a href="ch-JSS.html#cb49-5"></a></span>
<span id="cb49-6"><a href="ch-JSS.html#cb49-6"></a><span class="kw">parameters</span>(mod11b)</span></code></pre></div>
<pre><code>## [1] &quot;alpha&quot;       &quot;tau_WC&quot;      &quot;gamma_smoke&quot; &quot;delta_smoke&quot;</code></pre>

<p>To generate (multiple) imputed datasets to be used for further analyses,
the imputed values need to be monitored. This can be achieved by setting
<code>monitor_params = c(imps = TRUE)</code>.
</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="ch-JSS.html#cb51-1"></a>mod11c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>occup,</span>
<span id="cb51-2"><a href="ch-JSS.html#cb51-2"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">0</span>,</span>
<span id="cb51-3"><a href="ch-JSS.html#cb51-3"></a>                 <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imps =</span> <span class="ot">TRUE</span>, <span class="dt">analysis_main =</span> <span class="ot">FALSE</span>))</span></code></pre></div>

<p>Extraction of multiple imputed datasets from a <strong>JointAI</strong> model is
described in Section <a href="ch-JSS.html#sec:getMIdat">6.7.6</a>.</p>
</div>
<div id="random-effects" class="section level4 unnumbered">
<h4>Random Effects</h4>
<p>For mixed models, <code>analysis_main</code> also includes the random effects variance-covariance
matrix <code>D</code>.
Setting <code>analysis_random = TRUE</code> will switch on monitoring
for the random effects (<code>ranef</code>), random effects variance-covariance matrix (<code>D</code>),
inverse of the random effects variance-covariance matrix (<code>invD</code>) and the diagonal of the
scale matrix of the Wishart-prior of <code>invD</code> (<code>RinvD</code>).</p>

<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="ch-JSS.html#cb52-1"></a>mod11d &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>EDUC, <span class="dt">random =</span> <span class="op">~</span>age <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb52-2"><a href="ch-JSS.html#cb52-2"></a>                  <span class="dt">data =</span> simLong, <span class="dt">n.adapt =</span> <span class="dv">0</span>,</span>
<span id="cb52-3"><a href="ch-JSS.html#cb52-3"></a>                  <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">analysis_random =</span> <span class="ot">TRUE</span>))</span>
<span id="cb52-4"><a href="ch-JSS.html#cb52-4"></a></span>
<span id="cb52-5"><a href="ch-JSS.html#cb52-5"></a><span class="kw">parameters</span>(mod11d)</span></code></pre></div>
<pre><code>##  [1] &quot;(Intercept)&quot; &quot;EDUCmid&quot;     &quot;EDUClow&quot;     &quot;age&quot;         &quot;sigma_bmi&quot;  
##  [6] &quot;b&quot;           &quot;invD[1,1]&quot;   &quot;invD[1,2]&quot;   &quot;invD[2,2]&quot;   &quot;D[1,1]&quot;     
## [11] &quot;D[1,2]&quot;      &quot;D[2,2]&quot;      &quot;RinvD[1,1]&quot;  &quot;RinvD[2,2]&quot;</code></pre>

<p>It is possible to select only a subset of the random effects parameters by
specifying them directly, e.g.,
</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="ch-JSS.html#cb54-1"></a>mod11e &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>EDUC, <span class="dt">random =</span> <span class="op">~</span>age <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb54-2"><a href="ch-JSS.html#cb54-2"></a>                  <span class="dt">data =</span> simLong, <span class="dt">n.adapt =</span> <span class="dv">0</span>,</span>
<span id="cb54-3"><a href="ch-JSS.html#cb54-3"></a>                  <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">analysis_main =</span> <span class="ot">TRUE</span>, <span class="dt">RinvD =</span> <span class="ot">TRUE</span>))</span>
<span id="cb54-4"><a href="ch-JSS.html#cb54-4"></a></span>
<span id="cb54-5"><a href="ch-JSS.html#cb54-5"></a><span class="kw">parameters</span>(mod11e)</span></code></pre></div>
<pre><code>##  [1] &quot;(Intercept)&quot; &quot;EDUCmid&quot;     &quot;EDUClow&quot;     &quot;age&quot;         &quot;sigma_bmi&quot;  
##  [6] &quot;D[1,1]&quot;      &quot;D[1,2]&quot;      &quot;D[2,2]&quot;      &quot;RinvD[1,1]&quot;  &quot;RinvD[2,2]&quot;</code></pre>

<p>or by switching unwanted parts of <code>analysis_random</code> off, e.g.,</p>

<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="ch-JSS.html#cb56-1"></a>mod11f &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>EDUC, <span class="dt">random =</span> <span class="op">~</span>age <span class="op">|</span><span class="st"> </span>ID, <span class="dt">data =</span> simLong,</span>
<span id="cb56-2"><a href="ch-JSS.html#cb56-2"></a>                  <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">analysis_main =</span> <span class="ot">TRUE</span>,</span>
<span id="cb56-3"><a href="ch-JSS.html#cb56-3"></a>                                                  <span class="dt">analysis_random =</span> <span class="ot">TRUE</span>,</span>
<span id="cb56-4"><a href="ch-JSS.html#cb56-4"></a>                                                  <span class="dt">RinvD =</span> <span class="ot">FALSE</span>,</span>
<span id="cb56-5"><a href="ch-JSS.html#cb56-5"></a>                                                  <span class="dt">ranef =</span> <span class="ot">FALSE</span>))</span>
<span id="cb56-6"><a href="ch-JSS.html#cb56-6"></a></span>
<span id="cb56-7"><a href="ch-JSS.html#cb56-7"></a><span class="kw">parameters</span>(mod11f)</span></code></pre></div>
<pre><code>##  [1] &quot;(Intercept)&quot; &quot;EDUCmid&quot;     &quot;EDUClow&quot;     &quot;age&quot;         &quot;sigma_bmi&quot;  
##  [6] &quot;invD[1,1]&quot;   &quot;invD[1,2]&quot;   &quot;invD[2,2]&quot;   &quot;D[1,1]&quot;      &quot;D[1,2]&quot;     
## [11] &quot;D[2,2]&quot;</code></pre>

</div>
<div id="other-parameters" class="section level4 unnumbered">
<h4>Other Parameters</h4>
<p>The element <code>other</code> in <code>monitor_params</code> allows for the specification of one or multiple
additional parameters to be monitored. When <code>other</code> is used with more than one
element, <code>monitor_params</code> has to be a list.</p>
<p>Here, as an example, we monitor the probability of being in the <code>alc&gt;=1</code> group for
subjects one through three and the expected value of the distribution of <code>creat</code> for
the first subject.
</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="ch-JSS.html#cb58-1"></a>mod11g &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</span>
<span id="cb58-2"><a href="ch-JSS.html#cb58-2"></a>                 <span class="dt">n.adapt =</span> <span class="dv">0</span>,</span>
<span id="cb58-3"><a href="ch-JSS.html#cb58-3"></a>                 <span class="dt">monitor_params =</span> <span class="kw">list</span>(<span class="dt">analysis_main =</span> <span class="ot">FALSE</span>,</span>
<span id="cb58-4"><a href="ch-JSS.html#cb58-4"></a>                                       <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&#39;p_alc[1:3]&#39;</span>,</span>
<span id="cb58-5"><a href="ch-JSS.html#cb58-5"></a>                                                 <span class="st">&quot;mu_creat[1]&quot;</span>)))</span>
<span id="cb58-6"><a href="ch-JSS.html#cb58-6"></a></span>
<span id="cb58-7"><a href="ch-JSS.html#cb58-7"></a><span class="kw">parameters</span>(mod11g)</span></code></pre></div>
<pre><code>## [1] &quot;p_alc[1:3]&quot;  &quot;mu_creat[1]&quot;</code></pre>

<p>Even though this example may not be particularly meaningful, in cases of convergence
issues it can be helpful to be able to monitor any node of the model, not just
the ones that are typically of interest.</p>
</div>
</div>
<div id="sec:inits" class="section level3">
<h3><span class="header-section-number">6.6.3</span> Initial Values</h3>
<p>Initial values are the starting point for the MCMC sampler. Setting good
initial values, i.e., values that are likely under the posterior distribution,
can speed up convergence.
By default, the argument <code>inits = NULL</code>, which means that initial values are
generated automatically by JAGS.
It is also possible to supply initial values directly as a list or as a function.</p>
<p>Initial values can be specified for every unobserved node, that is, parameters
and missing values, but it is possible to only specify initial values for a
subset of nodes.</p>
<p>When the initial values provided by the user do not have elements named
<code>".RNG.name"</code> or <code>".RNG.seed"</code>, <strong>JointAI</strong> will add those elements,
which specify the name and seed value of the random number generator used
for each chain.</p>
<p>The argument <code>seed</code> allows the specification of a seed value with which the
starting values of the random number generator, and, hence, the values of the MCMC
sample, can be reproduced.</p>
<div id="initial-values-in-a-list-of-lists" class="section level4 unnumbered">
<h4>Initial Values in a List of Lists</h4>
<p>A list containing initial values should have the same length as the number of
chains, where each element is a named list of initial values. Moreover,
initial values should differ between the chains.</p>
<p>For example, to create initial values for the parameter vector <code>beta</code> and
the precision parameter <code>tau_SBP</code> for two chains the following syntax could
be used:
</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="ch-JSS.html#cb60-1"></a>init_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="cf">function</span>(i) {</span>
<span id="cb60-2"><a href="ch-JSS.html#cb60-2"></a>  <span class="kw">list</span>(<span class="dt">beta =</span> <span class="kw">rnorm</span>(<span class="dv">4</span>), </span>
<span id="cb60-3"><a href="ch-JSS.html#cb60-3"></a>       <span class="dt">tau_SBP =</span> <span class="kw">rgamma</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb60-4"><a href="ch-JSS.html#cb60-4"></a>})</span>
<span id="cb60-5"><a href="ch-JSS.html#cb60-5"></a></span>
<span id="cb60-6"><a href="ch-JSS.html#cb60-6"></a>init_list</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$beta
## [1] 0.2995096 0.2123710 0.6478957 0.8952516
## 
## [[1]]$tau_SBP
## [1] 1.000624
## 
## 
## [[2]]
## [[2]]$beta
## [1]  2.2559981  0.9786635 -1.2725176 -0.7251253
## 
## [[2]]$tau_SBP
## [1] 0.05501739</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="ch-JSS.html#cb62-1"></a>mod12a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>WC, <span class="dt">data =</span> NHANES, <span class="dt">n.chain =</span> <span class="dv">2</span>,</span>
<span id="cb62-2"><a href="ch-JSS.html#cb62-2"></a>                <span class="dt">inits =</span> init_list)</span></code></pre></div>

<p>The user provided lists of initial values are stored in the JointAI object
(together with starting values for the random number generator)
and can be accessed via <code>mod11a$mcmc_settings$inits</code>.</p>
</div>
<div id="initial-values-as-a-function" class="section level4 unnumbered">
<h4>Initial Values as a Function</h4>
<p>Initial values can be specified as a function. The function should either take no
arguments or a single argument called <code>chain</code>, and return a named list that
supplies values for one chain.</p>
<p>For example, to create initial values for the parameter vectors <code>beta</code> and <code>alpha</code>:
</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="ch-JSS.html#cb63-1"></a>inits_fun &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb63-2"><a href="ch-JSS.html#cb63-2"></a>  <span class="kw">list</span>(<span class="dt">beta =</span> <span class="kw">rnorm</span>(<span class="dv">4</span>),</span>
<span id="cb63-3"><a href="ch-JSS.html#cb63-3"></a>       <span class="dt">alpha =</span> <span class="kw">rnorm</span>(<span class="dv">3</span>))</span>
<span id="cb63-4"><a href="ch-JSS.html#cb63-4"></a>}</span></code></pre></div>

<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="ch-JSS.html#cb64-1"></a><span class="kw">inits_fun</span>()</span></code></pre></div>
<pre><code>## $beta
## [1] -1.6045542  0.1872611  1.0167161 -0.4272887
## 
## $alpha
## [1] 0.8542140 0.6391477 0.4720952</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="ch-JSS.html#cb66-1"></a>mod12b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>WC, <span class="dt">data =</span> NHANES,</span>
<span id="cb66-2"><a href="ch-JSS.html#cb66-2"></a>                 <span class="dt">inits =</span> inits_fun)</span>
<span id="cb66-3"><a href="ch-JSS.html#cb66-3"></a></span>
<span id="cb66-4"><a href="ch-JSS.html#cb66-4"></a>mod12b<span class="op">$</span>mcmc_settings<span class="op">$</span>inits</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$beta
## [1] -0.07058338  0.41772091 -1.66236440  1.24957652
## 
## [[1]]$alpha
## [1] -0.7204577  0.1424769 -1.0114044
## 
## [[1]]$.RNG.name
## [1] &quot;base::Wichmann-Hill&quot;
## 
## [[1]]$.RNG.seed
## [1] 77704
## 
## 
## [[2]]
## [[2]]$beta
## [1] -0.50236788 -0.01997157  1.40425944  1.18807193
## 
## [[2]]$alpha
## [1] -0.8065902 -0.9709539 -0.7020397
## 
## [[2]]$.RNG.name
## [1] &quot;base::Mersenne-Twister&quot;
## 
## [[2]]$.RNG.seed
## [1] 29379
## 
## 
## [[3]]
## [[3]]$beta
## [1] -0.3516978 -0.9144069 -1.7397631 -0.1083395
## 
## [[3]]$alpha
## [1]  0.9067457 -0.4471829  0.1170837
## 
## [[3]]$.RNG.name
## [1] &quot;base::Mersenne-Twister&quot;
## 
## [[3]]$.RNG.seed
## [1] 83619</code></pre>

<p>When a function is supplied, the function is evaluated by <strong>JointAI</strong> and the
resulting <code>list</code> is stored in the <code>JointAI</code> object.</p>
</div>
<div id="sec:NodesInit" class="section level4">
<h4><span class="header-section-number">6.6.3.1</span> For which Nodes can Initial Values be Specified?</h4>
<p>Initial values can be specified for all unobserved stochastic nodes, i.e.,
parameters or unobserved data for which a distribution is specified in the
JAGS model. They have to be supplied in the format of the parameter or unobserved
value in the JAGS model.
To find out which nodes there are in a model and in which form they have to be
specified,
the function <code>coef()</code> from package <strong>rjags</strong> can be used to obtain a list
with the current values of the MCMC chains (by default the first chain)
from a JAGS model object. This object is contained in a <code>JointAI</code>
object under the name <code>model</code>.
Elements of the initial values should have the same structure as the elements in
this list of current values.</p>
<div id="example" class="section level5 unnumbered">
<h5>Example:</h5>
<p>We are using a longitudinal model and the <code>simLong</code> data in this example.
Here we only show some relevant parts of the output.
</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="ch-JSS.html#cb68-1"></a>mod12c &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span>hc <span class="op">+</span><span class="st"> </span>SMOKE, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>time <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb68-2"><a href="ch-JSS.html#cb68-2"></a>                  <span class="dt">no_model =</span> <span class="st">&#39;time&#39;</span>, <span class="dt">data =</span> simLong)</span>
<span id="cb68-3"><a href="ch-JSS.html#cb68-3"></a></span>
<span id="cb68-4"><a href="ch-JSS.html#cb68-4"></a><span class="co"># coef(mod12c$model)</span></span></code></pre></div>



<p><code>RinvD</code> is the scale matrix in the Wishart prior for the inverse of the
random effects variance-covariance matrix <code>D</code>.
In the data that is passed to JAGS (which is stored in the element <code>data_list</code>
in a <code>JointAI</code> object), this matrix is specified as a diagonal matrix,
with unknown diagonal elements:
</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="ch-JSS.html#cb69-1"></a>mod12c<span class="op">$</span>data_list[<span class="st">&#39;RinvD&#39;</span>]</span></code></pre></div>
<pre><code>## $RinvD
##      [,1] [,2]
## [1,]   NA    0
## [2,]    0   NA</code></pre>

<p>These diagonal elements are estimated in the model and have a gamma prior.
The corresponding part of the JAGS model is:
</p>
<pre><code>## [...]
##   # Priors for the covariance of the random effects
##   for (k in 1:2){
##     RinvD[k, k] ~ dgamma(shape_diag_RinvD, rate_diag_RinvD)
##   }
##   invD[1:2, 1:2] ~ dwish(RinvD[ , ], KinvD)
##   D[1:2, 1:2] &lt;- inverse(invD[ , ])
## [...]</code></pre>

<p>The element <code>RinvD</code> in the initial values has to be a <span class="math inline">\(2\times2\)</span> matrix,
with positive values on the diagonal and <code>NA</code> as off-diagonal elements,
since these are fixed in the data:
</p>
<pre><code>## $RinvD
##            [,1]       [,2]
## [1,] 0.03648925         NA
## [2,]         NA 0.07655993</code></pre>

<p>Lines 82 through 85 of the design matrix of the fixed effects of baseline
covariates, <code>Xc</code>, in the data are:
</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ch-JSS.html#cb73-1"></a>mod12c<span class="op">$</span>data_list<span class="op">$</span>Xc[<span class="dv">82</span><span class="op">:</span><span class="dv">85</span>, ]</span></code></pre></div>


<pre><code>##       (Intercept)  HEIGHT_M SMOKEsmoked until[...] SMOKEcontin[...]
## 172.1           1 0.1148171                     NA               NA
## 173.1           1        NA                     NA               NA
## 174.1           1 0.5045126                     NA               NA
## 175.1           1 1.8822249                     NA               NA</code></pre>

<p>The matrix <code>Xc</code> in the initial values has the same dimension as <code>Xc</code> in the
data. It has values where there are missing values in <code>Xc</code> in the data,
e.g., <code>Xc[83, 2]</code>, and is <code>NA</code> elsewhere:
</p>
<pre><code>## $Xc
##        [,1]       [,2] [,3] [,4]
##   [1,]   NA         NA   NA   NA
## 
## [...]
## 
##  [82,]   NA         NA   NA   NA
##  [83,]   NA  0.8028938   NA   NA
##  [84,]   NA         NA   NA   NA
## 
## [...]</code></pre>

<p>There are no initial values specified for the third and fourth column, since
these columns contain the dummy variables corresponding to the categorical
variable <code>SMOKE</code> and are calculated from the corresponding column in the matrix <code>Xcat</code>,
i.e., these are deterministic nodes, not stochastic nodes.</p>
<p>The relevant part of the JAGS model is:
</p>
<pre><code>## [...]
##     # ordinal model for SMOKE
##     Xcat[i, 1] ~ dcat(p_SMOKE[i, 1:3])
## [...]
##     Xc[i, 3] &lt;- ifelse(Xcat[i, 1] == 2, 1, 0)
##     Xc[i, 4] &lt;- ifelse(Xcat[i, 1] == 3, 1, 0)
## [...]</code></pre>

<p>Elements that are completely unobserved, like the parameter vectors <code>alpha</code>
and <code>beta</code>, the random effects <code>b</code> or scalar parameters <code>delta_SMOKE</code> and
<code>gamma_SMOKE</code> are entirely specified in the initial values.</p>
</div>
</div>
</div>
<div id="parallel-sampling" class="section level3">
<h3><span class="header-section-number">6.6.4</span> Parallel Sampling</h3>
<p>To reduce the computational time it is possible to perform sampling of multiple
MCMC chains in parallel. This can be specified by setting
the argument <code>parallel = TRUE</code>. The maximum number of cores to be used can be
set with the argument <code>ncores</code>. By default this is two less than the number of
cores available on the machine, but never more than the number of MCMC chains.</p>
<p>Parallel computation is done using the packages <strong>foreach</strong> <span class="citation">(Microsoft and Weston <a href="#ref-foreach" role="doc-biblioref">2017</a>)</span>
and <strong>doParallel</strong> <span class="citation">(Corporation and Weston <a href="#ref-doParallel" role="doc-biblioref">2018</a>)</span>.
Note that it is currently not possible to display a progress bar when using
parallel computation.</p>
</div>
</div>
<div id="sec:ResultsJSS" class="section level2">
<h2><span class="header-section-number">6.7</span> After Fitting</h2>
<p>Any of the main functions <code>*_imp()</code> will return an object of class <code>JointAI</code>.
It contains the original data (<code>data</code>),
information on the type of model (<code>call</code>, <code>analysis_type</code>, <code>models</code>,
<code>fixed</code>, <code>random</code>, <code>hyperpars</code>, <code>scale_pars</code>)
and MCMC sampling (<code>mcmc_settings</code>),
the JAGS model (<code>model</code>) and MCMC sample (<code>MCMC</code>; if a sample was
generated), the computational time (<code>time</code>)
of the MCMC sampling, and some additional
elements that are used by methods for objects of class <code>JointAI</code>
but are typically not of interest for the user.</p>
<p>In the remaining part of this section, we describe how the results from a
<code>JointAI</code> model can be visualized, summarized and evaluated.
The functions described here use, by default, the full MCMC sample
and show only the parameters of the analysis model.
Arguments <code>start</code>, <code>end</code> and <code>thin</code> are available to select a subset of the MCMC
samples that is used to calculate the summary. The argument <code>subset</code> allows the user to control
for which nodes the summary or visualization is returned
and follows the same logic as
the argument <code>monitor_params</code> in <code>*_imp()</code>.
The use of these arguments is further explained in Section <a href="ch-JSS.html#sec:subset">6.7.4</a>.</p>
<div id="visualizing-the-posterior-sample" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Visualizing the Posterior Sample</h3>
<p>The posterior sample can be visualized by two commonly used plots: a
traceplot, showing samples across iterations, and a plot of the empirical
density of the posterior sample.</p>
<div id="traceplot" class="section level4 unnumbered">
<h4>Traceplot</h4>
<p>A traceplot shows the sampled values per chain and node throughout
iterations. It allows the visual evaluation of convergence and mixing of the chains
and can be obtained with the function <code>traceplot()</code>.
</p>


<div class="figure" style="text-align: center"><span id="fig:traceplot15a"></span>
<img src="Dissertation_files/figure-html/traceplot15a-1.png" alt="Traceplot of `mod13a`." width="100%"  />
<p class="caption">
Figure 6.8: Traceplot of <code>mod13a</code>.
</p>
</div>


<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ch-JSS.html#cb77-1"></a>mod13a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st">  </span>creat,</span>
<span id="cb77-2"><a href="ch-JSS.html#cb77-2"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">500</span>)</span>
<span id="cb77-3"><a href="ch-JSS.html#cb77-3"></a></span>
<span id="cb77-4"><a href="ch-JSS.html#cb77-4"></a><span class="kw">traceplot</span>(mod13a)</span></code></pre></div>

<p>When the sampler has converged the chains show one horizontal band, as in
Figure <a href="ch-JSS.html#fig:traceplot15a">6.8</a>.
Consequently, when traces show a trend, convergence has not been
reached and more iterations are necessary (e.g., using <code>add_samples()</code>).</p>
<p>Graphical aspects of the traceplot can be controlled by specifying
standard graphical arguments via the dots argument <code>"..."</code>, which are passed to
<code>matplot()</code>.
This allows the user to change colour, linetype and -width, limits, etc.
Arguments <code>nrow</code> and/or <code>ncol</code> can be supplied to set specific numbers of
rows and columns for the layout of the grid of plots.</p>
<p>With the argument <code>use_ggplot</code> it is possible to get a <strong>ggplot2</strong> <span class="citation">(Wickham <a href="#ref-ggplot2" role="doc-biblioref">2016</a>)</span>
version of the traceplot. It can be extended using standard <strong>ggplot2</strong> syntax.
The output of the following syntax is shown in Figure <a href="ch-JSS.html#fig:ggtrace13a">6.9</a>.
</p>


<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="ch-JSS.html#cb78-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb78-2"><a href="ch-JSS.html#cb78-2"></a><span class="kw">traceplot</span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">use_ggplot =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb78-3"><a href="ch-JSS.html#cb78-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb78-4"><a href="ch-JSS.html#cb78-4"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">grey</span>(<span class="fl">0.95</span>)),</span>
<span id="cb78-5"><a href="ch-JSS.html#cb78-5"></a>        <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="kw">grey</span>(<span class="fl">0.85</span>)),</span>
<span id="cb78-6"><a href="ch-JSS.html#cb78-6"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="kw">grey</span>(<span class="fl">0.85</span>))) <span class="op">+</span></span>
<span id="cb78-7"><a href="ch-JSS.html#cb78-7"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#783D4F&quot;</span>, <span class="st">&quot;#60B5BC&quot;</span>, <span class="st">&quot;#6F5592&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ggtrace13a"></span>
<img src="Dissertation_files/figure-html/ggtrace13a-1.png" alt="**ggplot2** version of the traceplot of `mod13a`." width="100%"  />
<p class="caption">
Figure 6.9: <strong>ggplot2</strong> version of the traceplot of <code>mod13a</code>.
</p>
</div>

</div>
<div id="densityplot" class="section level4 unnumbered">
<h4>Densityplot</h4>
<p>The posterior distributions can also be visualized using the function <code>densplot()</code>,
which plots the empirical density per node per chain, or combining chains
(when <code>joined = TRUE</code>).</p>
<p>The argument <code>vlines</code> takes a list of lists, containing specifications passed
to the function <code>abline()</code> (from package <strong>graphics</strong> which is available
with base R),
and allows the addition of (vertical) lines to the plot, e.g., marking zero,
or marking the posterior mean and 2.5% and 97.5% quantiles (Figure <a href="ch-JSS.html#fig:densplot13a">6.10</a>).
</p>


<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ch-JSS.html#cb79-1"></a><span class="kw">densplot</span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb79-2"><a href="ch-JSS.html#cb79-2"></a>         <span class="dt">vlines =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">&quot;Mean&quot;</span>], <span class="dt">lty =</span> <span class="dv">1</span>,</span>
<span id="cb79-3"><a href="ch-JSS.html#cb79-3"></a>                            <span class="dt">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb79-4"><a href="ch-JSS.html#cb79-4"></a>                       <span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">&quot;2.5%&quot;</span>], <span class="dt">lty =</span> <span class="dv">2</span>),</span>
<span id="cb79-5"><a href="ch-JSS.html#cb79-5"></a>                       <span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">&quot;97.5%&quot;</span>], <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb79-6"><a href="ch-JSS.html#cb79-6"></a>         )</span>
<span id="cb79-7"><a href="ch-JSS.html#cb79-7"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:densplot13a"></span>
<img src="Dissertation_files/figure-html/densplot13a-1.png" alt="Densityplot of `mod13a`." width="100%"  />
<p class="caption">
Figure 6.10: Densityplot of <code>mod13a</code>.
</p>
</div>

<p>As with <code>traceplot()</code> it is possible to use the <strong>ggplot2</strong> version of <code>densplot()</code>
when setting <code>use_ggplot = TRUE</code>. Here, vertical lines can be added as additional
layers.
Figure <a href="ch-JSS.html#fig:ggdens13a">6.11</a> shows, as an example, the posterior density
from <code>mod13a</code> to which vertical lines, representing the 95% credible interval
and a 95% confidence interval from a complete case analysis, are added.
The corresponding syntax is given in <a href="ch-JSS.html#b-density-plot-using-ggplot2">Appendix 6.B</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:ggdens13a"></span>
<img src="Dissertation_files/figure-html/ggdens13a-1.png" alt="Densityplot of model `mod13a`." width="90%"  />
<p class="caption">
Figure 6.11: Densityplot of model <code>mod13a</code>.
</p>
</div>

</div>
</div>
<div id="model-summary" class="section level3">
<h3><span class="header-section-number">6.7.2</span> Model Summary</h3>
<p>A summary of the posterior distribution estimated in a <code>JointAI</code> model can be
obtained using the function <code>summary()</code>.</p>
<p>The posterior summary consists of the mean, standard deviation and
quantiles (by default the 2.5% and 97.5% quantiles) of the MCMC samples from all
chains combined, as well as the tail probability (see below) and Gelman-Rubin
criterion (see Section <a href="ch-JSS.html#sec:grcrit">6.7.3.1</a>).</p>
<p>Additionally, some important characteristics of the MCMC samples on which the
summary is based, are given. This includes the range and number of iterations
(<code>Sample size per chain</code>), thinning interval and number of chains.
Furthermore, the number of observations (number of rows in the data) is printed.
</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="ch-JSS.html#cb80-1"></a><span class="kw">summary</span>(mod13a)</span></code></pre></div>
<pre><code>## 
##  Linear model fitted with JointAI 
## 
## Call:
## lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, 
##     n.iter = 500)
## 
## Posterior summary:
##                Mean    SD   2.5%   97.5% tail-prob. GR-crit
## (Intercept)  81.368 9.844 61.972 100.732     0.0000    1.01
## genderfemale  0.353 2.541 -4.826   5.421     0.8907    1.01
## WC            0.302 0.073  0.159   0.441     0.0000    1.00
## alc&gt;=1        6.219 2.456  1.321  10.984     0.0147    1.01
## creat         7.939 7.586 -7.465  22.848     0.2973    1.01
## 
## Posterior summary of residual std. deviation:
##           Mean    SD 2.5% 97.5% GR-crit
## sigma_SBP 14.4 0.758   13  15.9       1
## 
## 
## MCMC settings:
## Iterations = 101:600
## Sample size per chain = 500 
## Thinning interval = 1 
## Number of chains = 3 
## 
## Number of observations: 186</code></pre>

<p>For mixed models, <code>summary()</code> also returns the posterior summary of the
random effects covariance matrix <code>D</code> and the number of groups:
</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="ch-JSS.html#cb82-1"></a><span class="kw">library</span>(splines)</span>
<span id="cb82-2"><a href="ch-JSS.html#cb82-2"></a>mod13b &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>),</span>
<span id="cb82-3"><a href="ch-JSS.html#cb82-3"></a>                  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>)<span class="op">|</span>ID, </span>
<span id="cb82-4"><a href="ch-JSS.html#cb82-4"></a>                  <span class="dt">data =</span> <span class="kw">subset</span>(simLong, <span class="op">!</span><span class="kw">is.na</span>(bmi)),</span>
<span id="cb82-5"><a href="ch-JSS.html#cb82-5"></a>                  <span class="dt">n.iter =</span> <span class="dv">500</span>, <span class="dt">no_model =</span> <span class="st">&#39;age&#39;</span>)</span>
<span id="cb82-6"><a href="ch-JSS.html#cb82-6"></a></span>
<span id="cb82-7"><a href="ch-JSS.html#cb82-7"></a><span class="kw">summary</span>(mod13b, <span class="dt">start =</span> <span class="dv">300</span>)</span></code></pre></div>

<pre><code>##  Linear mixed model fitted with JointAI 
## 
## Call:
## lme_imp(fixed = bmi ~ GESTBIR + ETHN + HEIGHT_M + ns(age, df = 3), 
##     data = subset(simLong, !is.na(bmi)), random = ~ns(age, df = 3) | 
##         ID, n.iter = 500, no_model = &quot;age&quot;)
## 
## Posterior summary:
##                      Mean      SD    2.5%   97.5% tail-prob. GR-crit
## (Intercept)      16.31448 2.31751 11.9351 21.0625      0.000    1.06
## GESTBIR          -0.03379 0.04371 -0.1258  0.0466      0.463    1.03
## ETHNother        -0.00247 0.15991 -0.3029  0.3288      0.999    1.10
## HEIGHT_M          0.00545 0.00947 -0.0144  0.0247      0.560    1.04
## ns(age, df = 3)1 -0.30356 0.06287 -0.4186 -0.1834      0.000    3.12
## ns(age, df = 3)2  1.62073 0.19038  1.2633  1.9926      0.000    2.44
## ns(age, df = 3)3 -1.29077 0.06674 -1.4097 -1.1670      0.000    2.94
## 
## Posterior summary of random effects covariance matrix:
##          Mean     SD   2.5%  97.5% tail-prob. GR-crit
## D[1,1]  1.439 0.1694  1.132  1.788               1.04
## D[1,2] -0.774 0.1126 -1.010 -0.573          0    1.18
## D[2,2]  0.735 0.0971  0.569  0.946               1.09
## D[1,3] -2.541 0.3590 -3.300 -1.873          0    1.07
## D[2,3]  2.424 0.2785  1.942  3.027          0    1.01
## D[3,3]  8.222 0.9635  6.549 10.314               1.08
## D[1,4] -0.741 0.1003 -0.957 -0.550          0    1.08
## D[2,4]  0.626 0.0743  0.492  0.783          0    1.04
## D[3,4]  2.096 0.2492  1.626  2.621          0    1.08
## D[4,4]  0.561 0.0767  0.422  0.717               1.22
## 
## Posterior summary of residual std. deviation:
##            Mean      SD  2.5% 97.5% GR-crit
## sigma_bmi 0.457 0.00876 0.441 0.475       1
## 
## 
## MCMC settings:
## Iterations = 300:600
## Sample size per chain = 301 
## Thinning interval = 1 
## Number of chains = 3 
## 
## Number of observations: 1881 
## Number of groups: 200</code></pre>

<p>The summary of parametric Weibull survival models also returns the summary of
the posterior sample of the shape parameter of the Weibull distribution:
</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="ch-JSS.html#cb84-1"></a><span class="kw">summary</span>(mod6a)</span></code></pre></div>
<pre><code>## 
##  Weibull survival model fitted with JointAI 
## 
## Call:
## survreg_imp(formula = Surv(time, status) ~ age + sex + ph.karno + 
##     meal.cal + wt.loss, data = lung, n.iter = 250)
## 
## Posterior summary:
##                  Mean       SD      2.5%    97.5% tail-prob. GR-crit
## (Intercept)  5.58e+00 0.741546  4.19e+00 6.935742     0.0000    1.06
## age         -8.67e-03 0.007618 -2.38e-02 0.006025     0.2640    1.09
## sex2         4.22e-01 0.140230  1.39e-01 0.703982     0.0000    1.01
## ph.karno     9.28e-03 0.004567 -4.53e-05 0.018862     0.0533    1.05
## meal.cal     7.23e-05 0.000184 -2.59e-04 0.000426     0.7040    1.14
## wt.loss      1.69e-03 0.004738 -7.54e-03 0.011345     0.7413    1.00
## 
## Posterior summary of the shape of the Weibull distribution:
##       Mean    SD 2.5% 97.5% GR-crit
## shape  1.3 0.081 1.13  1.45    1.05
## 
## 
## MCMC settings:
## Iterations = 101:350
## Sample size per chain = 250 
## Thinning interval = 1 
## Number of chains = 3 
## 
## Number of observations: 228</code></pre>

<div id="tail-probability" class="section level4 unnumbered">
<h4>Tail Probability</h4>
<p>The tail probability, calculated as
<span class="math inline">\(2\times\min\left\{Pr(\theta &gt; 0), Pr(\theta &lt; 0)\right\},\)</span>
where <span class="math inline">\(\theta\)</span> is the parameter of interest,
is a measure of how likely the value 0 is under the
estimated posterior distribution.
Figure <a href="ch-JSS.html#fig:tailprob">6.12</a> visualizes three examples of posterior distributions
and the corresponding minimum of <span class="math inline">\(Pr(\theta &gt; 0)\)</span> and <span class="math inline">\(Pr(\theta &lt; 0)\)</span>
(shaded area).
</p>
<div class="figure" style="text-align: center"><span id="fig:tailprob"></span>
<img src="Dissertation_files/figure-html/tailprob-1.png" alt="Visualization of the tail probability." width="100%"  />
<p class="caption">
Figure 6.12: Visualization of the tail probability.
</p>
</div>

</div>
</div>
<div id="evaluation-criteria" class="section level3">
<h3><span class="header-section-number">6.7.3</span> Evaluation Criteria</h3>
<p>Convergence of the MCMC chains and precision of the posterior sample can also
be evaluated in a more formal manner. Implemented in <strong>JointAI</strong> are
the Gelman-Rubin criterion for convergence <span class="citation">(Gelman and Rubin <a href="#ref-Gelman1992" role="doc-biblioref">1992</a>; Brooks and Gelman <a href="#ref-Brooks1998" role="doc-biblioref">1998</a>)</span>
and a comparison of the Monte Carlo Error with the posterior standard deviation.</p>
<div id="sec:grcrit" class="section level4">
<h4><span class="header-section-number">6.7.3.1</span> Gelman-Rubin Criterion for Convergence</h4>
<p>The Gelman-Rubin criterion <span class="citation">(Gelman and Rubin <a href="#ref-Gelman1992" role="doc-biblioref">1992</a>; Brooks and Gelman <a href="#ref-Brooks1998" role="doc-biblioref">1998</a>)</span>,
also referred to as “potential scale reduction factor”,
evaluates convergence by comparing
within and between chain variability and, thus, requires at least two MCMC chains
to be calculated.
It is implemented for <code>JointAI</code> objects in the function <code>GR_crit()</code>, which
is based on the function <code>gelman.diag()</code> from the package <strong>coda</strong> <span class="citation">(Plummer et al. <a href="#ref-coda" role="doc-biblioref">2006</a>)</span>.
The upper limit of the confidence interval should not be much larger than 1.
</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="ch-JSS.html#cb86-1"></a><span class="kw">GR_crit</span>(mod13a)</span></code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##              Point est. Upper C.I.
## (Intercept)        1.00       1.01
## genderfemale       1.00       1.01
## WC                 1.00       1.01
## alc&gt;=1             1.01       1.03
## creat              1.00       1.00
## sigma_SBP          1.00       1.00
## 
## Multivariate psrf
## 
## 1.01</code></pre>

<p>Besides the arguments <code>start</code>, <code>end</code>, <code>thin</code>, and <code>subset</code>, which are explained
in Section <a href="ch-JSS.html#sec:subset">6.7.4</a>, <code>GR_crit()</code> also takes the arguments <code>confidence</code>,
<code>transform</code> and <code>autoburnin</code> of <code>gelman.diag()</code>.</p>
</div>
<div id="sec:mcerror" class="section level4">
<h4><span class="header-section-number">6.7.3.2</span> Monte Carlo Error</h4>
<p>Precision of the MCMC sample can be checked with the function
<code>MC_error()</code>.
It uses the function <code>mcmcse.mat()</code> from the package <strong>mcmcse</strong> <span class="citation">(Flegal et al. <a href="#ref-mcmcse" role="doc-biblioref">2017</a>)</span>
to calculate the Monte Carlo error (the error that is made since the sample
is finite) and compares is to the standard deviation of the posterior sample.
A rule of thumb is that the Monte Carlo error should not be more than 5% of the
standard deviation <span class="citation">(Lesaffre and Lawson <a href="#ref-Lesaffre2012" role="doc-biblioref">2012</a>)</span>.
Besides the arguments explained in Section <a href="ch-JSS.html#sec:subset">6.7.4</a>, <code>MC_error()</code>
takes the arguments of <code>mcmcse.mat()</code>.
</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="ch-JSS.html#cb88-1"></a><span class="kw">MC_error</span>(mod13a)</span></code></pre></div>
<pre><code>##                est   MCSE    SD MCSE/SD
## (Intercept)  81.37 0.2896 9.844   0.029
## genderfemale  0.35 0.0750 2.541   0.029
## WC            0.30 0.0016 0.073   0.022
## alc&gt;=1        6.22 0.0912 2.456   0.037
## creat         7.94 0.2387 7.586   0.031
## sigma_SBP    14.37 0.0222 0.758   0.029</code></pre>

<p><code>MC_error()</code> returns an object of class <code>MCElist</code>, which is a list containing
matrices with the posterior mean,
estimated Monte Carlo error, posterior standard deviation and the ratio of the
Monte Carlo error and posterior standard deviation, for the scaled
(if this MCMC sample was included in the <code>JointAI</code> object)
and unscaled (transformed back to the scale of the data) posterior samples.
The associated print method prints only the latter.</p>
<p>To facilitate quick evaluation of the Monte Carlo error to posterior standard
deviation ratio, plotting of an object of class <code>MCElist</code> using <code>plot()</code> shows
this ratio for each (selected) node and automatically adds a vertical line at
the desired cut-off (by default 5%; see Figure <a href="ch-JSS.html#fig:MCE13a">6.13</a>).
</p>


<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="ch-JSS.html#cb90-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">0.6</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb90-2"><a href="ch-JSS.html#cb90-2"></a><span class="kw">plot</span>(<span class="kw">MC_error</span>(mod13a))  <span class="co"># left panel</span></span>
<span id="cb90-3"><a href="ch-JSS.html#cb90-3"></a><span class="kw">plot</span>(<span class="kw">MC_error</span>(mod13a, <span class="dt">end =</span> <span class="dv">250</span>))  <span class="co"># right panel</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:MCE13a"></span>
<img src="Dissertation_files/figure-html/MCE13a-1.png" alt="Plot of the `MCElist` object from `mod13a`. Left: including
all iterations, right: using only the first 250 iterations of the MCMC sample." width="100%"  />
<p class="caption">
Figure 6.13: Plot of the <code>MCElist</code> object from <code>mod13a</code>. Left: including
all iterations, right: using only the first 250 iterations of the MCMC sample.
</p>
</div>

</div>
</div>
<div id="sec:subset" class="section level3">
<h3><span class="header-section-number">6.7.4</span> Subset of Output</h3>
<p>By default, the functions <code>traceplot()</code>, <code>densplot()</code>, <code>summary()</code>, <code>predict()</code>,
<code>GR_crit()</code> and <code>MC_Error()</code> use all iterations of the MCMC sample and consider
only the parameters of the analysis model (if they were monitored).
In this section we describe how the
set of iterations and parameters/nodes to display can be changed using the
arguments <code>subset</code>, <code>start</code>, <code>end</code> and <code>thin</code>.</p>
<div id="subset-of-parameters" class="section level4 unnumbered">
<h4>Subset of Parameters</h4>
<p>When the main parameters of the analysis model have been monitored in a
<code>JointAI</code> object, i.e., when <code>monitor_params</code> was set to <code>TRUE</code>,
only these parameters are returned in the model summary, plots and criteria
shown above.
If the main parameters of the analysis model were not monitored and the
argument <code>subset</code> is not specified, all parameters that were monitored are
displayed.</p>
<p>To display output for nodes other than the main parameters of the analysis model
or for a subset of nodes, the argument <code>subset</code> needs to be specified.</p>
<div id="example-1" class="section level5">
<h5><span class="header-section-number">6.7.4.0.1</span> Example:</h5>
<p>To display only the parameters of the imputation models, we
set <code>subset = c(analysis_main = FALSE, imp_pars = TRUE)</code> (after re-estimating
the model with the monitoring for these parameters switched on):
</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="ch-JSS.html#cb91-1"></a>mod13c &lt;-<span class="st"> </span><span class="kw">update</span>(mod13a, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imp_pars =</span> <span class="ot">TRUE</span>))</span>
<span id="cb91-2"><a href="ch-JSS.html#cb91-2"></a><span class="kw">summary</span>(mod13c, <span class="dt">subset =</span> <span class="kw">c</span>(<span class="dt">analysis_main =</span> <span class="ot">FALSE</span>, <span class="dt">imp_pars =</span> <span class="ot">TRUE</span>))</span></code></pre></div>

<pre><code>##  Linear model fitted with JointAI 
## 
## Call:
## lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, 
##     n.iter = 500, monitor_params = c(imp_pars = TRUE))
## 
## Posterior summary:
##              Mean     SD    2.5%   97.5% tail-prob. GR-crit
## alpha[1]   0.1624 0.0990 -0.0327  0.3598     0.1000    1.00
## alpha[2]  -0.3506 0.1484 -0.6414 -0.0557     0.0173    1.00
## alpha[3]   0.4901 0.0902  0.3078  0.6633     0.0000    1.01
## alpha[4]  -1.0338 0.1331 -1.2930 -0.7647     0.0000    1.01
## alpha[5]   0.0775 0.0666 -0.0522  0.2084     0.2587    1.00
## alpha[6]  -0.1277 0.2449 -0.6010  0.3807     0.5880    1.01
## alpha[7]  -0.8928 0.4133 -1.6684 -0.0750     0.0320    1.01
## alpha[8]   0.0887 0.1769 -0.2568  0.4329     0.6373    1.01
## alpha[9]  -0.2627 0.2086 -0.6772  0.1529     0.2080    1.00
## tau_WC     1.0280 0.1083  0.8277  1.2551     0.0000    1.01
## tau_creat  1.3997 0.1525  1.1064  1.7261     0.0000    1.01
## 
## 
## MCMC settings:
## Iterations = 101:600
## Sample size per chain = 500 
## Thinning interval = 1 
## Number of chains = 3 
## 
## Number of observations: 186</code></pre>

</div>
<div id="example-2" class="section level5 unnumbered">
<h5>Example:</h5>
<p>To select only some of the parameters, they can be specified directly by
name via the <code>other</code> element of <code>subset</code>.
</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ch-JSS.html#cb93-1"></a><span class="kw">densplot</span>(mod13a, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&#39;creat&#39;</span>, <span class="st">&#39;alc&gt;=1&#39;</span>)))</span></code></pre></div>

</div>
<div id="example-3" class="section level5 unnumbered">
<h5>Example:</h5>
<p>This also works when a subset of the imputed values should be displayed:
</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="ch-JSS.html#cb94-1"></a><span class="co"># re-fit the model and monitor the imputed values</span></span>
<span id="cb94-2"><a href="ch-JSS.html#cb94-2"></a>mod13d &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>albu <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>alc, <span class="dt">n.iter =</span> <span class="dv">200</span>,</span>
<span id="cb94-3"><a href="ch-JSS.html#cb94-3"></a>                 <span class="dt">data =</span> NHANES, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imps =</span> <span class="ot">TRUE</span>))</span>
<span id="cb94-4"><a href="ch-JSS.html#cb94-4"></a></span>
<span id="cb94-5"><a href="ch-JSS.html#cb94-5"></a><span class="co"># select all imputed values for &#39;albu&#39; (4th column of Xc)</span></span>
<span id="cb94-6"><a href="ch-JSS.html#cb94-6"></a>sub3 &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&#39;Xc</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,4</span><span class="ch">\\</span><span class="st">]&#39;</span>, <span class="kw">parameters</span>(mod13d), <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb94-7"><a href="ch-JSS.html#cb94-7"></a>sub3</span></code></pre></div>
<pre><code>## [1] &quot;Xc[10,4]&quot;  &quot;Xc[14,4]&quot;  &quot;Xc[18,4]&quot;  &quot;Xc[25,4]&quot;  &quot;Xc[80,4]&quot;  &quot;Xc[118,4]&quot;
## [7] &quot;Xc[172,4]&quot; &quot;Xc[180,4]&quot;</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="ch-JSS.html#cb96-1"></a><span class="co"># pass &quot;sub3&quot; to &quot;subset&quot; via &quot;other&quot;, for example in a traceplot:</span></span>
<span id="cb96-2"><a href="ch-JSS.html#cb96-2"></a><span class="co"># traceplot(mod13d, subset = list(other = sub3), ncol = 2)</span></span></code></pre></div>

</div>
<div id="example-4" class="section level5 unnumbered">
<h5>Example:</h5>
<p>When the number of imputed values is large or in order to check convergence
of random effects, it may not be feasible to plot and inspect all traceplots.
In that case, a random subset of, for instance, the random effects, can be selected
(output not shown):
</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ch-JSS.html#cb97-1"></a><span class="co"># re-fit the model monitoring the random effects</span></span>
<span id="cb97-2"><a href="ch-JSS.html#cb97-2"></a>mod13e &lt;-<span class="st"> </span><span class="kw">update</span>(mod13a, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">ranef =</span> <span class="ot">TRUE</span>))</span>
<span id="cb97-3"><a href="ch-JSS.html#cb97-3"></a></span>
<span id="cb97-4"><a href="ch-JSS.html#cb97-4"></a><span class="co"># extract random intercepts and random slopes</span></span>
<span id="cb97-5"><a href="ch-JSS.html#cb97-5"></a>ri &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&#39;^b</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,1</span><span class="ch">\\</span><span class="st">]$&#39;</span>, <span class="kw">colnames</span>(mod13e<span class="op">$</span>MCMC[[<span class="dv">1</span>]]),</span>
<span id="cb97-6"><a href="ch-JSS.html#cb97-6"></a>           <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb97-7"><a href="ch-JSS.html#cb97-7"></a>rs &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&#39;^b</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,2</span><span class="ch">\\</span><span class="st">]$&#39;</span>, <span class="kw">colnames</span>(mod13e<span class="op">$</span>MCMC[[<span class="dv">1</span>]]),</span>
<span id="cb97-8"><a href="ch-JSS.html#cb97-8"></a>           <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb97-9"><a href="ch-JSS.html#cb97-9"></a></span>
<span id="cb97-10"><a href="ch-JSS.html#cb97-10"></a><span class="co"># to plot the chains of 12 randomly selected random intercepts &amp; slopes:</span></span>
<span id="cb97-11"><a href="ch-JSS.html#cb97-11"></a><span class="kw">traceplot</span>(mod13e, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">sample</span>(ri, <span class="dt">size =</span> <span class="dv">12</span>)), <span class="dt">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb97-12"><a href="ch-JSS.html#cb97-12"></a><span class="kw">traceplot</span>(mod13e, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">sample</span>(rs, <span class="dt">size =</span> <span class="dv">12</span>)), <span class="dt">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>

</div>
</div>
<div id="sec:startend" class="section level4">
<h4><span class="header-section-number">6.7.4.1</span> Subset of MCMC Samples</h4>
<p>With the arguments <code>start</code>, <code>end</code> and <code>thin</code> it is possible to
select which iterations from the MCMC sample are included in the summary.
<code>start</code> and <code>end</code> specify the first and last iterations to be used,
<code>thin</code> the thinning interval. Specification of <code>start</code> thus allows the user to discard
a “burn-in”, i.e., the iterations before the MCMC chain had converged.</p>
</div>
</div>
<div id="predicted-values" class="section level3">
<h3><span class="header-section-number">6.7.5</span> Predicted Values</h3>
<p>Often, the aim of an analysis is not only to estimate the association between outcome
and covariates but to predict future outcomes or outcomes for new subjects.</p>
<p>The function <code>predict()</code> allows us to obtain predicted values and corresponding
credible intervals from <code>JointAI</code> objects. Note that for mixed
models, currently only marginal prediction is implemented, not prediction conditional on
the random effects.
A dataset containing data for which the prediction should be performed for is specified
via the argument <code>newdata</code>. The argument <code>quantiles</code> allows specification of the
quantiles of the posterior sample that are used to obtain the prediction interval
(by default the 2.5% and 97.5% quantile).
Arguments <code>start</code>, <code>end</code> and <code>thin</code> control the subset of MCMC samples used.</p>



<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="ch-JSS.html#cb98-1"></a><span class="kw">predict</span>(mod13a, <span class="dt">newdata =</span> NHANES[<span class="dv">27</span>, ])</span></code></pre></div>
<pre><code>## $dat
##          SBP gender age             race   WC alc educ creat albu uricacid
## 392 126.6667   male  32 Mexican American 94.1  &lt;1  low  0.83  4.2      8.7
##     bili occup  smoke      fit     2.5%    97.5%
## 392    1  &lt;NA&gt; former 116.3997 112.5729 120.2564
## 
## $fit
## [1] 116.3997
## 
## $quantiles
##           [,1]
## 2.5%  112.5729
## 97.5% 120.2564</code></pre>

<p><code>predict()</code> returns a list with elements <code>dat</code> (a dataset consisting of
<code>newdata</code> with the predicted values and quantiles appended),
<code>fit</code> (the predicted values) and <code>quantiles</code> (the quantiles that form the
prediction interval).</p>
<div id="prediction-to-visualize-non-linear-effects" class="section level4 unnumbered">
<h4>Prediction to Visualize Non-linear Effects</h4>
<p>Another reason to obtain predicted values is the visualization of non-linear
effects (see Figure <a href="ch-JSS.html#fig:predvis">6.14</a>).
To facilitate the generation of a dataset for such a prediction,
the function <code>predDF()</code> can be used. It generates a <code>data.frame</code>
that contains a sequence of values through the range of observed values for a
covariate specified by the argument <code>var</code>, and the median or reference value for
all other continuous and categorical variables.
</p>


<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="ch-JSS.html#cb100-1"></a><span class="co"># create dataset for prediction</span></span>
<span id="cb100-2"><a href="ch-JSS.html#cb100-2"></a>newDF &lt;-<span class="st"> </span><span class="kw">predDF</span>(mod13b, <span class="dt">var =</span> <span class="st">&quot;age&quot;</span>)</span>
<span id="cb100-3"><a href="ch-JSS.html#cb100-3"></a></span>
<span id="cb100-4"><a href="ch-JSS.html#cb100-4"></a><span class="co"># obtain predicted values</span></span>
<span id="cb100-5"><a href="ch-JSS.html#cb100-5"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(mod13b, <span class="dt">newdata =</span> newDF, <span class="dt">start =</span> <span class="dv">300</span>)</span>
<span id="cb100-6"><a href="ch-JSS.html#cb100-6"></a></span>
<span id="cb100-7"><a href="ch-JSS.html#cb100-7"></a><span class="co"># plot predicted values and prediction interval</span></span>
<span id="cb100-8"><a href="ch-JSS.html#cb100-8"></a><span class="kw">matplot</span>(pred<span class="op">$</span>dat<span class="op">$</span>age, pred<span class="op">$</span>dat[, <span class="kw">c</span>(<span class="st">&#39;fit&#39;</span>, <span class="st">&#39;2.5%&#39;</span>, <span class="st">&#39;97.5%&#39;</span>)],</span>
<span id="cb100-9"><a href="ch-JSS.html#cb100-9"></a>        <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">col =</span> <span class="dv">1</span>,</span>
<span id="cb100-10"><a href="ch-JSS.html#cb100-10"></a>        <span class="dt">xlab =</span> <span class="st">&#39;age in months&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;predicted value&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:predvis"></span>
<img src="Dissertation_files/figure-html/predvis-1.png" alt="Predicted values of BMI and corresponding 95% credible intervals from `mod13b`." width="90%"  />
<p class="caption">
Figure 6.14: Predicted values of BMI and corresponding 95% credible intervals from <code>mod13b</code>.
</p>
</div>

</div>
</div>
<div id="sec:getMIdat" class="section level3">
<h3><span class="header-section-number">6.7.6</span> Export of Imputed Values</h3>
<p>Imputed datasets can be extracted from a <code>JointAI</code> object (in which a monitor for
the imputed values has been set, i.e., <code>monitor_params = c(imps = TRUE)</code>)
with the function <code>get_MIdat()</code>.</p>
<p>A completed dataset is created by taking the imputed values from a randomly
chosen iteration of the MCMC sample, transforming them back to the original scale
(if scaling was performed before the MCMC sampling)
and filling them into the original incomplete data.</p>
<p>The argument <code>m</code> specifies the number of imputed datasets to be created,
<code>include</code> controls whether the original data are included in the long format
<code>data.frame</code> (default is <code>include = TRUE</code>),
<code>start</code> specifies the first iteration that may be used,
and <code>minspace</code> is the minimum number of iterations between
iterations eligible for selection.
To make the selection of iterations reproducible, a
seed value can be specified via the argument <code>seed</code>.</p>
<p>When <code>export_to_SPSS = TRUE</code> the imputed data is exported to SPSS
(IBM SPSS Statistics, IBM Corp.), i.e.,
a <code>.txt</code> file containing the data and a <code>.sps</code> file containing SPSS syntax to
convert the data into an SPSS data file (with ending <code>.sav</code>) are written.
Arguments <code>filename</code> and <code>resdir</code> allow specification of the name of the <code>.txt</code> and
<code>.sps</code> file and the directory they are written to.</p>
<p><code>get_MIdat()</code> returns a long-format <code>data.frame</code> containing the imputed datasets
(and by default the original data) stacked on top of each other. The imputation number
is given in the variable <code>Imputation_</code>, column <code>.id</code> contains a newly created
id variable for each observation in cross-sectional data (multi-level data should
already contain an id variable) and the column <code>.rownr</code> identifies rows of the
original data (which is relevant in multi-level data).</p>

<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="ch-JSS.html#cb101-1"></a>impDF &lt;-<span class="st"> </span><span class="kw">get_MIdat</span>(mod13d, <span class="dt">m =</span> <span class="dv">5</span>, <span class="dt">seed =</span> <span class="dv">2019</span>)</span></code></pre></div>

<p>The function <code>plot_imp_distr()</code> allows visual comparison of the
distributions of the observed and imputed values (Figure <a href="ch-JSS.html#fig:impcomp">6.15</a>).
</p>


<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="ch-JSS.html#cb102-1"></a><span class="kw">plot_imp_distr</span>(impDF, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:impcomp"></span>
<img src="Dissertation_files/figure-html/impcomp-1.png" alt="Distribution of observed and imputed values from `mod13d`." width="100%"  />
<p class="caption">
Figure 6.15: Distribution of observed and imputed values from <code>mod13d</code>.
</p>
</div>

</div>
</div>
<div id="assumptions-and-extensions" class="section level2">
<h2><span class="header-section-number">6.8</span> Assumptions and Extensions</h2>
<p>Like any statistical model, the approach to imputation followed in <strong>JointAI</strong>
relies on assumptions that need to be satisfied in order to obtain valid results.</p>
<p>A commonly made assumption that is also required for <strong>JointAI</strong> is that
the missing data mechanism is ignorable, i.e., that data is Missing At Random (MAR)
or Missing Completely At Random (MCAR) <span class="citation">(Rubin <a href="#ref-Rubin1976" role="doc-biblioref">1976</a>,)</span> and that parameters
in the model of the missingness mechanism are independent of the parameters
in the data model <span class="citation">(Schafer <a href="#ref-Schafer1997" role="doc-biblioref">1997</a>)</span>.
It is the task of the researcher to critically evaluate whether this assumption
is satisfied for a given dataset and model.</p>
<p>Furthermore, all models involved in the imputation and analysis need to be
correctly specified. In current implementations of imputation procedures in
software, imputation models are typically automatically specified, using
standard assumptions like linear associations and default model types.
In <strong>JointAI</strong>, the arguments <code>models</code> and <code>auxvar</code> permit tailoring of the
automatically chosen models to some extent, by allowing the user to chose non-normal
imputation models for continuous variables and to include variables or functional
forms of variables in the linear predictor of the imputation models that are
not used in the analysis model.</p>
<p>When using auxiliary variables in <strong>JointAI</strong>, it should be noted that
due to the ordering of the conditional distributions in the sequence of models
it is implied that the auxiliary variable is independent of the outcome,
since neither the model for the auxiliary variable (if the auxiliary variable
has missing values) has the outcome in its linear predictor nor vice versa.</p>
<p>Moreover, in order to make software usable, default values have to be chosen
for various parameters. These default values are chosen to work well in certain
settings, but can not be guaranteed to be appropriate in general and it is the
task of the user to make the appropriate changes. In <strong>JointAI</strong> this
concerns, for example, the choice of hyperparameters and automatically chosen
types of imputation models.</p>
<p>To expand the range of settings in which <strong>JointAI</strong> provides a valid and
user-friendly way to simultaneously analyse and impute data, several extensions are
planned, for example:
</p>
<ul>
<li><p>Implement the use of (penalized) splines for incompletely observed covariates,
thereby improving model fit.</p></li>
<li><p>Increase the flexibility of imputation models by optional inclusion of
interaction terms and non-parametric Bayesian models that allow imputation
under non-standard distributions.</p></li>
<li><p>Evaluation of model fit of the analysis and imputation models to help the
user prevent bias due to misspecification.</p></li>
<li><p>Implementation of subject-specific prediction from mixed models.</p></li>
<li><p>Extend the analysis models to handle endogenous covariates by modelling
random effects (and error terms) jointly.</p></li>
</ul>
</div>
<div id="appendix-4" class="section level2 unnumbered">
<h2>Appendix</h2>
<div id="a-default-hyperparameters" class="section level3 unnumbered">
<h3>6.A Default Hyperparameters</h3>

<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="ch-JSS.html#cb103-1"></a><span class="kw">default_hyperpars</span>()</span></code></pre></div>
<pre><code>## $norm
##    mu_reg_norm   tau_reg_norm shape_tau_norm  rate_tau_norm 
##          0e+00          1e-04          1e-02          1e-02 
## 
## $gamma
##    mu_reg_gamma   tau_reg_gamma shape_tau_gamma  rate_tau_gamma 
##           0e+00           1e-04           1e-02           1e-02 
## 
## $beta
##    mu_reg_beta   tau_reg_beta shape_tau_beta  rate_tau_beta 
##          0e+00          1e-04          1e-02          1e-02 
## 
## $logit
##  mu_reg_logit tau_reg_logit 
##         0e+00         1e-04 
## 
## $poisson
##  mu_reg_poisson tau_reg_poisson 
##           0e+00           1e-04 
## 
## $probit
##  mu_reg_probit tau_reg_probit 
##          0e+00          1e-04 
## 
## $multinomial
##  mu_reg_multinomial tau_reg_multinomial 
##               0e+00               1e-04 
## 
## $ordinal
##    mu_reg_ordinal   tau_reg_ordinal  mu_delta_ordinal tau_delta_ordinal 
##             0e+00             1e-04             0e+00             1e-04 
## 
## $Z
## function (nranef) 
## {
##     if (nranef &gt; 1) {
##         RinvD &lt;- diag(as.numeric(rep(NA, nranef)))
##         KinvD &lt;- nranef
##     }
##     else {
##         RinvD &lt;- KinvD &lt;- NULL
##     }
##     list(RinvD = RinvD, KinvD = KinvD, shape_diag_RinvD = 0.1, 
##         rate_diag_RinvD = 0.01)
## }
## &lt;bytecode: 0x000000001d177070&gt;
## &lt;environment: 0x000000001d173e10&gt;
## 
## $surv
##  mu_reg_surv tau_reg_surv 
##        0.000        0.001 
## 
## $coxph
##     c     r   eps 
## 1e-03 1e-01 1e-10</code></pre>

</div>
<div id="b-density-plot-using-ggplot2" class="section level3 unnumbered">
<h3>6.B Density Plot using ggplot2</h3>

<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="ch-JSS.html#cb105-1"></a><span class="co"># fit the complete-case version of the model</span></span>
<span id="cb105-2"><a href="ch-JSS.html#cb105-2"></a>mod13a_cc &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">formula</span>(mod13a), <span class="dt">data =</span> NHANES)</span>
<span id="cb105-3"><a href="ch-JSS.html#cb105-3"></a></span>
<span id="cb105-4"><a href="ch-JSS.html#cb105-4"></a></span>
<span id="cb105-5"><a href="ch-JSS.html#cb105-5"></a><span class="co"># make a dataset containing the quantiles of the posterior sample and</span></span>
<span id="cb105-6"><a href="ch-JSS.html#cb105-6"></a><span class="co"># confidence intervals from the complete case analysis:</span></span>
<span id="cb105-7"><a href="ch-JSS.html#cb105-7"></a>quantDF &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">rownames</span>(<span class="kw">summary</span>(mod13a)<span class="op">$</span>stat),</span>
<span id="cb105-8"><a href="ch-JSS.html#cb105-8"></a>                            <span class="dt">type =</span> <span class="st">&#39;2.5%&#39;</span>,</span>
<span id="cb105-9"><a href="ch-JSS.html#cb105-9"></a>                            <span class="dt">model =</span> <span class="st">&#39;JointAI&#39;</span>,</span>
<span id="cb105-10"><a href="ch-JSS.html#cb105-10"></a>                            <span class="dt">value =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stat[, <span class="kw">c</span>(<span class="st">&#39;2.5%&#39;</span>)]</span>
<span id="cb105-11"><a href="ch-JSS.html#cb105-11"></a>                            ),</span>
<span id="cb105-12"><a href="ch-JSS.html#cb105-12"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">rownames</span>(<span class="kw">summary</span>(mod13a)<span class="op">$</span>stat),</span>
<span id="cb105-13"><a href="ch-JSS.html#cb105-13"></a>                            <span class="dt">type =</span> <span class="st">&#39;97.5%&#39;</span>,</span>
<span id="cb105-14"><a href="ch-JSS.html#cb105-14"></a>                            <span class="dt">model =</span> <span class="st">&#39;JointAI&#39;</span>,</span>
<span id="cb105-15"><a href="ch-JSS.html#cb105-15"></a>                            <span class="dt">value =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stat[, <span class="kw">c</span>(<span class="st">&#39;97.5%&#39;</span>)]</span>
<span id="cb105-16"><a href="ch-JSS.html#cb105-16"></a>                 ),</span>
<span id="cb105-17"><a href="ch-JSS.html#cb105-17"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">names</span>(<span class="kw">coef</span>(mod13a_cc)),</span>
<span id="cb105-18"><a href="ch-JSS.html#cb105-18"></a>                            <span class="dt">type =</span> <span class="st">&#39;2.5%&#39;</span>,</span>
<span id="cb105-19"><a href="ch-JSS.html#cb105-19"></a>                            <span class="dt">model =</span> <span class="st">&#39;cc&#39;</span>,</span>
<span id="cb105-20"><a href="ch-JSS.html#cb105-20"></a>                            <span class="dt">value =</span> <span class="kw">confint</span>(mod13a_cc)[, <span class="st">&#39;2.5 %&#39;</span>]</span>
<span id="cb105-21"><a href="ch-JSS.html#cb105-21"></a>                 ),</span>
<span id="cb105-22"><a href="ch-JSS.html#cb105-22"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">names</span>(<span class="kw">coef</span>(mod13a_cc)),</span>
<span id="cb105-23"><a href="ch-JSS.html#cb105-23"></a>                            <span class="dt">type =</span> <span class="st">&#39;97.5%&#39;</span>,</span>
<span id="cb105-24"><a href="ch-JSS.html#cb105-24"></a>                            <span class="dt">model =</span> <span class="st">&#39;cc&#39;</span>,</span>
<span id="cb105-25"><a href="ch-JSS.html#cb105-25"></a>                            <span class="dt">value =</span> <span class="kw">confint</span>(mod13a_cc)[, <span class="st">&#39;97.5 %&#39;</span>]</span>
<span id="cb105-26"><a href="ch-JSS.html#cb105-26"></a>                 )</span>
<span id="cb105-27"><a href="ch-JSS.html#cb105-27"></a>)</span>
<span id="cb105-28"><a href="ch-JSS.html#cb105-28"></a></span>
<span id="cb105-29"><a href="ch-JSS.html#cb105-29"></a></span>
<span id="cb105-30"><a href="ch-JSS.html#cb105-30"></a><span class="co"># ggplot version:</span></span>
<span id="cb105-31"><a href="ch-JSS.html#cb105-31"></a>p13a &lt;-<span class="st"> </span><span class="kw">densplot</span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">use_ggplot =</span> <span class="ot">TRUE</span>, <span class="dt">joined =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb105-32"><a href="ch-JSS.html#cb105-32"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb105-33"><a href="ch-JSS.html#cb105-33"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">grey</span>(<span class="fl">0.95</span>)),</span>
<span id="cb105-34"><a href="ch-JSS.html#cb105-34"></a>        <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="kw">grey</span>(<span class="fl">0.85</span>)),</span>
<span id="cb105-35"><a href="ch-JSS.html#cb105-35"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="kw">grey</span>(<span class="fl">0.85</span>)))</span>
<span id="cb105-36"><a href="ch-JSS.html#cb105-36"></a></span>
<span id="cb105-37"><a href="ch-JSS.html#cb105-37"></a></span>
<span id="cb105-38"><a href="ch-JSS.html#cb105-38"></a><span class="co"># add vertical lines for the:</span></span>
<span id="cb105-39"><a href="ch-JSS.html#cb105-39"></a><span class="co"># - confidence intervals from the complete case analysis</span></span>
<span id="cb105-40"><a href="ch-JSS.html#cb105-40"></a><span class="co"># - quantiles of the posterior distribution</span></span>
<span id="cb105-41"><a href="ch-JSS.html#cb105-41"></a>p13a <span class="op">+</span></span>
<span id="cb105-42"><a href="ch-JSS.html#cb105-42"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> quantDF, <span class="kw">aes</span>(<span class="dt">xintercept =</span> value, <span class="dt">color =</span> model),</span>
<span id="cb105-43"><a href="ch-JSS.html#cb105-43"></a>             <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb105-44"><a href="ch-JSS.html#cb105-44"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&#39;CI from model: &#39;</span>, </span>
<span id="cb105-45"><a href="ch-JSS.html#cb105-45"></a>                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&#39;JointAI&#39;</span>, <span class="st">&#39;cc&#39;</span>),</span>
<span id="cb105-46"><a href="ch-JSS.html#cb105-46"></a>                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#783D4F&quot;</span>, <span class="st">&quot;#174F88&quot;</span>),</span>
<span id="cb105-47"><a href="ch-JSS.html#cb105-47"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;JointAI&#39;</span>, <span class="st">&#39;compl.case&#39;</span>))</span></code></pre></div>




<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="ch-JSS.html#cb106-1"></a>red &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb106-2"><a href="ch-JSS.html#cb106-2"></a>  x &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">enexpr</span>(x)</span>
<span id="cb106-3"><a href="ch-JSS.html#cb106-3"></a>  <span class="cf">if</span> (knitr<span class="op">:::</span><span class="kw">is_latex_output</span>()) {</span>
<span id="cb106-4"><a href="ch-JSS.html#cb106-4"></a>    <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">textcolor{red}{&quot;</span>, x, <span class="st">&quot;}&quot;</span>)</span>
<span id="cb106-5"><a href="ch-JSS.html#cb106-5"></a>  } <span class="cf">else</span> {</span>
<span id="cb106-6"><a href="ch-JSS.html#cb106-6"></a>    <span class="kw">paste0</span>(<span class="st">&quot;&lt;span style=&#39;color:red&#39;&gt;&quot;</span>, x, <span class="st">&quot;&lt;/span&gt;&quot;</span>)</span>
<span id="cb106-7"><a href="ch-JSS.html#cb106-7"></a>  }</span>
<span id="cb106-8"><a href="ch-JSS.html#cb106-8"></a>}</span>
<span id="cb106-9"><a href="ch-JSS.html#cb106-9"></a></span>
<span id="cb106-10"><a href="ch-JSS.html#cb106-10"></a>R &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb106-11"><a href="ch-JSS.html#cb106-11"></a>  <span class="cf">if</span> (knitr<span class="op">:::</span><span class="kw">is_latex_output</span>()) {</span>
<span id="cb106-12"><a href="ch-JSS.html#cb106-12"></a>    <span class="st">&#39;</span><span class="ch">\\</span><span class="st">textsf{R}&#39;</span></span>
<span id="cb106-13"><a href="ch-JSS.html#cb106-13"></a>  } <span class="cf">else</span> {</span>
<span id="cb106-14"><a href="ch-JSS.html#cb106-14"></a>   <span class="st">&#39;R&#39;</span></span>
<span id="cb106-15"><a href="ch-JSS.html#cb106-15"></a>  }</span>
<span id="cb106-16"><a href="ch-JSS.html#cb106-16"></a>}</span>
<span id="cb106-17"><a href="ch-JSS.html#cb106-17"></a></span>
<span id="cb106-18"><a href="ch-JSS.html#cb106-18"></a>JAGS &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb106-19"><a href="ch-JSS.html#cb106-19"></a>  <span class="cf">if</span> (knitr<span class="op">:::</span><span class="kw">is_latex_output</span>()) {</span>
<span id="cb106-20"><a href="ch-JSS.html#cb106-20"></a>    <span class="st">&#39;</span><span class="ch">\\</span><span class="st">textsf{JAGS}&#39;</span></span>
<span id="cb106-21"><a href="ch-JSS.html#cb106-21"></a>  } <span class="cf">else</span> {</span>
<span id="cb106-22"><a href="ch-JSS.html#cb106-22"></a>   <span class="st">&#39;JAGS&#39;</span></span>
<span id="cb106-23"><a href="ch-JSS.html#cb106-23"></a>  }</span>
<span id="cb106-24"><a href="ch-JSS.html#cb106-24"></a>}</span>
<span id="cb106-25"><a href="ch-JSS.html#cb106-25"></a></span>
<span id="cb106-26"><a href="ch-JSS.html#cb106-26"></a>WinBUGS &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb106-27"><a href="ch-JSS.html#cb106-27"></a>  <span class="cf">if</span> (knitr<span class="op">:::</span><span class="kw">is_latex_output</span>()) {</span>
<span id="cb106-28"><a href="ch-JSS.html#cb106-28"></a>    <span class="st">&#39;</span><span class="ch">\\</span><span class="st">textsf{WinBUGS}&#39;</span></span>
<span id="cb106-29"><a href="ch-JSS.html#cb106-29"></a>  } <span class="cf">else</span> {</span>
<span id="cb106-30"><a href="ch-JSS.html#cb106-30"></a>   <span class="st">&#39;WinBUGS&#39;</span></span>
<span id="cb106-31"><a href="ch-JSS.html#cb106-31"></a>  }</span>
<span id="cb106-32"><a href="ch-JSS.html#cb106-32"></a>}</span></code></pre></div>


</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Bartlett2015">
<p>Bartlett, Jonathan W., Shaun R. Seaman, Ian R. White, and James R. Carpenter. 2015. “Multiple Imputation of Covariates by Fully Conditional Specification: Accommodating the Substantive Model.” <em>Statistical Methods in Medical Research</em> 24 (4): 462–87. <a href="https://doi.org/10.1177/0962280214521348">https://doi.org/10.1177/0962280214521348</a>.</p>
</div>
<div id="ref-Brooks1998">
<p>Brooks, Stephen P., and Andrew Gelman. 1998. “General Methods for Monitoring Convergence of Iterative Simulations.” <em>Journal of Computational and Graphical Statistics</em> 7 (4): 434–55. <a href="https://doi.org/10.1080/10618600.1998.10474787">https://doi.org/10.1080/10618600.1998.10474787</a>.</p>
</div>
<div id="ref-doParallel">
<p>Corporation, Microsoft, and Steve Weston. 2018. <em>DoParallel: Foreach Parallel Adaptor for the ’Parallel’ Package</em>. <a href="https://CRAN.R-project.org/package=doParallel">https://CRAN.R-project.org/package=doParallel</a>.</p>
</div>
<div id="ref-JointAI">
<p>Erler, Nicole S. 2019. <em>JointAI: Joint Analysis and Imputation of Incomplete Data</em>. <a href="https://github.com/nerler/JointAI">https://github.com/nerler/JointAI</a>.</p>
</div>
<div id="ref-Erler2017">
<p>Erler, Nicole S., Dimitris Rizopoulos, Vincent W. V. Jaddoe, Oscar H. Franco, and Emmanuel M. E. H. Lesaffre. 2019. “Bayesian Imputation of Time-Varying Covariates in Linear Mixed Models.” <em>Statistical Methods in Medical Research</em> 28 (2): 555–88. <a href="https://doi.org/10.1177/0962280217730851">https://doi.org/10.1177/0962280217730851</a>.</p>
</div>
<div id="ref-Erler2016">
<p>Erler, Nicole S., Dimitris Rizopoulos, Joost van Rosmalen, Vincent W. V. Jaddoe, Oscar H. Franco, and Emmanuel M. E. H. Lesaffre. 2016. “Dealing with Missing Covariates in Epidemiologic Studies: A Comparison Between Multiple Imputation and a Full Bayesian Approach.” <em>Statistics in Medicine</em> 35 (17): 2955–74. <a href="https://doi.org/10.1002/sim.6944">https://doi.org/10.1002/sim.6944</a>.</p>
</div>
<div id="ref-mcmcse">
<p>Flegal, James M., John Hughes, Dootika Vats, and Ning Dai. 2017. <em>Mcmcse: Monte Carlo Standard Errors for Mcmc</em>. Riverside, CA, Denver, CO, Coventry, UK,; Minneapolis, MN.</p>
</div>
<div id="ref-Gelman1992">
<p>Gelman, Andrew, and Donald B. Rubin. 1992. “Inference from Iterative Simulation Using Multiple Sequences.” <em>Statistical Science</em> 7 (4): 457–72. <a href="https://doi.org/10.1214/ss/1177011136">https://doi.org/10.1214/ss/1177011136</a>.</p>
</div>
<div id="ref-Ibrahim2002">
<p>Ibrahim, Joseph G., Ming-Hui Chen, and Stuart R. Lipsitz. 2002. “Bayesian Methods for Generalized Linear Models with Covariates Missing at Random.” <em>Canadian Journal of Statistics</em> 30 (1): 55–78. <a href="https://doi.org/10.2307/3315865">https://doi.org/10.2307/3315865</a>.</p>
</div>
<div id="ref-Lesaffre2012">
<p>Lesaffre, Emmanuel M. E. H., and Andrew B. Lawson. 2012. <em>Bayesian Biostatistics</em>. John Wiley &amp; Sons. <a href="https://doi.org/10.1002/9781119942412">https://doi.org/10.1002/9781119942412</a>.</p>
</div>
<div id="ref-Lunn2012">
<p>Lunn, David, Chris Jackson, Nicky Best, David Spiegelhalter, and Andrew Thomas. 2012. <em>The BUGS book: A practical introduction to Bayesian analysis</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-foreach">
<p>Microsoft, and Steve Weston. 2017. <em>Foreach: Provides Foreach Looping Construct for R</em>. <a href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</a>.</p>
</div>
<div id="ref-NHANES2011">
<p>National Center for Health Statistics (NCHS). 2011. “National Health and Nutrition Examination Survey Data.” U.S. Department of Health and Human Services, Centers for Disease Control and Prevention. <a href="https://www.cdc.gov/nchs/nhanes/">https://www.cdc.gov/nchs/nhanes/</a>.</p>
</div>
<div id="ref-norm">
<p>Novo, Alvaro A., and Joseph L. Schafer. 2010. <em>Norm: Analysis of Multivariate Normal Datasets with Missing Values.</em> (version R package version 1.0-9.5.). <a href="http://CRAN.R-project.org/package=norm">http://CRAN.R-project.org/package=norm</a>.</p>
</div>
<div id="ref-nlme">
<p>Pinheiro, Jose, Douglas Bates, Saikat DebRoy, Deepayan Sarkar, and R Core Team. 2018. <em>nlme: Linear and Nonlinear Mixed Effects Models</em>. <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>.</p>
</div>
<div id="ref-JAGS">
<p>Plummer, M. 2003. “JAGS: A Program for Analysis of Bayesian Graphical Models Using Gibbs Sampling.” Edited by Kurt Hornik, Friedrich Leisch, and Achim Zeileis.</p>
</div>
<div id="ref-rjags2018">
<p>Plummer, Martyn. 2018. <em>Rjags: Bayesian Graphical Models Using Mcmc</em>. <a href="https://CRAN.R-project.org/package=rjags">https://CRAN.R-project.org/package=rjags</a>.</p>
</div>
<div id="ref-coda">
<p>Plummer, Martyn, Nicky Best, Kate Cowles, and Karen Vines. 2006. “CODA: Convergence Diagnosis and Output Analysis for Mcmc.” <em>R News</em> 6 (1): 7–11. <a href="https://journal.r-project.org/archive/">https://journal.r-project.org/archive/</a>.</p>
</div>
<div id="ref-R2018">
<p>R Core Team. 2018. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-Rubin1976">
<p>Rubin, Donald B. 1976. “Inference and Missing Data.” <em>Biometrika</em> 63 (3): 581–92. <a href="https://doi.org/10.2307/2335739">https://doi.org/10.2307/2335739</a>.</p>
</div>
<div id="ref-Rubin1987">
<p>Rubin, Donald B. 1987. <em>Multiple Imputation for Nonresponse in Surveys</em>. Wiley Series in Probability and Statistics. Wiley. <a href="https://doi.org/10.1002/9780470316696">https://doi.org/10.1002/9780470316696</a>.</p>
</div>
<div id="ref-rubin_design_2004">
<p>Rubin, Donald B. 2004. “The Design of a General and Flexible System for Handling Nonresponse in Sample Surveys.” <em>The American Statistician</em> 58 (4): 298–302. <a href="https://doi.org/10.1198/000313004X6355">https://doi.org/10.1198/000313004X6355</a>.</p>
</div>
<div id="ref-Schafer1997">
<p>Schafer, Joseph L. 1997. <em>Analysis of Incomplete Multivariate Data</em>. Chapman &amp; Hall/Crc Monographs on Statistics &amp; Applied Probability. Taylor &amp; Francis.</p>
</div>
<div id="ref-survival2">
<p>Terry M. Therneau, and Patricia M. Grambsch. 2000. <em>Modeling Survival Data: Extending the Cox Model</em>. New York: Springer.</p>
</div>
<div id="ref-survival1">
<p>Therneau, Terry M. 2015. <em>A Package for Survival Analysis in S</em>. <a href="https://CRAN.R-project.org/package=survival">https://CRAN.R-project.org/package=survival</a>.</p>
</div>
<div id="ref-Buuren2012">
<p>Van Buuren, Stef. 2012. <em>Flexible Imputation of Missing Data</em>. Chapman &amp; Hall/CRC Interdisciplinary Statistics. Taylor &amp; Francis.</p>
</div>
<div id="ref-mice">
<p>Van Buuren, Stef, and Karin Groothuis-Oudshoorn. 2011. “mice: Multivariate Imputation by Chained Equations in R.” <em>Journal of Statistical Software</em> 45 (3): 1–67. <a href="https://doi.org/10.18637/jss.v045.i03">https://doi.org/10.18637/jss.v045.i03</a>.</p>
</div>
<div id="ref-White2011">
<p>White, Ian R., Patrick Royston, and Angela M. Wood. 2011. “Multiple imputation using chained equations: Issues and guidance for practice.” <em>Statistics in Medicine</em> 30 (4): 377–99. <a href="https://doi.org/10.1002/sim.4067">https://doi.org/10.1002/sim.4067</a>.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org">http://ggplot2.org</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-SMMR.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
